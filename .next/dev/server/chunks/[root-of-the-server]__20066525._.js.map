{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/lib/db.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = (globalThis as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (globalThis as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAEA;;;;CAIC,GACD,IAAI,SAAS,AAAC,WAAmB,QAAQ;AAEzC,IAAI,CAAC,QAAQ;IACX,SAAS,AAAC,WAAmB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACtE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,wNAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YAC1D,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/models/User.ts"],"sourcesContent":["import mongoose, { Schema, model, models } from 'mongoose';\r\n\r\n// Sub-schemas for structured data\r\nconst MessageSchema = new Schema({\r\n  id: String,\r\n  role: String,\r\n  text: String,\r\n  timestamp: Number,\r\n  image: String,\r\n  isError: Boolean,\r\n  isSystem: Boolean,\r\n  isBookmarked: Boolean,\r\n  categoryId: String,\r\n  note: String,\r\n  mode: String,\r\n  sessionId: String\r\n}, { _id: false });\r\n\r\nconst CategorySchema = new Schema({\r\n  id: String,\r\n  name: String,\r\n  mode: String,\r\n  createdAt: Number,\r\n  parentId: String\r\n}, { _id: false });\r\n\r\nconst SessionSchema = new Schema({\r\n  id: String,\r\n  title: String,\r\n  updatedAt: Number\r\n}, { _id: false });\r\n\r\n// Main User Schema\r\nconst UserSchema = new Schema({\r\n  username: { type: String, required: true, unique: true },\r\n  password: { type: String, required: true }, // Hashed password\r\n  phoneNumber: { type: String },\r\n  avatar: String,\r\n  createdAt: { type: Number, default: Date.now },\r\n  \r\n  // Embedded Data (Document Model)\r\n  // In a massive scale app, messages might be in a separate collection, \r\n  // but for a personal assistant, embedding is efficient for full-sync.\r\n  data: {\r\n    messages: { type: [MessageSchema], default: [] },\r\n    categories: { type: [CategorySchema], default: [] },\r\n    sessions: { type: [SessionSchema], default: [] },\r\n    currentSessionId: String,\r\n    currentMode: String\r\n  }\r\n});\r\n\r\nconst User = models.User || model('User', UserSchema);\r\n\r\nexport default User;"],"names":[],"mappings":";;;;AAAA;;AAEA,kCAAkC;AAClC,MAAM,gBAAgB,IAAI,uNAAM,CAAC;IAC/B,IAAI;IACJ,MAAM;IACN,MAAM;IACN,WAAW;IACX,OAAO;IACP,SAAS;IACT,UAAU;IACV,cAAc;IACd,YAAY;IACZ,MAAM;IACN,MAAM;IACN,WAAW;AACb,GAAG;IAAE,KAAK;AAAM;AAEhB,MAAM,iBAAiB,IAAI,uNAAM,CAAC;IAChC,IAAI;IACJ,MAAM;IACN,MAAM;IACN,WAAW;IACX,UAAU;AACZ,GAAG;IAAE,KAAK;AAAM;AAEhB,MAAM,gBAAgB,IAAI,uNAAM,CAAC;IAC/B,IAAI;IACJ,OAAO;IACP,WAAW;AACb,GAAG;IAAE,KAAK;AAAM;AAEhB,mBAAmB;AACnB,MAAM,aAAa,IAAI,uNAAM,CAAC;IAC5B,UAAU;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACvD,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,aAAa;QAAE,MAAM;IAAO;IAC5B,QAAQ;IACR,WAAW;QAAE,MAAM;QAAQ,SAAS,KAAK,GAAG;IAAC;IAE7C,iCAAiC;IACjC,uEAAuE;IACvE,sEAAsE;IACtE,MAAM;QACJ,UAAU;YAAE,MAAM;gBAAC;aAAc;YAAE,SAAS,EAAE;QAAC;QAC/C,YAAY;YAAE,MAAM;gBAAC;aAAe;YAAE,SAAS,EAAE;QAAC;QAClD,UAAU;YAAE,MAAM;gBAAC;aAAc;YAAE,SAAS,EAAE;QAAC;QAC/C,kBAAkB;QAClB,aAAa;IACf;AACF;AAEA,MAAM,OAAO,uNAAM,CAAC,IAAI,IAAI,IAAA,sNAAK,EAAC,QAAQ;uCAE3B"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport dbConnect from '@/lib/db';\r\nimport User from '@/models/User';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    await dbConnect();\r\n    const { username, password } = await req.json();\r\n\r\n    // Select password to verify, and data to load state\r\n    const user = await User.findOne({ username }).select('+password');\r\n    \r\n    if (!user) {\r\n      return NextResponse.json({ message: '用户名或密码错误' }, { status: 401 });\r\n    }\r\n\r\n    const isMatch = await bcrypt.compare(password, user.password);\r\n    if (!isMatch) {\r\n      return NextResponse.json({ message: '用户名或密码错误' }, { status: 401 });\r\n    }\r\n\r\n    const userObj = user.toObject();\r\n    delete userObj.password;\r\n\r\n    // Return User Info AND their Data\r\n    return NextResponse.json({\r\n      user: {\r\n         id: userObj._id.toString(),\r\n         username: userObj.username,\r\n         phoneNumber: userObj.phoneNumber,\r\n         avatar: userObj.avatar,\r\n         createdAt: userObj.createdAt\r\n      },\r\n      data: userObj.data // This loads the cloud state\r\n    });\r\n\r\n  } catch (error: any) {\r\n    return NextResponse.json({ message: '登录失败' }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,IAAA,sHAAS;QACf,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAE7C,oDAAoD;QACpD,MAAM,OAAO,MAAM,2HAAI,CAAC,OAAO,CAAC;YAAE;QAAS,GAAG,MAAM,CAAC;QAErD,IAAI,CAAC,MAAM;YACT,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAW,GAAG;gBAAE,QAAQ;YAAI;QAClE;QAEA,MAAM,UAAU,MAAM,mMAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;QAC5D,IAAI,CAAC,SAAS;YACZ,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAW,GAAG;gBAAE,QAAQ;YAAI;QAClE;QAEA,MAAM,UAAU,KAAK,QAAQ;QAC7B,OAAO,QAAQ,QAAQ;QAEvB,kCAAkC;QAClC,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,MAAM;gBACH,IAAI,QAAQ,GAAG,CAAC,QAAQ;gBACxB,UAAU,QAAQ,QAAQ;gBAC1B,aAAa,QAAQ,WAAW;gBAChC,QAAQ,QAAQ,MAAM;gBACtB,WAAW,QAAQ,SAAS;YAC/B;YACA,MAAM,QAAQ,IAAI,CAAC,6BAA6B;QAClD;IAEF,EAAE,OAAO,OAAY;QACnB,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAO,GAAG;YAAE,QAAQ;QAAI;IAC9D;AACF"}}]
}
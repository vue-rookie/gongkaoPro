{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/types.ts"],"sourcesContent":["export enum ExamMode {\r\n  XING_CE = 'XING_CE', // Administrative Aptitude Test\r\n  SHEN_LUN = 'SHEN_LUN', // Essay Writing\r\n  MIAN_SHI = 'MIAN_SHI'  // Interview\r\n}\r\n\r\nexport interface Category {\r\n  id: string;\r\n  name: string;\r\n  mode: ExamMode;\r\n  createdAt: number;\r\n  parentId?: string; // Optional: ID of the parent category\r\n}\r\n\r\nexport interface Session {\r\n  id: string;\r\n  title: string;\r\n  updatedAt: number;\r\n}\r\n\r\nexport interface User {\r\n  id: string;\r\n  username: string;\r\n  password?: string; // In a real app, never store passwords in frontend state! This is for mock only.\r\n  avatar?: string;\r\n  phoneNumber?: string; // Added phone number\r\n  createdAt: number;\r\n}\r\n\r\nexport interface QuizQuestion {\r\n  id: string;\r\n  question: string;\r\n  material?: string; // For Shen Lun: The reading passage/context\r\n  options?: string[]; // Multiple choice options (Xing Ce only)\r\n  answer: string; // Correct answer letter OR Reference Essay\r\n  analysis: string; // Detailed analysis\r\n  userAnswer?: string; // To track user state locally\r\n}\r\n\r\nexport interface QuizConfig {\r\n  topic: string;\r\n  count: number;\r\n}\r\n\r\nexport interface Message {\r\n  id: string;\r\n  role: 'user' | 'model';\r\n  text: string;\r\n  timestamp: number;\r\n  image?: string; // Base64 string for user uploaded images\r\n  isError?: boolean;\r\n  isSystem?: boolean; \r\n  \r\n  // Quiz Data\r\n  quizData?: QuizQuestion[];\r\n\r\n  // Study tools\r\n  isBookmarked?: boolean;\r\n  categoryId?: string; // Link to a Category ID\r\n  note?: string; \r\n  mode?: ExamMode; \r\n  sessionId?: string; // Linked Session\r\n}\r\n\r\nexport interface ChatState {\r\n  currentUser: User | null; // Currently logged in user\r\n  messages: Message[];\r\n  categories: Category[]; // List of user defined categories\r\n  sessions: Session[]; // List of chat sessions\r\n  currentSessionId: string; // Active session ID\r\n  isLoading: boolean;\r\n  currentMode: ExamMode;\r\n  showFavoritesOnly: boolean;\r\n}\r\n\r\nexport interface GeminiConfig {\r\n  model: string;\r\n  systemInstruction: string;\r\n}"],"names":[],"mappings":";;;;AAAO,IAAA,AAAK,kCAAA;;;uCAGa,YAAY;WAHzB"}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/constants.ts"],"sourcesContent":["import { ExamMode } from './types';\r\n\r\n// Gemini Models\r\nexport const MODEL_FLASH = 'gemini-3-flash-preview';\r\nexport const MODEL_PRO = 'gemini-3-pro-preview';\r\n\r\n// Exam Sub-topics\r\nexport const EXAM_TOPICS: Record<ExamMode, string[]> = {\r\n  [ExamMode.XING_CE]: ['随机混卷', '常识判断', '言语理解与表达', '数量关系', '判断推理', '资料分析'],\r\n  [ExamMode.SHEN_LUN]: ['随机练习', '归纳概括', '综合分析', '提出对策', '贯彻执行', '文章写作'],\r\n  [ExamMode.MIAN_SHI]: ['随机模拟', '综合分析', '人际关系', '应急应变', '组织管理', '情景模拟']\r\n};\r\n\r\n// System Instructions - prompt engineering is key here\r\nconst BASE_INSTRUCTION = `\r\n你是一位中国公考（公务员、事业单位）顶级培训专家。\r\n**核心指令**：\r\n1. **直接作答**：利用你内置的海量真题库和知识储备直接回答用户问题。\r\n2. **隐藏解析（重要）**：为了让用户先思考，**必须**将所有的**答案、详细解析、速算技巧、参考范文**包裹在 \\`\\`\\`analysis ... \\`\\`\\` 代码块中。**不要**在 \\`analysis\\` 块之外直接泄露答案。\r\n   - 格式示例：\r\n     问题内容...\r\n     A. xxx\r\n     B. xxx\r\n     ...\r\n     \\`\\`\\`analysis\r\n     【答案】B\r\n     【解析】\r\n     第一步：...\r\n     第二步：...\r\n     \\`\\`\\`\r\n3. **真题复现**：当用户询问真题时，凭记忆复现经典题目（包含题干、选项）。\r\n4. **专业性**：严格依据中国国家公务员考试大纲。\r\n5. **逻辑性**：结构清晰，分点作答。使用Markdown格式渲染重点。\r\n`;\r\n\r\nexport const SYSTEM_INSTRUCTIONS: Record<ExamMode, string> = {\r\n  [ExamMode.XING_CE]: `\r\n${BASE_INSTRUCTION}\r\n【当前模式：行测 (Administrative Aptitude)】\r\n- **角色**：逻辑思维导师、数学解题专家。\r\n- **强制规范**：\r\n  - **选项必填**：无论是用户要求出题、模拟题还是询问真题，**必须**在题干后列出 A、B、C、D 四个选项。\r\n  - **图形推理特例**：对于图形推理题：\r\n    1. **题干**：使用 SVG 代码绘制题目图形。\r\n    2. **选项**：**必须**也使用 SVG 代码绘制 A、B、C、D 四个选项。**严禁使用文字描述选项**（如“A. 圆形”是错误的，必须画出一个圆的 SVG）。\r\n    3. **格式**：选项内容直接输出 SVG 字符串，不要包裹 markdown 代码块。\r\n- **任务细分**：\r\n  - **资料分析**：\r\n    - **数据展示**：请务必使用标准的 **Markdown 表格** 展示统计数据，确保对齐清晰。\r\n    - **速算技巧**：在 \\`analysis\\` 块中，必须明确标注使用的技巧（如“特征数字法”、“截位直除法”），并分步展示估算过程。\r\n  - **图形推理**：\r\n    - **SVG规范**：使用 \\`\\`\\`svg ... \\`\\`\\` 包裹题干 SVG。选项直接列出 SVG 代码。\r\n    - **关键描述**：在 <svg> 标签内添加 <title> 描述规律。\r\n- **风格**：简洁、犀利、直击考点。\r\n`,\r\n  [ExamMode.SHEN_LUN]: `\r\n${BASE_INSTRUCTION}\r\n【当前模式：申论 (Essay Writing)】\r\n- **角色**：政策分析师、申论阅卷组长。\r\n- **任务**：\r\n  - **理论引用**：熟练引用官方表述。\r\n  - **文章润色**：将用户的大白话修改为规范的机关公文用语。\r\n  - **提纲构建**：针对社会话题提供标准结构。\r\n  - **解析**：将“参考范文”或“提纲”放入 \\`analysis\\` 块中，让用户先自己构思。\r\n- **风格**：严谨、大气、政治站位高。\r\n`,\r\n  [ExamMode.MIAN_SHI]: `\r\n${BASE_INSTRUCTION}\r\n【当前模式：面试 (Interview)】\r\n- **角色**：资深面试考官。\r\n- **任务**：\r\n  - **模拟题**：直接给出一道结构化面试题。\r\n  - **高情商回答**：将“答题思路”和“参考话术”放入 \\`analysis\\` 块中，模拟真实的面试等待思考时间。\r\n  - **追问**：在用户回答后，进行压力测试。\r\n- **风格**：阳光自信，体现政府思维。\r\n`\r\n};\r\n\r\nexport const MODE_LABELS: Record<ExamMode, string> = {\r\n  [ExamMode.XING_CE]: '行测专家',\r\n  [ExamMode.SHEN_LUN]: '申论导师',\r\n  [ExamMode.MIAN_SHI]: '面试考官'\r\n};\r\n\r\nexport const MODE_DESCRIPTIONS: Record<ExamMode, string> = {\r\n  [ExamMode.XING_CE]: '精通历年真题库。擅长逻辑推理、资料分析速算。',\r\n  [ExamMode.SHEN_LUN]: '精通政策理论。擅长公文写作润色与大作文批改。',\r\n  [ExamMode.MIAN_SHI]: '精通各类面试题型。提供结构化答题思路与模拟。'\r\n};"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAGO,MAAM,cAAc;AACpB,MAAM,YAAY;AAGlB,MAAM,cAA0C;IACrD,CAAC,mHAAQ,CAAC,OAAO,CAAC,EAAE;QAAC;QAAQ;QAAQ;QAAW;QAAQ;QAAQ;KAAO;IACvE,CAAC,mHAAQ,CAAC,QAAQ,CAAC,EAAE;QAAC;QAAQ;QAAQ;QAAQ;QAAQ;QAAQ;KAAO;IACrE,CAAC,mHAAQ,CAAC,QAAQ,CAAC,EAAE;QAAC;QAAQ;QAAQ;QAAQ;QAAQ;QAAQ;KAAO;AACvE;AAEA,uDAAuD;AACvD,MAAM,mBAAmB,CAAC;;;;;;;;;;;;;;;;;;;AAmB1B,CAAC;AAEM,MAAM,sBAAgD;IAC3D,CAAC,mHAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;AACvB,EAAE,iBAAiB;;;;;;;;;;;;;;;;;AAiBnB,CAAC;IACC,CAAC,mHAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;AACxB,EAAE,iBAAiB;;;;;;;;;AASnB,CAAC;IACC,CAAC,mHAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;AACxB,EAAE,iBAAiB;;;;;;;;AAQnB,CAAC;AACD;AAEO,MAAM,cAAwC;IACnD,CAAC,mHAAQ,CAAC,OAAO,CAAC,EAAE;IACpB,CAAC,mHAAQ,CAAC,QAAQ,CAAC,EAAE;IACrB,CAAC,mHAAQ,CAAC,QAAQ,CAAC,EAAE;AACvB;AAEO,MAAM,oBAA8C;IACzD,CAAC,mHAAQ,CAAC,OAAO,CAAC,EAAE;IACpB,CAAC,mHAAQ,CAAC,QAAQ,CAAC,EAAE;IACrB,CAAC,mHAAQ,CAAC,QAAQ,CAAC,EAAE;AACvB"}},
    {"offset": {"line": 301, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/app/api/gemini/quiz/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { GoogleGenAI } from '@google/genai';\r\nimport { ExamMode } from '../../../../types';\r\nimport { MODEL_FLASH } from '../../../../constants';\r\n\r\nconst apiKey = process.env.GEMINI_API_KEY;\r\nif (!apiKey) {\r\n  console.error('GEMINI_API_KEY not found in environment variables');\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    if (!apiKey) {\r\n      return NextResponse.json(\r\n        { error: 'API Key not configured' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    const { mode, topic, count = 5 } = await request.json();\r\n\r\n    const ai = new GoogleGenAI({ apiKey });\r\n    const modelName = MODEL_FLASH;\r\n    let prompt = '';\r\n\r\n    if (mode === ExamMode.SHEN_LUN) {\r\n      prompt = `\r\n        请生成 1 道【申论 (Essay Writing)】模拟题。\r\n        主题：${topic || '社会热点'}。\r\n\r\n        要求：\r\n        1. 返回纯 JSON 数组格式，只包含 1 个对象。\r\n        2. JSON 字段包含：id, material (给定资料 300字+), question, answer (参考范文), analysis (解析), options: null。\r\n      `;\r\n    } else {\r\n      const isGraphicReasoning = topic?.includes('图形推理');\r\n\r\n      prompt = `\r\n        请生成 ${count} 道 ${mode === ExamMode.MIAN_SHI ? '面试' : '行测'} 题目。\r\n        主题：${topic || '随机'}。\r\n\r\n        要求：\r\n        1. 返回纯 JSON 数组。\r\n        2. 包含字段：id, question, options (数组), answer, analysis。\r\n        ${isGraphicReasoning ? `\r\n        3. **图形推理强制要求**：\r\n           - **题干**：描述规律后，必须用 \\`\\`\\`svg ... \\`\\`\\` 包裹 SVG 代码。\r\n           - **选项**：\\`options\\` 数组中的每一项**必须是 SVG 代码字符串**。\r\n           - **选项格式**：例如 [\"A. <svg>...</svg>\", \"B. <svg>...</svg>\", \"C. <svg>...</svg>\", \"D. <svg>...</svg>\"]。\r\n           - **严禁**使用文字描述（如\"A. 一个黑点\"）作为选项，必须画出来。\r\n           - 保持 SVG 简洁，viewBox 建议 \"0 0 100 100\"。\r\n        ` : ''}\r\n      `;\r\n    }\r\n\r\n    const response = await ai.models.generateContent({\r\n      model: modelName,\r\n      contents: { parts: [{ text: prompt }] },\r\n      config: {\r\n        responseMimeType: 'application/json',\r\n      }\r\n    });\r\n\r\n    const jsonText = response.text || '[]';\r\n    const cleanJson = jsonText.replace(/^```json\\s*/, '').replace(/^```\\s*/, '').replace(/```$/, '').trim();\r\n\r\n    const quizData = JSON.parse(cleanJson);\r\n\r\n    const processedData = quizData.map((q: any, index: number) => ({\r\n      ...q,\r\n      id: q.id || `quiz-${Date.now()}-${index}`\r\n    }));\r\n\r\n    return NextResponse.json({\r\n      quizData: processedData,\r\n      success: true\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('Quiz generation error:', error);\r\n    return NextResponse.json(\r\n      { error: error.message || '无法生成题目，请稍后再试。' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;AACzC,IAAI,CAAC,QAAQ;IACX,QAAQ,KAAK,CAAC;AAChB;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,IAAI,CAAC,QAAQ;YACX,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,CAAC,EAAE,GAAG,MAAM,QAAQ,IAAI;QAErD,MAAM,KAAK,IAAI,2OAAW,CAAC;YAAE;QAAO;QACpC,MAAM,YAAY,0HAAW;QAC7B,IAAI,SAAS;QAEb,IAAI,SAAS,mHAAQ,CAAC,QAAQ,EAAE;YAC9B,SAAS,CAAC;;WAEL,EAAE,SAAS,OAAO;;;;;MAKvB,CAAC;QACH,OAAO;YACL,MAAM,qBAAqB,OAAO,SAAS;YAE3C,SAAS,CAAC;YACJ,EAAE,MAAM,GAAG,EAAE,SAAS,mHAAQ,CAAC,QAAQ,GAAG,OAAO,KAAK;WACvD,EAAE,SAAS,KAAK;;;;;QAKnB,EAAE,qBAAqB,CAAC;;;;;;;QAOxB,CAAC,GAAG,GAAG;MACT,CAAC;QACH;QAEA,MAAM,WAAW,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC;YAC/C,OAAO;YACP,UAAU;gBAAE,OAAO;oBAAC;wBAAE,MAAM;oBAAO;iBAAE;YAAC;YACtC,QAAQ;gBACN,kBAAkB;YACpB;QACF;QAEA,MAAM,WAAW,SAAS,IAAI,IAAI;QAClC,MAAM,YAAY,SAAS,OAAO,CAAC,eAAe,IAAI,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI;QAErG,MAAM,WAAW,KAAK,KAAK,CAAC;QAE5B,MAAM,gBAAgB,SAAS,GAAG,CAAC,CAAC,GAAQ,QAAkB,CAAC;gBAC7D,GAAG,CAAC;gBACJ,IAAI,EAAE,EAAE,IAAI,CAAC,KAAK,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,OAAO;YAC3C,CAAC;QAED,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,UAAU;YACV,SAAS;QACX;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAgB,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}
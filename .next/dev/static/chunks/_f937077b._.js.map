{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/Header.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { GraduationCap, Sparkles, Trash2, BookOpen, Menu, LogIn, UserCircle, LogOut, ChevronDown, PanelLeftClose, PanelLeftOpen } from 'lucide-react';\r\nimport { User } from '../types';\r\n\r\ninterface Props {\r\n  user: User | null;\r\n  onClearHistory: () => void;\r\n  showFavoritesOnly: boolean;\r\n  onToggleFavorites: () => void;\r\n  onToggleSidebar: () => void; // Unified toggle handler\r\n  isSidebarOpen: boolean; // Used to show different icons (optional)\r\n  onLoginClick: () => void;\r\n  onLogoutClick: () => void;\r\n}\r\n\r\nconst Header: React.FC<Props> = ({ \r\n  user,\r\n  onClearHistory, \r\n  showFavoritesOnly, \r\n  onToggleFavorites, \r\n  onToggleSidebar,\r\n  isSidebarOpen,\r\n  onLoginClick,\r\n  onLogoutClick\r\n}) => {\r\n  const [showUserMenu, setShowUserMenu] = useState(false);\r\n\r\n  return (\r\n    <header className=\"flex-shrink-0 bg-[#fcfaf8] sticky top-0 z-20\">\r\n      <div className=\"w-full px-4 h-14 flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Menu button visible on all screens */}\r\n          <button \r\n            onClick={onToggleSidebar}\r\n            className=\"p-2 -ml-2 text-stone-500 hover:bg-stone-200 rounded-lg transition-colors\"\r\n            title={isSidebarOpen ? \"收起侧边栏\" : \"展开侧边栏\"}\r\n          >\r\n             {/* Show Menu icon on mobile, Panel icons on desktop preference? Or just Menu everywhere */}\r\n             <Menu size={20} className=\"md:hidden\" />\r\n             {isSidebarOpen ? <PanelLeftClose size={20} className=\"hidden md:block\" /> : <PanelLeftOpen size={20} className=\"hidden md:block\" />}\r\n          </button>\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"text-stone-700 hidden md:block\">\r\n                <GraduationCap size={20} />\r\n            </div>\r\n            <div className=\"flex flex-col\">\r\n                <h1 className=\"text-lg font-serif font-bold text-stone-800 leading-none tracking-tight\">公考智囊</h1>\r\n                <span className=\"text-[10px] text-stone-400 font-medium tracking-widest\">PRO</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-2 md:gap-3\">\r\n          \r\n          {/* Notebook Toggle */}\r\n          <button\r\n            onClick={onToggleFavorites}\r\n            className={`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold transition-all border ${\r\n              showFavoritesOnly\r\n                ? 'bg-amber-100 text-amber-800 border-amber-200'\r\n                : 'bg-white text-stone-600 border-stone-200 hover:bg-stone-50'\r\n            }`}\r\n            title=\"查看笔记本\"\r\n          >\r\n            <BookOpen size={14} className={showFavoritesOnly ? \"text-amber-700\" : \"text-stone-500\"} />\r\n            <span className=\"hidden md:inline\">{showFavoritesOnly ? '返回对话' : '笔记本'}</span>\r\n            <span className=\"md:hidden\">{showFavoritesOnly ? '返回' : '笔记'}</span>\r\n          </button>\r\n\r\n          {/* User Section */}\r\n          {user ? (\r\n            <div className=\"relative\">\r\n              <button \r\n                onClick={() => setShowUserMenu(!showUserMenu)}\r\n                className=\"flex items-center gap-2 hover:bg-stone-100 rounded-full pr-2 pl-1 py-1 transition-colors border border-transparent hover:border-stone-200\"\r\n              >\r\n                <div className=\"w-7 h-7 bg-stone-200 text-stone-600 rounded-full flex items-center justify-center font-bold text-xs\">\r\n                  {user.avatar ? <img src={user.avatar} className=\"w-full h-full rounded-full\" /> : user.username[0].toUpperCase()}\r\n                </div>\r\n                <span className=\"text-xs font-semibold text-stone-700 max-w-[80px] truncate hidden md:block\">{user.username}</span>\r\n                <ChevronDown size={12} className=\"text-stone-400\" />\r\n              </button>\r\n\r\n              {/* User Dropdown */}\r\n              {showUserMenu && (\r\n                <>\r\n                  <div className=\"fixed inset-0 z-10\" onClick={() => setShowUserMenu(false)}></div>\r\n                  <div className=\"absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-stone-100 z-20 overflow-hidden animate-in slide-in-from-top-2 fade-in duration-200\">\r\n                     <div className=\"p-3 border-b border-stone-50 bg-stone-50/50\">\r\n                        <p className=\"text-xs text-stone-500\">登录用户</p>\r\n                        <p className=\"font-bold text-stone-800 truncate\">{user.username}</p>\r\n                     </div>\r\n                     <div className=\"p-1\">\r\n                        <button \r\n                           onClick={() => { onClearHistory(); setShowUserMenu(false); }}\r\n                           className=\"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg flex items-center gap-2 transition-colors\"\r\n                        >\r\n                           <Trash2 size={14} />\r\n                           清空当前数据\r\n                        </button>\r\n                        <button \r\n                           onClick={() => { onLogoutClick(); setShowUserMenu(false); }}\r\n                           className=\"w-full text-left px-3 py-2 text-sm text-stone-600 hover:bg-stone-100 rounded-lg flex items-center gap-2 transition-colors\"\r\n                        >\r\n                           <LogOut size={14} />\r\n                           退出登录\r\n                        </button>\r\n                     </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <button\r\n              onClick={onLoginClick}\r\n              className=\"flex items-center gap-1.5 bg-stone-800 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-stone-700 transition-all shadow-sm\"\r\n            >\r\n              <LogIn size={14} />\r\n              <span className=\"hidden md:inline\">登录</span>\r\n            </button>\r\n          )}\r\n          \r\n        </div>\r\n      </div>\r\n    </header>\r\n  );\r\n};\r\n\r\nexport default Header;"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAHA;;;AAiBA,MAAM,SAA0B,CAAC,EAC/B,IAAI,EACJ,cAAc,EACd,iBAAiB,EACjB,iBAAiB,EACjB,eAAe,EACf,aAAa,EACb,YAAY,EACZ,aAAa,EACd;;IACC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,wSAAQ,EAAC;IAEjD,qBACE,4TAAC;QAAO,WAAU;kBAChB,cAAA,4TAAC;YAAI,WAAU;;8BACb,4TAAC;oBAAI,WAAU;;sCAEb,4TAAC;4BACC,SAAS;4BACT,WAAU;4BACV,OAAO,gBAAgB,UAAU;;8CAGhC,4TAAC,iSAAI;oCAAC,MAAM;oCAAI,WAAU;;;;;;gCACzB,8BAAgB,4TAAC,uUAAc;oCAAC,MAAM;oCAAI,WAAU;;;;;6FAAuB,4TAAC,oUAAa;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;;sCAGlH,4TAAC;4BAAI,WAAU;;8CACb,4TAAC;oCAAI,WAAU;8CACX,cAAA,4TAAC,gUAAa;wCAAC,MAAM;;;;;;;;;;;8CAEzB,4TAAC;oCAAI,WAAU;;sDACX,4TAAC;4CAAG,WAAU;sDAA0E;;;;;;sDACxF,4TAAC;4CAAK,WAAU;sDAAyD;;;;;;;;;;;;;;;;;;;;;;;;8BAKjF,4TAAC;oBAAI,WAAU;;sCAGb,4TAAC;4BACC,SAAS;4BACT,WAAW,CAAC,+FAA+F,EACzG,oBACI,iDACA,8DACJ;4BACF,OAAM;;8CAEN,4TAAC,iTAAQ;oCAAC,MAAM;oCAAI,WAAW,oBAAoB,mBAAmB;;;;;;8CACtE,4TAAC;oCAAK,WAAU;8CAAoB,oBAAoB,SAAS;;;;;;8CACjE,4TAAC;oCAAK,WAAU;8CAAa,oBAAoB,OAAO;;;;;;;;;;;;wBAIzD,qBACC,4TAAC;4BAAI,WAAU;;8CACb,4TAAC;oCACC,SAAS,IAAM,gBAAgB,CAAC;oCAChC,WAAU;;sDAEV,4TAAC;4CAAI,WAAU;sDACZ,KAAK,MAAM,iBAAG,4TAAC;gDAAI,KAAK,KAAK,MAAM;gDAAE,WAAU;;;;;2FAAkC,KAAK,QAAQ,CAAC,EAAE,CAAC,WAAW;;;;;;sDAEhH,4TAAC;4CAAK,WAAU;sDAA8E,KAAK,QAAQ;;;;;;sDAC3G,4TAAC,0TAAW;4CAAC,MAAM;4CAAI,WAAU;;;;;;;;;;;;gCAIlC,8BACC;;sDACE,4TAAC;4CAAI,WAAU;4CAAqB,SAAS,IAAM,gBAAgB;;;;;;sDACnE,4TAAC;4CAAI,WAAU;;8DACZ,4TAAC;oDAAI,WAAU;;sEACZ,4TAAC;4DAAE,WAAU;sEAAyB;;;;;;sEACtC,4TAAC;4DAAE,WAAU;sEAAqC,KAAK,QAAQ;;;;;;;;;;;;8DAElE,4TAAC;oDAAI,WAAU;;sEACZ,4TAAC;4DACE,SAAS;gEAAQ;gEAAkB,gBAAgB;4DAAQ;4DAC3D,WAAU;;8EAEV,4TAAC,2SAAM;oEAAC,MAAM;;;;;;gEAAM;;;;;;;sEAGvB,4TAAC;4DACE,SAAS;gEAAQ;gEAAiB,gBAAgB;4DAAQ;4DAC1D,WAAU;;8EAEV,4TAAC,2SAAM;oEAAC,MAAM;;;;;;gEAAM;;;;;;;;;;;;;;;;;;;;;;;;;;qFASnC,4TAAC;4BACC,SAAS;4BACT,WAAU;;8CAEV,4TAAC,wSAAK;oCAAC,MAAM;;;;;;8CACb,4TAAC;oCAAK,WAAU;8CAAmB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQjD;GAhHM;KAAA;uCAkHS"}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/types.ts"],"sourcesContent":["export enum ExamMode {\r\n  XING_CE = 'XING_CE', // Administrative Aptitude Test\r\n  SHEN_LUN = 'SHEN_LUN', // Essay Writing\r\n  MIAN_SHI = 'MIAN_SHI'  // Interview\r\n}\r\n\r\nexport interface Category {\r\n  id: string;\r\n  name: string;\r\n  mode: ExamMode;\r\n  createdAt: number;\r\n  parentId?: string; // Optional: ID of the parent category\r\n}\r\n\r\nexport interface Session {\r\n  id: string;\r\n  title: string;\r\n  updatedAt: number;\r\n}\r\n\r\nexport interface User {\r\n  id: string;\r\n  username: string;\r\n  password?: string; // In a real app, never store passwords in frontend state! This is for mock only.\r\n  avatar?: string;\r\n  phoneNumber?: string; // Added phone number\r\n  createdAt: number;\r\n}\r\n\r\nexport interface QuizQuestion {\r\n  id: string;\r\n  question: string;\r\n  material?: string; // For Shen Lun: The reading passage/context\r\n  options?: string[]; // Multiple choice options (Xing Ce only)\r\n  answer: string; // Correct answer letter OR Reference Essay\r\n  analysis: string; // Detailed analysis\r\n  userAnswer?: string; // To track user state locally\r\n}\r\n\r\nexport interface QuizConfig {\r\n  topic: string;\r\n  count: number;\r\n}\r\n\r\nexport interface Message {\r\n  id: string;\r\n  role: 'user' | 'model';\r\n  text: string;\r\n  timestamp: number;\r\n  image?: string; // Base64 string for user uploaded images\r\n  isError?: boolean;\r\n  isSystem?: boolean; \r\n  \r\n  // Quiz Data\r\n  quizData?: QuizQuestion[];\r\n\r\n  // Study tools\r\n  isBookmarked?: boolean;\r\n  categoryId?: string; // Link to a Category ID\r\n  note?: string; \r\n  mode?: ExamMode; \r\n  sessionId?: string; // Linked Session\r\n}\r\n\r\nexport interface ChatState {\r\n  currentUser: User | null; // Currently logged in user\r\n  messages: Message[];\r\n  categories: Category[]; // List of user defined categories\r\n  sessions: Session[]; // List of chat sessions\r\n  currentSessionId: string; // Active session ID\r\n  isLoading: boolean;\r\n  currentMode: ExamMode;\r\n  showFavoritesOnly: boolean;\r\n}\r\n\r\nexport interface GeminiConfig {\r\n  model: string;\r\n  systemInstruction: string;\r\n}"],"names":[],"mappings":";;;;AAAO,IAAA,AAAK,kCAAA;;;uCAGa,YAAY;WAHzB"}},
    {"offset": {"line": 379, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/constants.ts"],"sourcesContent":["import { ExamMode } from './types';\r\n\r\n// Gemini Models\r\nexport const MODEL_FLASH = 'gemini-3-flash-preview';\r\nexport const MODEL_PRO = 'gemini-3-pro-preview';\r\n\r\n// Exam Sub-topics\r\nexport const EXAM_TOPICS: Record<ExamMode, string[]> = {\r\n  [ExamMode.XING_CE]: ['随机混卷', '常识判断', '言语理解与表达', '数量关系', '判断推理', '资料分析'],\r\n  [ExamMode.SHEN_LUN]: ['随机练习', '归纳概括', '综合分析', '提出对策', '贯彻执行', '文章写作'],\r\n  [ExamMode.MIAN_SHI]: ['随机模拟', '综合分析', '人际关系', '应急应变', '组织管理', '情景模拟']\r\n};\r\n\r\n// System Instructions - prompt engineering is key here\r\nconst BASE_INSTRUCTION = `\r\n你是一位中国公考（公务员、事业单位）顶级培训专家。\r\n**核心指令**：\r\n1. **直接作答**：利用你内置的海量真题库和知识储备直接回答用户问题。\r\n2. **隐藏解析（重要）**：为了让用户先思考，**必须**将所有的**答案、详细解析、速算技巧、参考范文**包裹在 \\`\\`\\`analysis ... \\`\\`\\` 代码块中。**不要**在 \\`analysis\\` 块之外直接泄露答案。\r\n   - 格式示例：\r\n     问题内容...\r\n     A. xxx\r\n     B. xxx\r\n     ...\r\n     \\`\\`\\`analysis\r\n     【答案】B\r\n     【解析】\r\n     第一步：...\r\n     第二步：...\r\n     \\`\\`\\`\r\n3. **真题复现**：当用户询问真题时，凭记忆复现经典题目（包含题干、选项）。\r\n4. **专业性**：严格依据中国国家公务员考试大纲。\r\n5. **逻辑性**：结构清晰，分点作答。使用Markdown格式渲染重点。\r\n`;\r\n\r\nexport const SYSTEM_INSTRUCTIONS: Record<ExamMode, string> = {\r\n  [ExamMode.XING_CE]: `\r\n${BASE_INSTRUCTION}\r\n【当前模式：行测 (Administrative Aptitude)】\r\n- **角色**：逻辑思维导师、数学解题专家。\r\n- **强制规范**：\r\n  - **选项必填**：无论是用户要求出题、模拟题还是询问真题，**必须**在题干后列出 A、B、C、D 四个选项。\r\n  - **图形推理特例**：对于图形推理题：\r\n    1. **题干**：使用 SVG 代码绘制题目图形。\r\n    2. **选项**：**必须**也使用 SVG 代码绘制 A、B、C、D 四个选项。**严禁使用文字描述选项**（如“A. 圆形”是错误的，必须画出一个圆的 SVG）。\r\n    3. **格式**：选项内容直接输出 SVG 字符串，不要包裹 markdown 代码块。\r\n- **任务细分**：\r\n  - **资料分析**：\r\n    - **数据展示**：请务必使用标准的 **Markdown 表格** 展示统计数据，确保对齐清晰。\r\n    - **速算技巧**：在 \\`analysis\\` 块中，必须明确标注使用的技巧（如“特征数字法”、“截位直除法”），并分步展示估算过程。\r\n  - **图形推理**：\r\n    - **SVG规范**：使用 \\`\\`\\`svg ... \\`\\`\\` 包裹题干 SVG。选项直接列出 SVG 代码。\r\n    - **关键描述**：在 <svg> 标签内添加 <title> 描述规律。\r\n- **风格**：简洁、犀利、直击考点。\r\n`,\r\n  [ExamMode.SHEN_LUN]: `\r\n${BASE_INSTRUCTION}\r\n【当前模式：申论 (Essay Writing)】\r\n- **角色**：政策分析师、申论阅卷组长。\r\n- **任务**：\r\n  - **理论引用**：熟练引用官方表述。\r\n  - **文章润色**：将用户的大白话修改为规范的机关公文用语。\r\n  - **提纲构建**：针对社会话题提供标准结构。\r\n  - **解析**：将“参考范文”或“提纲”放入 \\`analysis\\` 块中，让用户先自己构思。\r\n- **风格**：严谨、大气、政治站位高。\r\n`,\r\n  [ExamMode.MIAN_SHI]: `\r\n${BASE_INSTRUCTION}\r\n【当前模式：面试 (Interview)】\r\n- **角色**：资深面试考官。\r\n- **任务**：\r\n  - **模拟题**：直接给出一道结构化面试题。\r\n  - **高情商回答**：将“答题思路”和“参考话术”放入 \\`analysis\\` 块中，模拟真实的面试等待思考时间。\r\n  - **追问**：在用户回答后，进行压力测试。\r\n- **风格**：阳光自信，体现政府思维。\r\n`\r\n};\r\n\r\nexport const MODE_LABELS: Record<ExamMode, string> = {\r\n  [ExamMode.XING_CE]: '行测专家',\r\n  [ExamMode.SHEN_LUN]: '申论导师',\r\n  [ExamMode.MIAN_SHI]: '面试考官'\r\n};\r\n\r\nexport const MODE_DESCRIPTIONS: Record<ExamMode, string> = {\r\n  [ExamMode.XING_CE]: '精通历年真题库。擅长逻辑推理、资料分析速算。',\r\n  [ExamMode.SHEN_LUN]: '精通政策理论。擅长公文写作润色与大作文批改。',\r\n  [ExamMode.MIAN_SHI]: '精通各类面试题型。提供结构化答题思路与模拟。'\r\n};"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAGO,MAAM,cAAc;AACpB,MAAM,YAAY;AAGlB,MAAM,cAA0C;IACrD,CAAC,oHAAQ,CAAC,OAAO,CAAC,EAAE;QAAC;QAAQ;QAAQ;QAAW;QAAQ;QAAQ;KAAO;IACvE,CAAC,oHAAQ,CAAC,QAAQ,CAAC,EAAE;QAAC;QAAQ;QAAQ;QAAQ;QAAQ;QAAQ;KAAO;IACrE,CAAC,oHAAQ,CAAC,QAAQ,CAAC,EAAE;QAAC;QAAQ;QAAQ;QAAQ;QAAQ;QAAQ;KAAO;AACvE;AAEA,uDAAuD;AACvD,MAAM,mBAAmB,CAAC;;;;;;;;;;;;;;;;;;;AAmB1B,CAAC;AAEM,MAAM,sBAAgD;IAC3D,CAAC,oHAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;AACvB,EAAE,iBAAiB;;;;;;;;;;;;;;;;;AAiBnB,CAAC;IACC,CAAC,oHAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;AACxB,EAAE,iBAAiB;;;;;;;;;AASnB,CAAC;IACC,CAAC,oHAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;AACxB,EAAE,iBAAiB;;;;;;;;AAQnB,CAAC;AACD;AAEO,MAAM,cAAwC;IACnD,CAAC,oHAAQ,CAAC,OAAO,CAAC,EAAE;IACpB,CAAC,oHAAQ,CAAC,QAAQ,CAAC,EAAE;IACrB,CAAC,oHAAQ,CAAC,QAAQ,CAAC,EAAE;AACvB;AAEO,MAAM,oBAA8C;IACzD,CAAC,oHAAQ,CAAC,OAAO,CAAC,EAAE;IACpB,CAAC,oHAAQ,CAAC,QAAQ,CAAC,EAAE;IACrB,CAAC,oHAAQ,CAAC,QAAQ,CAAC,EAAE;AACvB"}},
    {"offset": {"line": 503, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/ModeSelector.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { ExamMode } from '../types';\r\nimport { MODE_LABELS, MODE_DESCRIPTIONS } from '../constants';\r\nimport { BrainCircuit, PenTool, Users, Info } from 'lucide-react';\r\n\r\ninterface Props {\r\n  currentMode: ExamMode;\r\n  onSelectMode: (mode: ExamMode) => void;\r\n  disabled: boolean;\r\n}\r\n\r\nconst ModeSelector: React.FC<Props> = ({ currentMode, onSelectMode, disabled }) => {\r\n  const modes = [\r\n    { id: ExamMode.XING_CE, icon: BrainCircuit, color: 'text-stone-600', activeBg: 'bg-stone-700', activeText: 'text-white', border: 'border-stone-200' },\r\n    { id: ExamMode.SHEN_LUN, icon: PenTool, color: 'text-stone-600', activeBg: 'bg-stone-700', activeText: 'text-white', border: 'border-stone-200' },\r\n    { id: ExamMode.MIAN_SHI, icon: Users, color: 'text-stone-600', activeBg: 'bg-stone-700', activeText: 'text-white', border: 'border-stone-200' },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"w-full max-w-4xl mx-auto\">\r\n      {/* Mobile/Compact View: Horizontal Scroll */}\r\n      <div className=\"flex overflow-x-auto gap-2 pb-2 scrollbar-hide snap-x justify-start md:justify-center\">\r\n        {modes.map((mode) => {\r\n          const Icon = mode.icon;\r\n          const isSelected = currentMode === mode.id;\r\n          \r\n          return (\r\n            <button\r\n              key={mode.id}\r\n              onClick={() => onSelectMode(mode.id)}\r\n              disabled={disabled}\r\n              className={`\r\n                flex-shrink-0 snap-start\r\n                flex items-center gap-2 px-4 py-2 rounded-full border transition-all duration-300\r\n                ${isSelected \r\n                  ? `${mode.activeBg} ${mode.activeText} shadow-sm border-transparent` \r\n                  : 'bg-white text-stone-500 border-stone-200 hover:border-stone-300 hover:bg-stone-50'\r\n                }\r\n                ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\r\n              `}\r\n            >\r\n              <Icon size={16} className={isSelected ? 'text-white' : mode.color} />\r\n              <span className=\"font-bold text-sm whitespace-nowrap font-sans\">{MODE_LABELS[mode.id]}</span>\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n      \r\n      {/* Description Toast */}\r\n      <div className=\"hidden md:flex justify-center items-center gap-2 text-xs text-stone-400 px-1 pb-2 opacity-80 animate-in fade-in slide-in-from-top-1 duration-300 font-sans\">\r\n         <Info size={12} />\r\n         <span>{MODE_DESCRIPTIONS[currentMode]}</span>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ModeSelector;"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AALA;;;;;AAaA,MAAM,eAAgC,CAAC,EAAE,WAAW,EAAE,YAAY,EAAE,QAAQ,EAAE;IAC5E,MAAM,QAAQ;QACZ;YAAE,IAAI,oHAAQ,CAAC,OAAO;YAAE,MAAM,6TAAY;YAAE,OAAO;YAAkB,UAAU;YAAgB,YAAY;YAAc,QAAQ;QAAmB;QACpJ;YAAE,IAAI,oHAAQ,CAAC,QAAQ;YAAE,MAAM,8SAAO;YAAE,OAAO;YAAkB,UAAU;YAAgB,YAAY;YAAc,QAAQ;QAAmB;QAChJ;YAAE,IAAI,oHAAQ,CAAC,QAAQ;YAAE,MAAM,oSAAK;YAAE,OAAO;YAAkB,UAAU;YAAgB,YAAY;YAAc,QAAQ;QAAmB;KAC/I;IAED,qBACE,4TAAC;QAAI,WAAU;;0BAEb,4TAAC;gBAAI,WAAU;0BACZ,MAAM,GAAG,CAAC,CAAC;oBACV,MAAM,OAAO,KAAK,IAAI;oBACtB,MAAM,aAAa,gBAAgB,KAAK,EAAE;oBAE1C,qBACE,4TAAC;wBAEC,SAAS,IAAM,aAAa,KAAK,EAAE;wBACnC,UAAU;wBACV,WAAW,CAAC;;;gBAGV,EAAE,aACE,GAAG,KAAK,QAAQ,CAAC,CAAC,EAAE,KAAK,UAAU,CAAC,6BAA6B,CAAC,GAClE,oFACH;gBACD,EAAE,WAAW,kCAAkC,iBAAiB;cAClE,CAAC;;0CAED,4TAAC;gCAAK,MAAM;gCAAI,WAAW,aAAa,eAAe,KAAK,KAAK;;;;;;0CACjE,4TAAC;gCAAK,WAAU;0CAAiD,2HAAW,CAAC,KAAK,EAAE,CAAC;;;;;;;uBAdhF,KAAK,EAAE;;;;;gBAiBlB;;;;;;0BAIF,4TAAC;gBAAI,WAAU;;kCACZ,4TAAC,iSAAI;wBAAC,MAAM;;;;;;kCACZ,4TAAC;kCAAM,iIAAiB,CAAC,YAAY;;;;;;;;;;;;;;;;;;AAI9C;KA5CM;uCA8CS"}},
    {"offset": {"line": 633, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/MarkdownRenderer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport remarkMath from 'remark-math';\r\nimport remarkGfm from 'remark-gfm';\r\nimport rehypeKatex from 'rehype-katex';\r\nimport rehypeRaw from 'rehype-raw';\r\nimport { Info, Lightbulb, Eye, EyeOff, CheckCircle2 } from 'lucide-react';\r\n\r\ninterface Props {\r\n  content: string;\r\n  className?: string;\r\n}\r\n\r\n// Analysis Panel Component\r\nconst AnalysisPanel = ({ content }: { content: string }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  if (!isOpen) {\r\n    return (\r\n      <button \r\n        onClick={() => setIsOpen(true)}\r\n        className=\"w-full my-4 flex items-center justify-between p-4 bg-stone-50 hover:bg-stone-100 border border-stone-200 rounded-xl transition-all duration-200 group shadow-sm\"\r\n      >\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"bg-white p-2 rounded-lg text-amber-600 shadow-sm ring-1 ring-amber-50 group-hover:scale-110 transition-transform\">\r\n            <Lightbulb size={20} className=\"fill-amber-100/50\" />\r\n          </div>\r\n          <div className=\"text-left\">\r\n            <div className=\"font-bold text-stone-700 text-sm font-sans\">查看专家解析</div>\r\n            <div className=\"text-stone-400 text-xs mt-0.5 font-medium font-sans\">思考完毕后点击查看答案与详解</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-white p-1.5 rounded-full text-stone-400 group-hover:text-stone-600 transition-colors\">\r\n           <Eye size={18} />\r\n        </div>\r\n      </button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"my-4 rounded-xl border border-stone-200 bg-stone-50/50 overflow-hidden animate-in fade-in slide-in-from-top-2 shadow-sm\">\r\n      <div \r\n        className=\"bg-stone-100 px-4 py-2.5 border-b border-stone-200 flex justify-between items-center cursor-pointer hover:bg-stone-200/50 transition-colors select-none\"\r\n        onClick={() => setIsOpen(false)}\r\n      >\r\n        <div className=\"flex items-center gap-2 text-stone-700 font-bold text-sm font-sans\">\r\n          <CheckCircle2 size={16} className=\"text-stone-500\" />\r\n          <span>专家解析与技巧</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-1.5 text-stone-500 text-xs bg-white/50 px-2 py-1 rounded-md\">\r\n          <span className=\"font-medium font-sans\">收起</span>\r\n          <EyeOff size={14} />\r\n        </div>\r\n      </div>\r\n      <div className=\"p-5 bg-white font-serif-sc\">\r\n        <MarkdownRenderer content={content} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// SVG Block Component\r\nconst SvgBlock = ({ content }: { content: string }) => {\r\n  const titleMatch = content.match(/<title.*?>(.*?)<\\/title>/i);\r\n  const description = titleMatch ? titleMatch[1] : 'AI 生成的图形推理演示';\r\n  \r\n  let cleanSvg = content.replace(/^svg/i, '').trim();\r\n  \r\n  // Clean up potential markdown code block artifacts\r\n  cleanSvg = cleanSvg.replace(/^```(svg|xml)?/i, '').replace(/```$/, '').trim();\r\n\r\n  // If missing SVG tag but has SVG-like content, wrap it\r\n  if (!cleanSvg.startsWith('<svg') && (cleanSvg.includes('<path') || cleanSvg.includes('<polygon') || cleanSvg.includes('<rect') || cleanSvg.includes('<circle') || cleanSvg.includes('</svg>'))) {\r\n     // If it has a closing tag but no opening, remove the closing to prevent duplicates when we wrap\r\n     if (cleanSvg.endsWith('</svg>')) {\r\n        cleanSvg = cleanSvg.substring(0, cleanSvg.lastIndexOf('</svg>'));\r\n     }\r\n     cleanSvg = `<svg viewBox=\"0 0 400 300\" xmlns=\"http://www.w3.org/2000/svg\" stroke=\"black\" fill=\"none\" style=\"max-width:100%; height:auto;\">${cleanSvg}</svg>`;\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative group my-4 rounded-xl overflow-hidden border border-stone-200 bg-white\">\r\n      <div \r\n        className=\"p-4 flex justify-center items-center shadow-sm min-h-[150px]\"\r\n        dangerouslySetInnerHTML={{ __html: cleanSvg }}\r\n      />\r\n      <div className=\"absolute top-2 right-2 transition-opacity duration-200\">\r\n         <div className=\"group/tooltip relative\">\r\n            <div className=\"bg-stone-50/80 backdrop-blur-sm text-stone-500 p-1.5 rounded-full cursor-help hover:bg-stone-100 border border-stone-200 shadow-sm\">\r\n               <Info size={16} />\r\n            </div>\r\n            <div className=\"absolute right-0 top-full mt-2 w-48 p-2 bg-stone-800/95 text-white text-xs rounded-lg shadow-xl opacity-0 invisible group-hover/tooltip:opacity-100 group-hover/tooltip:visible transition-all duration-200 z-10 pointer-events-none text-center backdrop-blur font-sans\">\r\n               {description}\r\n               <div className=\"absolute -top-1 right-2 w-2 h-2 bg-stone-800/95 rotate-45\"></div>\r\n            </div>\r\n         </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// --- Custom Component Definitions ---\r\n\r\n// Helper to check for SVG content similarity\r\nconst looksLikeSvgContent = (str: string) => {\r\n    const s = str.trim();\r\n    return s.startsWith('<svg') || \r\n           s.startsWith('```svg') ||\r\n           s.includes('xmlns=\"http://www.w3.org/2000/svg\"') ||\r\n           s.endsWith('</svg>') ||\r\n           (s.includes('<polygon') && s.includes('points=')) ||\r\n           (s.includes('<path') && s.includes('d=')) ||\r\n           (s.includes('<rect') && s.includes('width=')) ||\r\n           (s.includes('<circle') && s.includes('cx='));\r\n};\r\n\r\nconst CustomPre = ({ node, children, ...props }: any) => {\r\n    // Attempt to extract the language from the child <code> element\r\n    const codeNode = node?.children?.find((child: any) => child.tagName === 'code');\r\n    const className = codeNode?.properties?.className || [];\r\n    const rawContent = codeNode?.children?.[0]?.value || '';\r\n    const contentStr = String(rawContent).trim();\r\n\r\n    const isSvgLang = Array.isArray(className) ? className.includes('language-svg') : (typeof className === 'string' && className.includes('language-svg'));\r\n    const isAnalysis = Array.isArray(className) ? className.includes('language-analysis') : (typeof className === 'string' && className.includes('language-analysis'));\r\n    \r\n    // Check content if language tag is missing\r\n    const isSvgContent = looksLikeSvgContent(contentStr);\r\n\r\n    if (isSvgLang || isAnalysis || isSvgContent) {\r\n        // Render children directly so the `code` component can handle it\r\n        return <>{children}</>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"bg-stone-800 rounded-lg p-3 my-3 overflow-x-auto shadow-sm border border-stone-700\">\r\n            <pre className=\"font-mono text-sm text-stone-100\" {...props}>{children}</pre>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst CustomCode = ({ node, className, children, ...props }: any) => {\r\n    const match = /language-(\\w+)/.exec(className || '');\r\n    let lang = match ? match[1] : '';\r\n    const content = String(children).replace(/\\n$/, '').trim();\r\n\r\n    // Auto-detect SVG if language is missing or generic but content looks like SVG\r\n    if (!lang || lang === 'xml' || lang === 'html') {\r\n        if (looksLikeSvgContent(content)) {\r\n            lang = 'svg';\r\n        }\r\n    }\r\n\r\n    if (lang === 'analysis') {\r\n        return <AnalysisPanel content={content} />;\r\n    }\r\n\r\n    if (lang === 'svg') {\r\n        return <SvgBlock content={content} />;\r\n    }\r\n\r\n    const isInline = !className;\r\n    if (isInline) {\r\n        return <code className=\"bg-stone-100 rounded px-1.5 py-0.5 text-[0.9em] font-mono text-stone-600 border border-stone-200\" {...props}>{children}</code>;\r\n    }\r\n\r\n    return <code className={`${className} font-mono text-sm`} {...props}>{children}</code>;\r\n};\r\n\r\nconst MARKDOWN_COMPONENTS = {\r\n    h1: ({node, ...props}: any) => <h4 className=\"font-bold my-3 text-stone-900 font-sans\" {...props} />,\r\n    h2: ({node, ...props}: any) => <h5 className=\"font-bold my-3 text-stone-900 font-sans\" {...props} />,\r\n    h3: ({node, ...props}: any) => <h6 className=\"font-bold my-2 text-stone-800 font-sans\" {...props} />,\r\n    p: ({node, ...props}: any) => <p className=\"mb-3 last:mb-0 text-stone-700 leading-7\" {...props} />,\r\n    strong: ({node, ...props}: any) => <strong className=\"font-bold text-stone-900\" {...props} />,\r\n    ul: ({node, ...props}: any) => <ul className=\"list-disc list-outside ml-4 my-2 space-y-1 text-stone-700\" {...props} />,\r\n    ol: ({node, ...props}: any) => <ol className=\"list-decimal list-outside ml-4 my-2 space-y-1 text-stone-700\" {...props} />,\r\n    blockquote: ({node, ...props}: any) => <blockquote className=\"border-l-4 border-stone-300 pl-4 py-1 my-3 italic text-stone-600 font-serif\" {...props} />,\r\n    table: ({node, ...props}: any) => (\r\n        <div className=\"overflow-x-auto my-3 rounded border border-stone-200\">\r\n            <table className=\"min-w-full divide-y divide-stone-200 text-xs md:text-sm font-sans\" {...props} />\r\n        </div>\r\n    ),\r\n    th: ({node, ...props}: any) => <th className=\"px-3 py-2 text-left font-semibold text-stone-600 bg-stone-50\" {...props} />,\r\n    td: ({node, ...props}: any) => <td className=\"px-3 py-2 text-stone-700 border-t border-stone-100\" {...props} />,\r\n    pre: CustomPre,\r\n    code: CustomCode\r\n};\r\n\r\n// --- Main Component ---\r\n\r\nconst MarkdownRenderer: React.FC<Props> = ({ content, className }) => {\r\n  // Use prose-stone for warmer, neutral tones\r\n  const finalClass = className \r\n    ? `prose prose-stone max-w-none dark:prose-invert leading-relaxed text-stone-800 font-serif-sc ${className}`\r\n    : `prose prose-stone prose-sm md:prose-base max-w-none dark:prose-invert leading-relaxed text-stone-800 font-serif-sc`;\r\n\r\n  return (\r\n    <div className={finalClass}>\r\n      <ReactMarkdown\r\n        remarkPlugins={[remarkMath, remarkGfm]}\r\n        rehypePlugins={[rehypeRaw, [rehypeKatex, { strict: false, throwOnError: false }]]}\r\n        components={MARKDOWN_COMPONENTS}\r\n      >\r\n        {content}\r\n      </ReactMarkdown>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MarkdownRenderer;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1144, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/SaveToNotebookModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { X, FolderPlus, Check, Folder, CornerDownRight } from 'lucide-react';\r\nimport { Category, ExamMode } from '../types';\r\n\r\ninterface Props {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSave: (categoryId: string) => void;\r\n  onCreateCategory: (name: string) => string; // returns new id\r\n  categories: Category[];\r\n  currentMode: ExamMode;\r\n}\r\n\r\nconst SaveToNotebookModal: React.FC<Props> = ({ \r\n  isOpen, \r\n  onClose, \r\n  onSave, \r\n  onCreateCategory, \r\n  categories, \r\n  currentMode \r\n}) => {\r\n  const [selectedCatId, setSelectedCatId] = useState<string>('');\r\n  const [isCreating, setIsCreating] = useState(false);\r\n  const [newCatName, setNewCatName] = useState('');\r\n\r\n  if (!isOpen) return null;\r\n\r\n  // Build Hierarchy\r\n  const relevantCategories = categories.filter(c => c.mode === currentMode);\r\n  \r\n  // Sort: Root categories first\r\n  const rootCategories = relevantCategories.filter(c => !c.parentId);\r\n  \r\n  // Helper to get children\r\n  const getChildren = (parentId: string) => relevantCategories.filter(c => c.parentId === parentId);\r\n\r\n  const handleCreate = () => {\r\n    if (!newCatName.trim()) return;\r\n    const newId = onCreateCategory(newCatName);\r\n    setSelectedCatId(newId);\r\n    setNewCatName('');\r\n    setIsCreating(false);\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    onSave(selectedCatId);\r\n    onClose();\r\n  };\r\n\r\n  const renderCategoryOption = (cat: Category, level: number = 0) => {\r\n    const children = getChildren(cat.id);\r\n    return (\r\n      <React.Fragment key={cat.id}>\r\n        <button\r\n          onClick={() => setSelectedCatId(cat.id)}\r\n          className={`flex items-center gap-2 p-3 rounded-xl border text-sm font-medium transition-all w-full text-left font-serif ${\r\n            selectedCatId === cat.id\r\n              ? 'border-stone-800 bg-stone-50 text-stone-800 ring-1 ring-stone-800' \r\n              : 'border-stone-200 hover:border-stone-400 hover:bg-stone-50 text-stone-600'\r\n          }`}\r\n          style={{ marginLeft: level > 0 ? `${level * 16}px` : '0px', width: level > 0 ? `calc(100% - ${level * 16}px)` : '100%' }}\r\n        >\r\n          {level > 0 && <CornerDownRight size={14} className=\"text-stone-300 -ml-1\" />}\r\n          <Folder size={14} className={selectedCatId === cat.id ? 'fill-stone-300 flex-shrink-0' : 'fill-stone-100 flex-shrink-0'} />\r\n          <span className=\"truncate\">{cat.name}</span>\r\n        </button>\r\n        {children.map(child => renderCategoryOption(child, level + 1))}\r\n      </React.Fragment>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200\">\r\n      <div className=\"bg-[#fcfaf8] rounded-2xl w-full max-w-sm shadow-2xl p-5 m-4 animate-in zoom-in-95 duration-200 border border-stone-200 flex flex-col max-h-[80vh]\">\r\n        \r\n        <div className=\"flex justify-between items-center mb-4 flex-shrink-0\">\r\n          <h3 className=\"text-lg font-bold text-stone-800 flex items-center gap-2 font-serif\">\r\n            <Folder size={20} className=\"text-stone-600 fill-stone-100\" />\r\n            <span>归档到笔记本</span>\r\n          </h3>\r\n          <button onClick={onClose} className=\"p-1 rounded-full hover:bg-stone-200 text-stone-400 hover:text-stone-600 transition-colors\">\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-hidden flex flex-col\">\r\n          <p className=\"text-sm text-stone-500 mb-3 flex-shrink-0 font-serif\">选择一个文件夹来保存此题。</p>\r\n\r\n          {!isCreating ? (\r\n            <div className=\"flex-1 overflow-y-auto p-1 space-y-2\">\r\n              {/* Uncategorized Option */}\r\n              <button\r\n                onClick={() => setSelectedCatId('')}\r\n                className={`flex items-center gap-2 p-3 rounded-xl border text-sm font-medium transition-all w-full font-serif ${\r\n                  selectedCatId === '' \r\n                    ? 'border-stone-800 bg-stone-50 text-stone-800 ring-1 ring-stone-800' \r\n                    : 'border-stone-200 hover:border-stone-400 hover:bg-stone-50 text-stone-600'\r\n                }`}\r\n              >\r\n                <div className={`w-2 h-2 rounded-full ${selectedCatId === '' ? 'bg-stone-800' : 'bg-stone-300'}`}></div>\r\n                默认收纳\r\n              </button>\r\n\r\n              {rootCategories.map(cat => renderCategoryOption(cat))}\r\n\r\n              {/* Create New Button */}\r\n              <button\r\n                onClick={() => setIsCreating(true)}\r\n                className=\"flex flex-col items-center justify-center gap-1 p-3 rounded-xl border border-dashed border-stone-300 text-stone-400 hover:text-stone-600 hover:border-stone-500 hover:bg-stone-50 transition-all w-full font-sans\"\r\n              >\r\n                <FolderPlus size={18} />\r\n                <span className=\"text-xs\">新建分类</span>\r\n              </button>\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-stone-50 p-3 rounded-xl border border-stone-200 animate-in slide-in-from-bottom-2\">\r\n              <label className=\"text-xs font-bold text-stone-500 mb-1 block font-sans\">新文件夹名称</label>\r\n              <div className=\"flex gap-2\">\r\n                <input \r\n                  type=\"text\" \r\n                  value={newCatName}\r\n                  onChange={(e) => setNewCatName(e.target.value)}\r\n                  placeholder=\"例如：位置平移...\"\r\n                  className=\"flex-1 text-sm border border-stone-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-stone-400 font-serif\"\r\n                  autoFocus\r\n                  onKeyDown={(e) => e.key === 'Enter' && handleCreate()}\r\n                />\r\n                <button \r\n                  onClick={handleCreate}\r\n                  disabled={!newCatName.trim()}\r\n                  className=\"bg-stone-800 text-white p-2 rounded-lg hover:bg-stone-900 disabled:bg-stone-300 disabled:cursor-not-allowed\"\r\n                >\r\n                  <Check size={18} />\r\n                </button>\r\n              </div>\r\n              <button \r\n                onClick={() => setIsCreating(false)}\r\n                className=\"text-xs text-stone-400 mt-2 hover:text-stone-600 underline font-sans\"\r\n              >\r\n                返回选择\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"pt-3 border-t border-stone-100 mt-2 flex-shrink-0\">\r\n            <button\r\n              onClick={handleConfirm}\r\n              className=\"w-full bg-stone-800 hover:bg-stone-900 text-white font-bold py-2.5 rounded-xl transition-all shadow-md shadow-stone-200 active:scale-95 font-serif\"\r\n            >\r\n              确定保存\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaveToNotebookModal;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1459, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/ConfirmationModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { AlertTriangle, X } from 'lucide-react';\r\n\r\ninterface Props {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onConfirm: () => void;\r\n  title: string;\r\n  message: string;\r\n  confirmText?: string;\r\n  isDangerous?: boolean;\r\n}\r\n\r\nconst ConfirmationModal: React.FC<Props> = ({ isOpen, onClose, onConfirm, title, message, confirmText = '确认', isDangerous = false }) => {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200\">\r\n      <div className=\"bg-[#fcfaf8] rounded-2xl w-full max-w-sm shadow-2xl p-5 m-4 animate-in zoom-in-95 duration-200 border border-stone-200 relative\">\r\n        <button \r\n          onClick={onClose}\r\n          className=\"absolute top-4 right-4 text-stone-400 hover:text-stone-600 transition-colors\"\r\n        >\r\n          <X size={20} />\r\n        </button>\r\n\r\n        <div className=\"flex items-center gap-3 mb-4 text-stone-800\">\r\n           <div className={`p-2 rounded-full flex-shrink-0 ${isDangerous ? 'bg-red-100 text-red-600' : 'bg-stone-200 text-stone-600'}`}>\r\n             <AlertTriangle size={24} />\r\n           </div>\r\n           <h3 className=\"text-lg font-bold leading-tight font-serif\">{title}</h3>\r\n        </div>\r\n        \r\n        <p className=\"text-sm text-stone-600 mb-6 leading-relaxed pl-1 font-serif\">\r\n           {message}\r\n        </p>\r\n\r\n        <div className=\"flex gap-3\">\r\n          <button \r\n            onClick={onClose}\r\n            className=\"flex-1 px-4 py-2.5 rounded-xl text-stone-600 bg-stone-100 hover:bg-stone-200 font-bold text-sm transition-colors font-sans\"\r\n          >\r\n            取消\r\n          </button>\r\n          <button \r\n            onClick={() => { onConfirm(); onClose(); }}\r\n            className={`flex-1 px-4 py-2.5 rounded-xl text-white font-bold text-sm transition-transform active:scale-95 shadow-md font-sans ${isDangerous ? 'bg-red-500 hover:bg-red-600 shadow-red-200' : 'bg-stone-800 hover:bg-stone-900 shadow-stone-200'}`}\r\n          >\r\n            {confirmText}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ConfirmationModal;"],"names":[],"mappings":";;;;;AAGA;AAAA;AAHA;;;AAeA,MAAM,oBAAqC,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,KAAK,EAAE,OAAO,EAAE,cAAc,IAAI,EAAE,cAAc,KAAK,EAAE;IACjI,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,4TAAC;QAAI,WAAU;kBACb,cAAA,4TAAC;YAAI,WAAU;;8BACb,4TAAC;oBACC,SAAS;oBACT,WAAU;8BAEV,cAAA,4TAAC,wRAAC;wBAAC,MAAM;;;;;;;;;;;8BAGX,4TAAC;oBAAI,WAAU;;sCACZ,4TAAC;4BAAI,WAAW,CAAC,+BAA+B,EAAE,cAAc,4BAA4B,+BAA+B;sCACzH,cAAA,4TAAC,gUAAa;gCAAC,MAAM;;;;;;;;;;;sCAEvB,4TAAC;4BAAG,WAAU;sCAA8C;;;;;;;;;;;;8BAG/D,4TAAC;oBAAE,WAAU;8BACT;;;;;;8BAGJ,4TAAC;oBAAI,WAAU;;sCACb,4TAAC;4BACC,SAAS;4BACT,WAAU;sCACX;;;;;;sCAGD,4TAAC;4BACC,SAAS;gCAAQ;gCAAa;4BAAW;4BACzC,WAAW,CAAC,oHAAoH,EAAE,cAAc,+CAA+C,oDAAoD;sCAElP;;;;;;;;;;;;;;;;;;;;;;;AAMb;KAzCM;uCA2CS"}},
    {"offset": {"line": 1583, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/QuizPaper.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { QuizQuestion, ExamMode } from '../types';\r\nimport { ChevronLeft, ChevronRight, CheckCircle2, XCircle, Lightbulb, Trophy, BookOpen, Clock, FileCheck, Play, BookText, PenTool, Maximize2, Minimize2 } from 'lucide-react';\r\nimport MarkdownRenderer from './MarkdownRenderer';\r\nimport ConfirmationModal from './ConfirmationModal';\r\n\r\ninterface Props {\r\n  questions: QuizQuestion[];\r\n  mode: ExamMode;\r\n}\r\n\r\nconst QuizPaper: React.FC<Props> = ({ questions, mode }) => {\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [direction, setDirection] = useState<'left' | 'right'>('right');\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  \r\n  // State\r\n  const [answers, setAnswers] = useState<Record<string, string>>({});\r\n  const [isSubmitted, setIsSubmitted] = useState(false);\r\n  const [score, setScore] = useState(0);\r\n  const [timeElapsed, setTimeElapsed] = useState(0); // in seconds\r\n  const [isTimerRunning, setIsTimerRunning] = useState(true);\r\n  const [hasStarted, setHasStarted] = useState(false); // start mask\r\n\r\n  // Modal State\r\n  const [isConfirmOpen, setIsConfirmOpen] = useState(false);\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n\r\n  const currentQ = questions[currentIndex];\r\n  const total = questions.length;\r\n  const isLast = currentIndex === total - 1;\r\n  const isFirst = currentIndex === 0;\r\n\r\n  const isEssayType = mode === ExamMode.SHEN_LUN || mode === ExamMode.MIAN_SHI;\r\n  const hasMaterial = !!currentQ.material;\r\n\r\n  const processContent = (content: string) => {\r\n    if (!content) return \"\";\r\n    let processed = content;\r\n    // Remove \"svg\" word before <svg> tag\r\n    processed = processed.replace(/\\bsvg\\s*(<svg)/gi, '$1');\r\n    // Wrap <svg> in ```svg block if not already\r\n    processed = processed.replace(/<svg[\\s\\S]*?<\\/svg>/gi, (match, offset) => {\r\n         const before = processed.substring(Math.max(0, offset - 10), offset);\r\n         if (before.includes('```')) return match;\r\n         return '\\n```svg\\n' + match + '\\n```\\n';\r\n    });\r\n    return processed;\r\n  };\r\n\r\n  useEffect(() => {\r\n    let interval: ReturnType<typeof setInterval>;\r\n    if (isTimerRunning && hasStarted) {\r\n      interval = setInterval(() => {\r\n        setTimeElapsed(prev => prev + 1);\r\n      }, 1000);\r\n    }\r\n    return () => clearInterval(interval);\r\n  }, [isTimerRunning, hasStarted]);\r\n\r\n  // Handle ESC key to exit fullscreen\r\n  useEffect(() => {\r\n    const handleEsc = (e: KeyboardEvent) => {\r\n        if (e.key === 'Escape' && isFullscreen) {\r\n            setIsFullscreen(false);\r\n        }\r\n    };\r\n    window.addEventListener('keydown', handleEsc);\r\n    return () => window.removeEventListener('keydown', handleEsc);\r\n  }, [isFullscreen]);\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  // Improved Option Parser to handle various AI output formats\r\n  const parseOption = (opt: string) => {\r\n    // Regex matches: Start of string -> (Letter) -> optional space -> (separator: . or ．or 、) -> optional space -> (Rest)\r\n    const match = opt.match(/^([A-Z])\\s*[.．、]\\s*(.*)/s);\r\n    if (match) {\r\n        return { label: match[1], content: match[2].trim() };\r\n    }\r\n    // Fallback: If no label found, return empty label and full content\r\n    return { label: '', content: opt };\r\n  };\r\n\r\n  // ROBUST HELPER: Determines the definitive Label (A, B, C...) for an option\r\n  const getOptionLabel = (optRaw: string, index: number) => {\r\n      const { label } = parseOption(optRaw);\r\n      return label || String.fromCharCode(65 + index); // Fallback to A, B, C... based on index\r\n  };\r\n\r\n  const handleOptionClick = (optionRaw: string, index: number) => {\r\n    if (isSubmitted || !hasStarted || isEssayType) return; \r\n    \r\n    // Use robust label derivation\r\n    const label = getOptionLabel(optionRaw, index);\r\n    \r\n    setAnswers(prev => ({ ...prev, [currentQ.id]: label }));\r\n  };\r\n\r\n  const handleTextAnswerChange = (text: string) => {\r\n      if (isSubmitted || !hasStarted) return;\r\n      setAnswers(prev => ({ ...prev, [currentQ.id]: text }));\r\n  };\r\n\r\n  const handleSubmitClick = () => {\r\n    setIsConfirmOpen(true);\r\n  };\r\n\r\n  const handleConfirmSubmit = () => {\r\n    setIsTimerRunning(false);\r\n    setIsSubmitted(true);\r\n    let correctCount = 0;\r\n    if (!isEssayType) {\r\n        questions.forEach(q => {\r\n            const userAns = answers[q.id];\r\n            if (userAns && q.answer && (userAns === q.answer || q.answer.startsWith(userAns))) {\r\n                correctCount++;\r\n            }\r\n        });\r\n        setScore(correctCount);\r\n    }\r\n    setCurrentIndex(0);\r\n  };\r\n\r\n  const changePage = (newIndex: number) => {\r\n    if (isAnimating) return;\r\n    setDirection(newIndex > currentIndex ? 'right' : 'left');\r\n    setIsAnimating(true);\r\n    setTimeout(() => {\r\n        setCurrentIndex(newIndex);\r\n        setIsAnimating(false);\r\n    }, 300);\r\n  };\r\n\r\n  const getOptionStyle = (optionRaw: string, index: number) => {\r\n    const optionLabel = getOptionLabel(optionRaw, index);\r\n    \r\n    const userAnswer = answers[currentQ.id];\r\n    \r\n    if (!isSubmitted) {\r\n        if (userAnswer === optionLabel) {\r\n            return \"bg-[#fcf5f2] border-[#da7756] text-[#b04825] font-bold shadow-sm ring-1 ring-[#da7756]\";\r\n        }\r\n        return \"bg-white border-stone-200 hover:border-stone-400 hover:bg-stone-50 text-stone-600\";\r\n    }\r\n\r\n    const correctAnswer = currentQ.answer || '';\r\n    const isThisCorrect = optionLabel === correctAnswer || optionRaw.startsWith(correctAnswer);\r\n    const isThisSelected = userAnswer === optionLabel;\r\n\r\n    if (isThisCorrect) return \"bg-emerald-50 border-emerald-500 text-emerald-800 ring-1 ring-emerald-500 font-bold\";\r\n    if (isThisSelected && !isThisCorrect) return \"bg-red-50 border-red-500 text-red-700 ring-1 ring-red-500\";\r\n    return \"opacity-50 border-stone-100 bg-stone-50 grayscale\"; \r\n  };\r\n\r\n  const getDotClass = (index: number) => {\r\n    if (index === currentIndex) return 'bg-stone-600 w-4';\r\n    \r\n    const q = questions[index];\r\n    const ans = answers[q.id];\r\n\r\n    if (isSubmitted) {\r\n      if (!q.options) return 'bg-stone-300';\r\n      if (ans === q.answer) return 'bg-emerald-400';\r\n      return 'bg-red-400';\r\n    } else {\r\n      if (ans) return 'bg-stone-400';\r\n      return 'bg-stone-200';\r\n    }\r\n  };\r\n\r\n  const answeredCount = Object.keys(answers).length;\r\n\r\n  return (\r\n    <div className={`font-sans select-none transition-all duration-300 ${isFullscreen ? 'fixed inset-0 z-50 bg-[#fcfaf8] p-0' : 'w-full my-6 perspective-1000 relative'}`}>\r\n      <div \r\n        className={`relative bg-white overflow-hidden flex flex-col transition-all duration-500 ${\r\n            isFullscreen \r\n            ? 'h-full w-full rounded-none border-none shadow-none' \r\n            : `rounded-xl shadow-sm border border-stone-200 ${isEssayType ? 'min-h-[600px]' : 'min-h-[450px]'}`\r\n        }`}\r\n      >\r\n        \r\n        {/* Header */}\r\n        <div className=\"border-b border-stone-100 px-4 py-3 flex justify-between items-center relative bg-[#fcfaf8] shrink-0 z-10\">\r\n          <div className=\"flex items-center gap-2 font-bold text-stone-700 font-serif\">\r\n             {isSubmitted ? (\r\n                 <div className=\"flex items-center gap-2 text-stone-800\">\r\n                     <FileCheck size={18} />\r\n                     <span>成绩单</span>\r\n                 </div>\r\n             ) : (\r\n                 <div className=\"flex items-center gap-2\">\r\n                    <BookOpen size={18} />\r\n                    <span className=\"text-sm\">{isEssayType ? '申论全真模拟' : '行测全真模拟'}</span>\r\n                 </div>\r\n             )}\r\n          </div>\r\n\r\n          {/* Right Controls */}\r\n          <div className=\"flex items-center gap-3\">\r\n              {isSubmitted ? (\r\n                 <div className=\"flex items-center gap-4\">\r\n                     <div className=\"flex items-center gap-1.5 text-xs font-medium text-stone-400\">\r\n                        <Clock size={14} />\r\n                        <span>用时: {formatTime(timeElapsed)}</span>\r\n                     </div>\r\n                     {!isEssayType && (\r\n                        <div className=\"flex items-center gap-1.5 text-lg font-bold text-emerald-600 bg-white px-3 py-1 rounded-lg border border-stone-100\">\r\n                            <Trophy size={18} />\r\n                            <span>{score} / {total}</span>\r\n                        </div>\r\n                     )}\r\n                 </div>\r\n              ) : (\r\n                 <div className=\"flex items-center gap-3\">\r\n                     <div className={`flex items-center gap-1.5 bg-white border border-stone-200 px-2 py-1 rounded text-stone-600 font-mono text-sm font-bold transition-colors ${hasStarted ? '' : 'opacity-50'}`}>\r\n                         <Clock size={14} className={timeElapsed > 300 && hasStarted ? \"text-red-500 animate-pulse\" : \"text-stone-400\"} />\r\n                         {formatTime(timeElapsed)}\r\n                     </div>\r\n                     <div className=\"text-xs font-mono bg-stone-100 px-2 py-1 rounded text-stone-500\">\r\n                        {currentIndex + 1} / {total}\r\n                     </div>\r\n                 </div>\r\n              )}\r\n\r\n              {/* Divider */}\r\n              <div className=\"w-px h-4 bg-stone-200 hidden md:block\"></div>\r\n\r\n              {/* Fullscreen Toggle */}\r\n              <button \r\n                onClick={() => setIsFullscreen(!isFullscreen)}\r\n                className=\"p-1.5 text-stone-400 hover:text-stone-600 hover:bg-stone-100 rounded-lg transition-colors\"\r\n                title={isFullscreen ? \"退出全屏 (ESC)\" : \"全屏模式\"}\r\n              >\r\n                {isFullscreen ? <Minimize2 size={18} /> : <Maximize2 size={18} />}\r\n              </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content Area */}\r\n        <div className=\"flex-1 p-0 relative overflow-hidden flex flex-col\">\r\n            \r\n            {/* Start Mask */}\r\n            {!hasStarted && !isSubmitted && (\r\n                <div className=\"absolute inset-0 z-30 bg-[#fcfaf8]/80 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center animate-in fade-in duration-500\">\r\n                    <div className=\"bg-white p-8 rounded-2xl shadow-xl border border-stone-100 max-w-sm w-full\">\r\n                        <div className=\"w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-4 text-stone-600\">\r\n                            <Clock size={32} />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-stone-800 mb-2 font-serif\">准备好了吗？</h3>\r\n                        <p className=\"text-stone-500 text-sm mb-6 font-serif\">\r\n                            共 {questions.length} 道题，{isEssayType ? '请认真阅读给定资料并作答。' : '点击下方按钮开始计时作答。'}\r\n                        </p>\r\n                        <button \r\n                            onClick={() => setHasStarted(true)}\r\n                            className=\"w-full bg-stone-800 hover:bg-stone-900 text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-stone-200 transition-all hover:scale-105 active:scale-95 flex items-center justify-center gap-2\"\r\n                        >\r\n                            <Play size={20} className=\"fill-white\" />\r\n                            开始答题\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div \r\n                className={`flex-1 flex flex-col transition-all duration-300 ease-out transform overflow-hidden ${\r\n                    isAnimating \r\n                    ? (direction === 'right' ? '-translate-x-10 opacity-0' : 'translate-x-10 opacity-0')\r\n                    : 'translate-x-0 opacity-100'\r\n                } ${!hasStarted ? 'blur-sm opacity-50 pointer-events-none' : ''}`}\r\n            >\r\n                {/* Material Section */}\r\n                {hasMaterial && (\r\n                    <div className=\"bg-[#f8f7f4] border-b border-stone-200 p-4 md:p-6 max-h-[30vh] md:max-h-[40vh] overflow-y-auto shadow-inner relative\">\r\n                        <div className=\"absolute top-0 left-0 w-1 h-full bg-[#e5e5e0]\"></div>\r\n                        <div className=\"flex items-center gap-2 text-stone-800 font-bold mb-3 pl-2 font-serif\">\r\n                             <BookText size={18} />\r\n                             <span>给定资料</span>\r\n                        </div>\r\n                        <div className=\"prose prose-sm prose-stone max-w-none leading-relaxed text-justify text-stone-700 font-serif-sc\">\r\n                             {currentQ.material?.split('\\n').map((para, i) => (\r\n                                 <p key={i} className=\"mb-2 last:mb-0 indent-8\">{para}</p>\r\n                             ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"p-4 md:p-6 flex-1 overflow-y-auto bg-white\">\r\n                    {/* Max width container for better readability in fullscreen */}\r\n                    <div className={`mx-auto ${isFullscreen ? 'max-w-4xl' : 'w-full'}`}>\r\n                        {/* Question */}\r\n                        <div className=\"mb-6\">\r\n                            <div className=\"flex gap-2 mb-4\">\r\n                                <span className=\"text-stone-400 flex-shrink-0 font-bold text-lg mt-1 font-serif\">Q{currentIndex + 1}.</span>\r\n                                <div className=\"flex-1 text-stone-800 text-lg leading-relaxed font-bold font-serif-sc\">\r\n                                    <MarkdownRenderer content={processContent(currentQ.question)} className=\"prose-base\" />\r\n                                </div>\r\n                            </div>\r\n                            \r\n                            {/* Options */}\r\n                            {!isEssayType && currentQ.options && currentQ.options.length > 0 && (\r\n                                <div className={`grid gap-3 ${currentQ.options.some(o => o.includes('<svg')) ? 'grid-cols-2' : 'grid-cols-1'}`}>\r\n                                    {currentQ.options.map((optRaw, idx) => {\r\n                                        // Robust Label Calculation\r\n                                        const displayLabel = getOptionLabel(optRaw, idx);\r\n                                        \r\n                                        // Parse content cleanly\r\n                                        let { content } = parseOption(optRaw);\r\n                                        let displayContent = content.replace(/```svg/gi, '').replace(/```/g, '').trim();\r\n                                        const isSvgOption = displayContent.startsWith('<svg');\r\n                                        \r\n                                        return (\r\n                                            <button\r\n                                                key={idx}\r\n                                                onClick={() => handleOptionClick(optRaw, idx)}\r\n                                                disabled={isSubmitted || !hasStarted}\r\n                                                // Font-sans and tabular-nums for perfect digit alignment\r\n                                                className={`w-full text-left p-4 rounded-lg border text-sm transition-all duration-200 flex items-baseline group relative overflow-hidden font-sans tabular-nums ${getOptionStyle(optRaw, idx)}`}\r\n                                            >\r\n                                                <span className=\"mr-3 text-base font-bold opacity-80 flex-shrink-0 w-6 text-right leading-relaxed\">\r\n                                                    {displayLabel}.\r\n                                                </span>\r\n                                                \r\n                                                {isSvgOption ? (\r\n                                                    <div className=\"flex-1 flex justify-center md:justify-start\">\r\n                                                        <div className=\"w-24 h-24 md:w-32 md:h-32 pointer-events-none\" dangerouslySetInnerHTML={{__html: displayContent}} />\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <div className=\"flex-1 min-w-0 text-left break-words leading-relaxed\">\r\n                                                        <span>{displayContent}</span>\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                {isSubmitted && (\r\n                                                    <div className=\"absolute top-2 right-2\">\r\n                                                        {(displayLabel === currentQ.answer || optRaw.startsWith(currentQ.answer || '')) \r\n                                                        ? <CheckCircle2 size={20} className=\"text-emerald-600\" />\r\n                                                        : (answers[currentQ.id] === displayLabel ? <XCircle size={20} className=\"text-red-500\" /> : null)\r\n                                                        }\r\n                                                    </div>\r\n                                                )}\r\n                                            </button>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Essay Input */}\r\n                            {isEssayType && (\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"relative\">\r\n                                        <textarea\r\n                                            value={answers[currentQ.id] || ''}\r\n                                            onChange={(e) => handleTextAnswerChange(e.target.value)}\r\n                                            disabled={isSubmitted || !hasStarted}\r\n                                            placeholder=\"请在此处输入您的作答...\"\r\n                                            className=\"w-full min-h-[300px] p-4 bg-[#fcfaf8] border border-stone-200 rounded-xl focus:ring-2 focus:ring-stone-200 focus:border-stone-400 outline-none resize-none leading-relaxed text-stone-700 disabled:bg-stone-50 disabled:text-stone-400 font-serif\"\r\n                                            spellCheck={false}\r\n                                        />\r\n                                        <div className=\"absolute bottom-3 right-3 text-xs text-stone-400 pointer-events-none bg-white/80 px-1 rounded font-mono\">\r\n                                            {(answers[currentQ.id] || '').length} 字\r\n                                        </div>\r\n                                    </div>\r\n                                    {!isSubmitted && (\r\n                                        <p className=\"text-xs text-stone-400 flex items-center gap-1 font-sans\">\r\n                                            <PenTool size={12} />\r\n                                            申论/面试为主观题，交卷后系统将提供参考范文供您自我批改。\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Analysis */}\r\n                        {isSubmitted && (\r\n                            <div className=\"mt-8 animate-in fade-in slide-in-from-bottom-4 duration-500 pb-4\">\r\n                                <div className={`rounded-xl border p-5 shadow-sm relative overflow-hidden bg-stone-50 border-stone-200`}>\r\n                                    <div className=\"absolute top-0 right-0 p-2 opacity-5\">\r\n                                        <Lightbulb size={64} className=\"text-stone-800\" />\r\n                                    </div>\r\n                                    <h4 className={`font-bold text-sm mb-4 flex items-center gap-2 text-stone-800 font-serif`}>\r\n                                        <CheckCircle2 size={16} /> \r\n                                        {isEssayType ? '参考范文与解析' : '答案与解析'}\r\n                                    </h4>\r\n                                    \r\n                                    {isEssayType ? (\r\n                                        <div className=\"space-y-4\">\r\n                                            <div>\r\n                                                <span className=\"text-xs font-bold text-stone-500 bg-stone-200 px-2 py-0.5 rounded uppercase mb-1 inline-block font-sans\">参考范文</span>\r\n                                                <div className=\"prose prose-sm prose-stone text-stone-800 bg-white p-4 rounded-lg border border-stone-100 font-serif-sc\">\r\n                                                    <MarkdownRenderer content={currentQ.answer} />\r\n                                                </div>\r\n                                            </div>\r\n                                            <div>\r\n                                                <span className=\"text-xs font-bold text-stone-400 bg-stone-100 px-2 py-0.5 rounded uppercase mb-1 inline-block font-sans\">名师解析</span>\r\n                                                <div className=\"prose prose-sm text-stone-600 font-serif-sc\">\r\n                                                    <MarkdownRenderer content={currentQ.analysis} />\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <>\r\n                                            <div className=\"text-sm text-stone-800 leading-relaxed mb-2 font-serif\">\r\n                                                <span className=\"font-bold\">参考答案：</span> {currentQ.answer}\r\n                                            </div>\r\n                                            {currentQ.options && (\r\n                                                <div className={`text-sm mb-3 font-bold font-serif ${answers[currentQ.id] === currentQ.answer ? 'text-emerald-600' : 'text-red-600'}`}>\r\n                                                    你的选择：{answers[currentQ.id] || '未作答'}\r\n                                                </div>\r\n                                            )}\r\n                                            <div className=\"h-px bg-stone-200 my-3\"></div>\r\n                                            <div className=\"prose prose-sm prose-stone text-stone-700 font-serif-sc\">\r\n                                                <MarkdownRenderer content={processContent(currentQ.analysis)} />\r\n                                            </div>\r\n                                        </>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"bg-white border-t border-stone-100 p-4 flex justify-between items-center gap-4 shrink-0 z-10 rounded-b-xl\">\r\n            <button\r\n                onClick={() => changePage(currentIndex - 1)}\r\n                disabled={isFirst || !hasStarted}\r\n                className={`flex-1 md:flex-none flex items-center justify-center gap-1 px-4 py-2.5 rounded-lg text-sm font-bold transition-colors whitespace-nowrap font-serif ${\r\n                    isFirst || !hasStarted ? 'text-stone-300 cursor-not-allowed bg-stone-50' : 'text-stone-600 hover:bg-stone-100 bg-white border border-stone-200'\r\n                }`}\r\n            >\r\n                <ChevronLeft size={18} />\r\n                上一题\r\n            </button>\r\n\r\n            {/* Pagination Dots */}\r\n            {!isSubmitted && !isEssayType && (\r\n                <div className=\"hidden md:flex gap-1.5 justify-center flex-wrap max-w-[50%]\">\r\n                   {questions.map((_, idx) => (\r\n                      <div \r\n                          key={idx} \r\n                          className={`w-2 h-2 rounded-full transition-all ${getDotClass(idx)}`}\r\n                      />\r\n                   ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Next or Submit */}\r\n            {!isSubmitted && isLast ? (\r\n                <button\r\n                    onClick={handleSubmitClick}\r\n                    disabled={!hasStarted}\r\n                    className=\"flex-1 md:flex-none bg-stone-800 hover:bg-stone-900 text-white px-6 py-2.5 rounded-lg font-bold shadow-md shadow-stone-200 transition-all active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed font-serif\"\r\n                >\r\n                    <FileCheck size={18} />\r\n                    现在交卷\r\n                </button>\r\n            ) : (\r\n                <button\r\n                    onClick={() => changePage(currentIndex + 1)}\r\n                    disabled={isLast || !hasStarted}\r\n                    className={`flex-1 md:flex-none flex items-center justify-center gap-1 px-4 py-2.5 rounded-lg text-sm font-bold transition-colors whitespace-nowrap font-serif ${\r\n                        isLast || !hasStarted \r\n                            ? 'text-stone-300 cursor-not-allowed bg-stone-50' \r\n                            : 'text-stone-600 hover:bg-stone-50 bg-white border border-stone-200'\r\n                    }`}\r\n                >\r\n                    下一题\r\n                    <ChevronRight size={18} />\r\n                </button>\r\n            )}\r\n        </div>\r\n      </div>\r\n      \r\n      {!isFullscreen && <div className=\"absolute top-2 left-2 w-full h-full bg-[#f3f1eb] rounded-xl -z-10 border border-[#e5e5e0]\"></div>}\r\n\r\n      <ConfirmationModal \r\n        isOpen={isConfirmOpen}\r\n        onClose={() => setIsConfirmOpen(false)}\r\n        onConfirm={handleConfirmSubmit}\r\n        title=\"确认交卷\"\r\n        message={isEssayType \r\n            ? \"申论作答通常需要较长时间。交卷后将为您展示参考范文和详细解析，您可以对照进行自我评估。确定要交卷吗？\" \r\n            : `您已完成 ${answeredCount} / ${total} 道题。交卷后将停止计时并显示分数与解析。确定要交卷吗？`\r\n        }\r\n        confirmText=\"现在交卷\"\r\n        isDangerous={false}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizPaper;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2637, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/QuizConfigModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { X, ScrollText, Check, ListFilter, Hash, CheckSquare } from 'lucide-react';\r\nimport { ExamMode } from '../types';\r\nimport { EXAM_TOPICS } from '../constants';\r\n\r\ninterface Props {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onStart: (topic: string, count: number) => void;\r\n  currentMode: ExamMode;\r\n}\r\n\r\nconst JUDGMENT_SUBTOPICS = ['图形推理', '定义判断', '类比推理', '逻辑判断'];\r\n\r\nconst QuizConfigModal: React.FC<Props> = ({ isOpen, onClose, onStart, currentMode }) => {\r\n  const [selectedTopic, setSelectedTopic] = useState<string>('');\r\n  const [subTopics, setSubTopics] = useState<string[]>([]);\r\n  const [count, setCount] = useState<number>(5);\r\n\r\n  // Initialize state when modal opens or mode changes\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n        const topics = EXAM_TOPICS[currentMode] || ['随机'];\r\n        // Default select the first topic\r\n        const defaultTopic = topics[0];\r\n        setSelectedTopic(defaultTopic);\r\n        \r\n        // If default happens to be Judgment Reasoning, init subtopics\r\n        if (currentMode === ExamMode.XING_CE && defaultTopic === '判断推理') {\r\n            setSubTopics(JUDGMENT_SUBTOPICS);\r\n        } else {\r\n            setSubTopics([]);\r\n        }\r\n    }\r\n  }, [isOpen, currentMode]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const topics = EXAM_TOPICS[currentMode] || ['随机'];\r\n  const isShenLun = currentMode === ExamMode.SHEN_LUN;\r\n  const isJudgment = currentMode === ExamMode.XING_CE && selectedTopic === '判断推理';\r\n\r\n  const handleTopicClick = (topic: string) => {\r\n      setSelectedTopic(topic);\r\n      if (currentMode === ExamMode.XING_CE && topic === '判断推理') {\r\n          setSubTopics(JUDGMENT_SUBTOPICS); // Default select all\r\n      } else {\r\n          setSubTopics([]);\r\n      }\r\n  };\r\n\r\n  const toggleSubTopic = (sub: string) => {\r\n      setSubTopics(prev => \r\n          prev.includes(sub) \r\n          ? prev.filter(p => p !== sub) \r\n          : [...prev, sub]\r\n      );\r\n  };\r\n\r\n  const handleStart = () => {\r\n    let finalTopic = selectedTopic;\r\n    \r\n    // Combine subtopics into the prompt string if applicable\r\n    if (isJudgment) {\r\n        if (subTopics.length === 0) {\r\n            // If user deselected all, fallback to ALL to ensure valid prompt\r\n            finalTopic = `判断推理 (包含全部考点：${JUDGMENT_SUBTOPICS.join('、')})`;\r\n        } else {\r\n            // CRITICAL CHANGE: Use \"ONLY\" (仅限) to enforce strict filtering\r\n            finalTopic = `判断推理专项 (仅限以下考点：${subTopics.join('、')}，严禁生成其他题型)`;\r\n        }\r\n    }\r\n\r\n    // Shen Lun always generates 1 question per set due to length\r\n    const finalCount = isShenLun ? 1 : count;\r\n    onStart(finalTopic, finalCount);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200\">\r\n      <div className=\"bg-[#fcfaf8] rounded-2xl w-full max-w-sm shadow-2xl p-6 m-4 animate-in zoom-in-95 duration-200 border border-stone-200 max-h-[90vh] overflow-y-auto scrollbar-hide\">\r\n        \r\n        <div className=\"flex justify-between items-start mb-6\">\r\n          <div className=\"flex items-center gap-3\">\r\n             <div className=\"bg-stone-200 text-stone-600 p-2 rounded-xl\">\r\n               <ScrollText size={24} />\r\n             </div>\r\n             <div>\r\n                <h3 className=\"text-lg font-bold text-stone-800 font-serif\">\r\n                    {isShenLun ? '生成申论模拟题' : '生成全真模拟卷'}\r\n                </h3>\r\n                <p className=\"text-xs text-stone-500 font-sans\">AI 智能出题 · 计时模式</p>\r\n             </div>\r\n          </div>\r\n          <button onClick={onClose} className=\"p-1 rounded-full hover:bg-stone-200 text-stone-400 hover:text-stone-600 transition-colors\">\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"space-y-6\">\r\n          \r\n          {/* Topic Selection */}\r\n          <div className=\"space-y-3\">\r\n            <label className=\"text-sm font-bold text-stone-700 flex items-center gap-2 font-serif\">\r\n                <ListFilter size={16} className=\"text-stone-500\" />\r\n                选择题型/主题\r\n            </label>\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n                {topics.map(topic => (\r\n                    <button\r\n                        key={topic}\r\n                        onClick={() => handleTopicClick(topic)}\r\n                        className={`px-3 py-2 rounded-lg text-sm font-medium border transition-all text-left truncate font-serif ${\r\n                            selectedTopic === topic \r\n                            ? 'bg-stone-800 text-white border-stone-800 shadow-md'\r\n                            : 'bg-white text-stone-600 border-stone-200 hover:border-stone-400'\r\n                        }`}\r\n                    >\r\n                        {topic}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Sub-topic Selection for Judgment Reasoning */}\r\n            {isJudgment && (\r\n                <div className=\"bg-stone-100 rounded-xl p-3 border border-stone-200 animate-in slide-in-from-top-2\">\r\n                    <div className=\"flex justify-between items-center mb-2\">\r\n                        <span className=\"text-xs font-bold text-stone-700 flex items-center gap-1 font-serif\">\r\n                            <CheckSquare size={12} /> 细分题型 (可多选)\r\n                        </span>\r\n                        <span className=\"text-[10px] text-stone-400 font-sans\">已选 {subTopics.length} 项</span>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                        {JUDGMENT_SUBTOPICS.map(sub => (\r\n                            <button\r\n                                key={sub}\r\n                                onClick={() => toggleSubTopic(sub)}\r\n                                className={`px-3 py-2 rounded-lg text-xs font-bold border transition-all flex items-center justify-between font-serif ${\r\n                                    subTopics.includes(sub)\r\n                                    ? 'bg-stone-600 text-white border-stone-600 shadow-sm'\r\n                                    : 'bg-white text-stone-500 border-stone-200 hover:border-stone-400'\r\n                                }`}\r\n                            >\r\n                                <span>{sub}</span>\r\n                                {subTopics.includes(sub) && <Check size={12} />}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Count Selection - Hidden for Shen Lun */}\r\n          {!isShenLun && (\r\n              <div className=\"space-y-3 animate-in slide-in-from-top-2\">\r\n                <label className=\"text-sm font-bold text-stone-700 flex items-center gap-2 font-serif\">\r\n                    <Hash size={16} className=\"text-stone-500\" />\r\n                    题目数量\r\n                </label>\r\n                <div className=\"flex bg-stone-100 p-1 rounded-xl\">\r\n                    {[5, 10, 15].map(num => (\r\n                        <button\r\n                            key={num}\r\n                            onClick={() => setCount(num)}\r\n                            className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all font-sans ${\r\n                                count === num \r\n                                ? 'bg-white text-stone-800 shadow-sm' \r\n                                : 'text-stone-400 hover:text-stone-600'\r\n                            }`}\r\n                        >\r\n                            {num} 道\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n              </div>\r\n          )}\r\n\r\n          <button\r\n            onClick={handleStart}\r\n            className=\"w-full text-white font-bold py-3.5 rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 mt-2 bg-stone-800 hover:bg-stone-900 shadow-stone-200 font-serif\"\r\n          >\r\n            <Check size={18} />\r\n            {isShenLun ? '生成题目' : '开始刷题'}\r\n          </button>\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizConfigModal;"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;AALA;;;;;AAcA,MAAM,qBAAqB;IAAC;IAAQ;IAAQ;IAAQ;CAAO;AAE3D,MAAM,kBAAmC,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,WAAW,EAAE;;IACjF,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,wSAAQ,EAAS;IAC3D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,wSAAQ,EAAW,EAAE;IACvD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,wSAAQ,EAAS;IAE3C,oDAAoD;IACpD,IAAA,ySAAS;qCAAC;YACR,IAAI,QAAQ;gBACR,MAAM,SAAS,2HAAW,CAAC,YAAY,IAAI;oBAAC;iBAAK;gBACjD,iCAAiC;gBACjC,MAAM,eAAe,MAAM,CAAC,EAAE;gBAC9B,iBAAiB;gBAEjB,8DAA8D;gBAC9D,IAAI,gBAAgB,oHAAQ,CAAC,OAAO,IAAI,iBAAiB,QAAQ;oBAC7D,aAAa;gBACjB,OAAO;oBACH,aAAa,EAAE;gBACnB;YACJ;QACF;oCAAG;QAAC;QAAQ;KAAY;IAExB,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,SAAS,2HAAW,CAAC,YAAY,IAAI;QAAC;KAAK;IACjD,MAAM,YAAY,gBAAgB,oHAAQ,CAAC,QAAQ;IACnD,MAAM,aAAa,gBAAgB,oHAAQ,CAAC,OAAO,IAAI,kBAAkB;IAEzE,MAAM,mBAAmB,CAAC;QACtB,iBAAiB;QACjB,IAAI,gBAAgB,oHAAQ,CAAC,OAAO,IAAI,UAAU,QAAQ;YACtD,aAAa,qBAAqB,qBAAqB;QAC3D,OAAO;YACH,aAAa,EAAE;QACnB;IACJ;IAEA,MAAM,iBAAiB,CAAC;QACpB,aAAa,CAAA,OACT,KAAK,QAAQ,CAAC,OACZ,KAAK,MAAM,CAAC,CAAA,IAAK,MAAM,OACvB;mBAAI;gBAAM;aAAI;IAExB;IAEA,MAAM,cAAc;QAClB,IAAI,aAAa;QAEjB,yDAAyD;QACzD,IAAI,YAAY;YACZ,IAAI,UAAU,MAAM,KAAK,GAAG;gBACxB,iEAAiE;gBACjE,aAAa,CAAC,aAAa,EAAE,mBAAmB,IAAI,CAAC,KAAK,CAAC,CAAC;YAChE,OAAO;gBACH,+DAA+D;gBAC/D,aAAa,CAAC,eAAe,EAAE,UAAU,IAAI,CAAC,KAAK,UAAU,CAAC;YAClE;QACJ;QAEA,6DAA6D;QAC7D,MAAM,aAAa,YAAY,IAAI;QACnC,QAAQ,YAAY;QACpB;IACF;IAEA,qBACE,4TAAC;QAAI,WAAU;kBACb,cAAA,4TAAC;YAAI,WAAU;;8BAEb,4TAAC;oBAAI,WAAU;;sCACb,4TAAC;4BAAI,WAAU;;8CACZ,4TAAC;oCAAI,WAAU;8CACb,cAAA,4TAAC,uTAAU;wCAAC,MAAM;;;;;;;;;;;8CAEpB,4TAAC;;sDACE,4TAAC;4CAAG,WAAU;sDACT,YAAY,YAAY;;;;;;sDAE7B,4TAAC;4CAAE,WAAU;sDAAmC;;;;;;;;;;;;;;;;;;sCAGtD,4TAAC;4BAAO,SAAS;4BAAS,WAAU;sCAClC,cAAA,4TAAC,wRAAC;gCAAC,MAAM;;;;;;;;;;;;;;;;;8BAIb,4TAAC;oBAAI,WAAU;;sCAGb,4TAAC;4BAAI,WAAU;;8CACb,4TAAC;oCAAM,WAAU;;sDACb,4TAAC,uTAAU;4CAAC,MAAM;4CAAI,WAAU;;;;;;wCAAmB;;;;;;;8CAGvD,4TAAC;oCAAI,WAAU;8CACV,OAAO,GAAG,CAAC,CAAA,sBACR,4TAAC;4CAEG,SAAS,IAAM,iBAAiB;4CAChC,WAAW,CAAC,6FAA6F,EACrG,kBAAkB,QAChB,uDACA,mEACJ;sDAED;2CARI;;;;;;;;;;gCAchB,4BACG,4TAAC;oCAAI,WAAU;;sDACX,4TAAC;4CAAI,WAAU;;8DACX,4TAAC;oDAAK,WAAU;;sEACZ,4TAAC,iUAAW;4DAAC,MAAM;;;;;;wDAAM;;;;;;;8DAE7B,4TAAC;oDAAK,WAAU;;wDAAuC;wDAAI,UAAU,MAAM;wDAAC;;;;;;;;;;;;;sDAEhF,4TAAC;4CAAI,WAAU;sDACV,mBAAmB,GAAG,CAAC,CAAA,oBACpB,4TAAC;oDAEG,SAAS,IAAM,eAAe;oDAC9B,WAAW,CAAC,0GAA0G,EAClH,UAAU,QAAQ,CAAC,OACjB,uDACA,mEACJ;;sEAEF,4TAAC;sEAAM;;;;;;wDACN,UAAU,QAAQ,CAAC,sBAAQ,4TAAC,oSAAK;4DAAC,MAAM;;;;;;;mDATpC;;;;;;;;;;;;;;;;;;;;;;wBAkB1B,CAAC,2BACE,4TAAC;4BAAI,WAAU;;8CACb,4TAAC;oCAAM,WAAU;;sDACb,4TAAC,iSAAI;4CAAC,MAAM;4CAAI,WAAU;;;;;;wCAAmB;;;;;;;8CAGjD,4TAAC;oCAAI,WAAU;8CACV;wCAAC;wCAAG;wCAAI;qCAAG,CAAC,GAAG,CAAC,CAAA,oBACb,4TAAC;4CAEG,SAAS,IAAM,SAAS;4CACxB,WAAW,CAAC,kEAAkE,EAC1E,UAAU,MACR,sCACA,uCACJ;;gDAED;gDAAI;;2CARA;;;;;;;;;;;;;;;;sCAevB,4TAAC;4BACC,SAAS;4BACT,WAAU;;8CAEV,4TAAC,oSAAK;oCAAC,MAAM;;;;;;gCACZ,YAAY,SAAS;;;;;;;;;;;;;;;;;;;;;;;;AAOlC;GAhLM;KAAA;uCAkLS"}},
    {"offset": {"line": 3026, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/ChatInterface.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport { Message, ExamMode, Category, QuizConfig } from '../types';\r\nimport MarkdownRenderer from './MarkdownRenderer';\r\nimport SaveToNotebookModal from './SaveToNotebookModal';\r\nimport QuizPaper from './QuizPaper';\r\nimport QuizConfigModal from './QuizConfigModal';\r\nimport { MODE_LABELS } from '../constants';\r\nimport { generateQuiz } from '../services/geminiService';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { Send, Image as ImageIcon, Loader2, X, Bot, Sparkles, Plus, ArrowLeftRight, Star, StickyNote, PenLine, Check, Tag, ScrollText } from 'lucide-react';\r\n\r\ninterface Props {\r\n  messages: Message[];\r\n  categories: Category[];\r\n  isLoading: boolean;\r\n  onSendMessage: (text: string, image?: string, quizConfig?: QuizConfig) => void;\r\n  currentMode: ExamMode;\r\n  onSaveMessage: (id: string, categoryId: string) => void; \r\n  onCreateCategory: (name: string) => string;\r\n  onUpdateNote: (id: string, note: string) => void;\r\n}\r\n\r\nconst ChatInterface: React.FC<Props> = ({ \r\n  messages, \r\n  categories,\r\n  isLoading, \r\n  onSendMessage, \r\n  currentMode, \r\n  onSaveMessage,\r\n  onCreateCategory,\r\n  onUpdateNote\r\n}) => {\r\n  const [inputText, setInputText] = useState('');\r\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\r\n  const [isQuizLoading, setIsQuizLoading] = useState(false);\r\n  const [isQuizConfigOpen, setIsQuizConfigOpen] = useState(false);\r\n  \r\n  // Note editing state\r\n  const [editingNoteId, setEditingNoteId] = useState<string | null>(null);\r\n  const [tempNoteContent, setTempNoteContent] = useState('');\r\n\r\n  // Save Modal state\r\n  const [saveModalOpen, setSaveModalOpen] = useState(false);\r\n  const [messageToSaveId, setMessageToSaveId] = useState<string | null>(null);\r\n\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const scrollToBottom = () => {\r\n    if (messagesEndRef.current) {\r\n        messagesEndRef.current.scrollIntoView({ behavior: 'auto', block: 'end' });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages, isLoading, isQuizLoading]);\r\n\r\n  useEffect(() => {\r\n    if (textareaRef.current) {\r\n      textareaRef.current.style.height = 'auto'; \r\n      const scrollHeight = textareaRef.current.scrollHeight;\r\n      const newHeight = Math.min(Math.max(scrollHeight, 48), 160);\r\n      textareaRef.current.style.height = `${newHeight}px`;\r\n    }\r\n  }, [inputText]);\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        alert(\"图片大小不能超过 5MB\");\r\n        return;\r\n      }\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setSelectedImage(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleSend = () => {\r\n    if ((!inputText.trim() && !selectedImage) || isLoading || isQuizLoading) return;\r\n    onSendMessage(inputText, selectedImage || undefined);\r\n    setInputText('');\r\n    setSelectedImage(null);\r\n    if (textareaRef.current) textareaRef.current.style.height = '48px';\r\n  };\r\n\r\n  const handleQuizConfigStart = (topic: string, count: number) => {\r\n    if (isLoading || isQuizLoading) return;\r\n    setIsQuizLoading(true);\r\n    // Send a special message with config to App.tsx\r\n    onSendMessage(\"start_quiz_mode\", undefined, { topic, count });\r\n    setIsQuizLoading(false); // App.tsx will set its own loading state\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSend();\r\n    }\r\n  };\r\n\r\n  // --- Actions ---\r\n  const handleBookmarkClick = (msgId: string) => {\r\n     setMessageToSaveId(msgId);\r\n     setSaveModalOpen(true);\r\n  };\r\n\r\n  const startEditingNote = (msg: Message) => {\r\n    setEditingNoteId(msg.id);\r\n    setTempNoteContent(msg.note || '');\r\n  };\r\n\r\n  const saveNote = (id: string) => {\r\n    onUpdateNote(id, tempNoteContent);\r\n    setEditingNoteId(null);\r\n  };\r\n\r\n  const getSuggestions = () => {\r\n    switch (currentMode) {\r\n      case ExamMode.XING_CE:\r\n        return [\"出几道2023年国考常识真题\", \"如何快速计算增长率？\", \"这道图形推理题选什么？\"];\r\n      case ExamMode.SHEN_LUN:\r\n        return [\"关于'新质生产力'的申论金句\", \"帮我拟一个乡村振兴大作文提纲\", \"润色这段文章语言...\"];\r\n      case ExamMode.MIAN_SHI:\r\n        return [\"模拟一道社会现象类面试题\", \"综合分析题答题思路\", \"人际关系题怎么回答？\"];\r\n      default:\r\n        return [];\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"absolute inset-0 flex flex-col bg-[#fcfaf8] md:rounded-tl-2xl overflow-hidden\">\r\n      \r\n      {/* Quiz Configuration Modal */}\r\n      <QuizConfigModal \r\n         isOpen={isQuizConfigOpen} \r\n         onClose={() => setIsQuizConfigOpen(false)}\r\n         onStart={handleQuizConfigStart}\r\n         currentMode={currentMode}\r\n      />\r\n\r\n      {/* Save Modal */}\r\n      <SaveToNotebookModal \r\n        isOpen={saveModalOpen}\r\n        onClose={() => setSaveModalOpen(false)}\r\n        onSave={(catId) => {\r\n            if (messageToSaveId) onSaveMessage(messageToSaveId, catId);\r\n        }}\r\n        onCreateCategory={onCreateCategory}\r\n        categories={categories}\r\n        currentMode={currentMode}\r\n      />\r\n\r\n      {/* Messages Area */}\r\n      <div className=\"flex-1 overflow-y-auto scroll-smooth scrollbar-hide\">\r\n        {/* Content Wrapper for Alignment - Matches Input Box Width (max-w-3xl) */}\r\n        <div className=\"w-full max-w-3xl mx-auto px-4 py-6 space-y-8 min-h-full\">\r\n            \r\n            {messages.length === 0 && (\r\n              <div className=\"h-full flex flex-col items-center justify-center p-4 text-center min-h-[50vh]\">\r\n                 <div className=\"w-16 h-16 rounded-2xl bg-stone-100 flex items-center justify-center mb-6\">\r\n                    <Sparkles size={28} className=\"text-stone-400\" />\r\n                 </div>\r\n                 <h3 className=\"text-xl font-serif font-bold text-stone-800 mb-2\">公考智囊</h3>\r\n                 <p className=\"text-stone-500 max-w-sm mb-10 leading-relaxed text-sm\">\r\n                    您的全能备考助手。<br/>\r\n                    精通{currentMode === 'XING_CE' ? '行测逻辑与数学' : currentMode === 'SHEN_LUN' ? '申论写作与政策' : '面试技巧与模拟'}，随时为您解答。\r\n                 </p>\r\n                 \r\n                 <div className=\"grid grid-cols-1 gap-3 w-full max-w-md\">\r\n                    {getSuggestions().map((s, i) => (\r\n                      <button \r\n                        key={i} \r\n                        onClick={() => setInputText(s)}\r\n                        className=\"text-sm bg-white border border-stone-200 px-5 py-3 rounded-xl hover:bg-stone-50 hover:border-stone-300 transition-all text-left shadow-sm text-stone-600\"\r\n                      >\r\n                        {s}\r\n                      </button>\r\n                    ))}\r\n                 </div>\r\n              </div>\r\n            )}\r\n\r\n            {messages.map((msg) => {\r\n              if (msg.isSystem) {\r\n                 return (\r\n                   <div key={msg.id} className=\"flex justify-center py-4 animate-in fade-in zoom-in-95 duration-300\">\r\n                     <span className=\"text-xs font-medium text-stone-400 tracking-wider uppercase px-2 bg-[#fcfaf8] z-10\">{msg.text}</span>\r\n                     <div className=\"absolute w-full border-t border-stone-100 top-1/2 left-0 -z-0\"></div>\r\n                   </div>\r\n                 );\r\n              }\r\n\r\n              const isEditing = editingNoteId === msg.id;\r\n\r\n              return (\r\n                <div\r\n                  key={msg.id}\r\n                  className={`flex w-full group ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\r\n                >\r\n                  <div className={`flex flex-col max-w-[100%] gap-2 ${msg.role === 'user' ? 'items-end' : 'items-start w-full'}`}>\r\n                    \r\n                    <div className={`flex gap-4 ${msg.role === 'user' ? 'flex-row-reverse' : 'flex-row'} w-full`}>\r\n                        \r\n                        {/* Avatars */}\r\n                        <div className={`flex-shrink-0 w-8 h-8 rounded mt-1 flex items-center justify-center ${\r\n                        msg.role === 'user' \r\n                            ? 'bg-stone-200 text-stone-600' \r\n                            : 'bg-transparent text-stone-800'\r\n                        }`}>\r\n                            {msg.role === 'user' ? <div className=\"text-xs font-bold\">ME</div> : <Sparkles size={20} className=\"fill-stone-800\" />}\r\n                        </div>\r\n\r\n                        <div className=\"flex flex-col min-w-0 flex-1 max-w-full\">\r\n                        {/* Render QuizPaper if quizData exists */}\r\n                        {msg.quizData ? (\r\n                            <QuizPaper questions={msg.quizData} mode={msg.mode || ExamMode.XING_CE} />\r\n                        ) : (\r\n                            <div\r\n                                className={`text-[15px] leading-relaxed break-words relative ${\r\n                                msg.role === 'user'\r\n                                    ? 'bg-[#f0f0ed] text-stone-800 rounded-xl px-4 py-2.5 max-w-fit ml-auto'\r\n                                    : 'text-stone-800 w-full font-serif-sc'\r\n                                } ${msg.isBookmarked ? 'ring-2 ring-amber-200 ring-offset-2 ring-offset-[#fcfaf8] rounded' : ''}`}\r\n                            >\r\n                                {msg.image && (\r\n                                <div className=\"mb-3 overflow-hidden rounded-lg border border-stone-200\">\r\n                                    <img \r\n                                    src={msg.image} \r\n                                    alt=\"User upload\" \r\n                                    className=\"max-w-full h-auto max-h-60 object-contain mx-auto\" \r\n                                    />\r\n                                </div>\r\n                                )}\r\n                                {msg.role === 'model' ? (\r\n                                    <MarkdownRenderer content={msg.text} />\r\n                                ) : (\r\n                                    <div className=\"whitespace-pre-wrap font-sans\">{msg.text}</div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Action Bar */}\r\n                        <div className={`flex items-center gap-1 mt-1 transition-opacity ${\r\n                            msg.role === 'user' ? 'justify-end pr-1' : 'justify-start pl-1'\r\n                        } opacity-0 group-hover:opacity-100`}>\r\n                            \r\n                            <button \r\n                                onClick={() => handleBookmarkClick(msg.id)}\r\n                                className={`p-1.5 rounded transition-colors ${\r\n                                    msg.isBookmarked \r\n                                        ? 'text-amber-600 bg-amber-50' \r\n                                        : 'text-stone-400 hover:text-amber-600 hover:bg-stone-100'\r\n                                }`}\r\n                                title={msg.isBookmarked ? \"已收藏\" : \"加入笔记本\"}\r\n                            >\r\n                                <Star size={14} className={msg.isBookmarked ? \"fill-current\" : \"\"} />\r\n                            </button>\r\n\r\n                            <button \r\n                                onClick={() => startEditingNote(msg)}\r\n                                className={`p-1.5 rounded transition-colors ${\r\n                                    msg.note \r\n                                        ? 'text-stone-800 bg-stone-200' \r\n                                        : 'text-stone-400 hover:text-stone-800 hover:bg-stone-100'\r\n                                }`}\r\n                                title=\"添加笔记\"\r\n                            >\r\n                                <PenLine size={14} />\r\n                            </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Sticky Note */}\r\n                    {(msg.note || isEditing) && (\r\n                        <div className={`relative mt-1 ml-12 max-w-sm w-full animate-in slide-in-from-top-1 fade-in duration-300 ${msg.role === 'user' ? 'mr-12 ml-auto' : ''}`}>\r\n                            <div className=\"bg-[#fff9e6] border border-[#f5e6b3] rounded-lg p-3 shadow-sm text-sm relative text-stone-700\">\r\n                                {isEditing ? (\r\n                                    <div className=\"flex flex-col gap-2\">\r\n                                        <textarea\r\n                                            value={tempNoteContent}\r\n                                            onChange={(e) => setTempNoteContent(e.target.value)}\r\n                                            placeholder=\"输入笔记...\"\r\n                                            className=\"w-full bg-transparent border-b border-[#e6d5a0] focus:border-stone-400 p-1 text-sm focus:outline-none min-h-[60px] resize-none\"\r\n                                            autoFocus\r\n                                        />\r\n                                        <div className=\"flex justify-end gap-2\">\r\n                                            <button \r\n                                                onClick={() => setEditingNoteId(null)}\r\n                                                className=\"text-xs text-stone-500 hover:text-stone-700 px-2\"\r\n                                            >\r\n                                                取消\r\n                                            </button>\r\n                                            <button \r\n                                                onClick={() => saveNote(msg.id)}\r\n                                                className=\"text-xs bg-stone-800 text-white px-3 py-1 rounded hover:bg-black transition-colors\"\r\n                                            >\r\n                                                保存\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div \r\n                                        className=\"cursor-pointer hover:opacity-80 flex gap-2\"\r\n                                        onClick={() => startEditingNote(msg)}\r\n                                    >\r\n                                        <StickyNote size={14} className=\"text-[#d4c07b] flex-shrink-0 mt-0.5\" />\r\n                                        <span className=\"font-serif italic\">{msg.note}</span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n\r\n            {/* Loading States */}\r\n            {(isLoading || isQuizLoading) && (\r\n              <div className=\"flex justify-start w-full animate-pulse pl-12\">\r\n                   <div className=\"bg-white border border-stone-100 px-5 py-4 rounded-2xl rounded-bl-none shadow-sm flex items-center gap-3\">\r\n                     {isQuizLoading ? (\r\n                         <div className=\"flex items-center gap-2 text-stone-600\">\r\n                            <ScrollText size={18} className=\"animate-pulse\" />\r\n                            <span className=\"text-sm font-medium font-serif\">正在准备全真模拟卷...</span>\r\n                         </div>\r\n                     ) : (\r\n                         <div className=\"flex gap-1\">\r\n                            <div className=\"w-1.5 h-1.5 bg-stone-400 rounded-full animate-bounce\" style={{animationDelay: '0ms'}}></div>\r\n                            <div className=\"w-1.5 h-1.5 bg-stone-400 rounded-full animate-bounce\" style={{animationDelay: '150ms'}}></div>\r\n                            <div className=\"w-1.5 h-1.5 bg-stone-400 rounded-full animate-bounce\" style={{animationDelay: '300ms'}}></div>\r\n                         </div>\r\n                     )}\r\n                   </div>\r\n              </div>\r\n            )}\r\n            <div ref={messagesEndRef} className=\"h-4 w-full\" />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Input Area */}\r\n      <div className=\"flex-shrink-0 z-10 w-full bg-[#fcfaf8] pb-4\">\r\n            <div className=\"w-full max-w-3xl mx-auto px-4\">\r\n            \r\n            {selectedImage && (\r\n                <div className=\"relative mb-2 inline-block group animate-in slide-in-from-bottom-2 fade-in duration-300\">\r\n                    <div className=\"absolute -top-2 -right-2 bg-stone-800 text-white rounded-full p-0.5 cursor-pointer shadow-md\" onClick={() => setSelectedImage(null)}>\r\n                        <X size={14} />\r\n                    </div>\r\n                    <img src={selectedImage} alt=\"Preview\" className=\"h-16 w-auto object-cover rounded-lg border border-stone-200 shadow-sm\" />\r\n                </div>\r\n            )}\r\n\r\n            {/* Claude-style Input Box */}\r\n            <div className=\"relative bg-white rounded-2xl border border-stone-200 shadow-[0_2px_8px_rgba(0,0,0,0.04)] focus-within:shadow-[0_4px_12px_rgba(0,0,0,0.08)] focus-within:border-stone-300 transition-all duration-300\">\r\n                <textarea\r\n                    ref={textareaRef}\r\n                    value={inputText}\r\n                    onChange={(e) => setInputText(e.target.value)}\r\n                    onKeyDown={handleKeyDown}\r\n                    rows={1}\r\n                    placeholder={currentMode === ExamMode.XING_CE ? \"来道真题或输入题目...\" : \"输入申论主题或面试问题...\"}\r\n                    className=\"w-full bg-transparent border-none focus:ring-0 resize-none py-4 pl-4 pr-12 text-[16px] outline-none text-stone-800 placeholder:text-stone-400 leading-6 max-h-[200px]\"\r\n                    style={{ minHeight: '56px' }}\r\n                />\r\n\r\n                <div className=\"flex items-center justify-between px-2 pb-2\">\r\n                    <div className=\"flex gap-1\">\r\n                        <button\r\n                            onClick={() => setIsQuizConfigOpen(true)}\r\n                            className=\"p-2 text-stone-400 hover:text-amber-600 hover:bg-stone-50 rounded-lg transition-colors flex items-center gap-1 group\"\r\n                            title=\"生成试卷\"\r\n                        >\r\n                            <ScrollText size={18} />\r\n                            <span className=\"text-xs font-medium hidden group-hover:block animate-in fade-in slide-in-from-left-1\">模拟考</span>\r\n                        </button>\r\n                        \r\n                        <input\r\n                            type=\"file\"\r\n                            accept=\"image/*\"\r\n                            ref={fileInputRef}\r\n                            onChange={handleFileChange}\r\n                            className=\"hidden\"\r\n                        />\r\n                        <button\r\n                            onClick={() => fileInputRef.current?.click()}\r\n                            className=\"p-2 text-stone-400 hover:text-stone-600 hover:bg-stone-50 rounded-lg transition-colors\"\r\n                            title=\"上传图片\"\r\n                        >\r\n                            <ImageIcon size={18} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={handleSend}\r\n                        disabled={(!inputText.trim() && !selectedImage) || isLoading || isQuizLoading}\r\n                        className={`p-2 rounded-lg transition-all duration-200 ${\r\n                            (!inputText.trim() && !selectedImage) || isLoading || isQuizLoading\r\n                            ? 'bg-stone-100 text-stone-300 cursor-not-allowed'\r\n                            : 'bg-[#da7756] text-white shadow-md hover:bg-[#c66342]'\r\n                        }`}\r\n                    >\r\n                        {(isLoading || isQuizLoading) ? <Loader2 size={18} className=\"animate-spin\" /> : <Send size={18} />}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            \r\n            <div className=\"text-center mt-2\">\r\n                <p className=\"text-[10px] text-stone-300\">\r\n                    AI 可能产生错误信息，请以官方教材为准\r\n                </p>\r\n            </div>\r\n            </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatInterface;"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAXA;;;;;;;;AAwBA,MAAM,gBAAiC,CAAC,EACtC,QAAQ,EACR,UAAU,EACV,SAAS,EACT,aAAa,EACb,WAAW,EACX,aAAa,EACb,gBAAgB,EAChB,YAAY,EACb;;IACC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,wSAAQ,EAAC;IAC3C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,wSAAQ,EAAgB;IAClE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,wSAAQ,EAAC;IACnD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,wSAAQ,EAAC;IAEzD,qBAAqB;IACrB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,wSAAQ,EAAgB;IAClE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,wSAAQ,EAAC;IAEvD,mBAAmB;IACnB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,wSAAQ,EAAC;IACnD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,wSAAQ,EAAgB;IAEtE,MAAM,iBAAiB,IAAA,sSAAM,EAAiB;IAC9C,MAAM,eAAe,IAAA,sSAAM,EAAmB;IAC9C,MAAM,cAAc,IAAA,sSAAM,EAAsB;IAEhD,MAAM,iBAAiB;QACrB,IAAI,eAAe,OAAO,EAAE;YACxB,eAAe,OAAO,CAAC,cAAc,CAAC;gBAAE,UAAU;gBAAQ,OAAO;YAAM;QAC3E;IACF;IAEA,IAAA,ySAAS;mCAAC;YACR;QACF;kCAAG;QAAC;QAAU;QAAW;KAAc;IAEvC,IAAA,ySAAS;mCAAC;YACR,IAAI,YAAY,OAAO,EAAE;gBACvB,YAAY,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG;gBACnC,MAAM,eAAe,YAAY,OAAO,CAAC,YAAY;gBACrD,MAAM,YAAY,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,cAAc,KAAK;gBACvD,YAAY,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,UAAU,EAAE,CAAC;YACrD;QACF;kCAAG;QAAC;KAAU;IAEd,MAAM,mBAAmB,CAAC;QACxB,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QAChC,IAAI,MAAM;YACR,IAAI,KAAK,IAAI,GAAG,IAAI,OAAO,MAAM;gBAC/B,MAAM;gBACN;YACF;YACA,MAAM,SAAS,IAAI;YACnB,OAAO,SAAS,GAAG;gBACjB,iBAAiB,OAAO,MAAM;YAChC;YACA,OAAO,aAAa,CAAC;QACvB;IACF;IAEA,MAAM,aAAa;QACjB,IAAI,AAAC,CAAC,UAAU,IAAI,MAAM,CAAC,iBAAkB,aAAa,eAAe;QACzE,cAAc,WAAW,iBAAiB;QAC1C,aAAa;QACb,iBAAiB;QACjB,IAAI,YAAY,OAAO,EAAE,YAAY,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG;IAC9D;IAEA,MAAM,wBAAwB,CAAC,OAAe;QAC5C,IAAI,aAAa,eAAe;QAChC,iBAAiB;QACjB,gDAAgD;QAChD,cAAc,mBAAmB,WAAW;YAAE;YAAO;QAAM;QAC3D,iBAAiB,QAAQ,yCAAyC;IACpE;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;YACpC,EAAE,cAAc;YAChB;QACF;IACF;IAEA,kBAAkB;IAClB,MAAM,sBAAsB,CAAC;QAC1B,mBAAmB;QACnB,iBAAiB;IACpB;IAEA,MAAM,mBAAmB,CAAC;QACxB,iBAAiB,IAAI,EAAE;QACvB,mBAAmB,IAAI,IAAI,IAAI;IACjC;IAEA,MAAM,WAAW,CAAC;QAChB,aAAa,IAAI;QACjB,iBAAiB;IACnB;IAEA,MAAM,iBAAiB;QACrB,OAAQ;YACN,KAAK,oHAAQ,CAAC,OAAO;gBACnB,OAAO;oBAAC;oBAAkB;oBAAc;iBAAc;YACxD,KAAK,oHAAQ,CAAC,QAAQ;gBACpB,OAAO;oBAAC;oBAAkB;oBAAkB;iBAAc;YAC5D,KAAK,oHAAQ,CAAC,QAAQ;gBACpB,OAAO;oBAAC;oBAAgB;oBAAa;iBAAa;YACpD;gBACE,OAAO,EAAE;QACb;IACF;IAEA,qBACE,4TAAC;QAAI,WAAU;;0BAGb,4TAAC,4IAAe;gBACb,QAAQ;gBACR,SAAS,IAAM,oBAAoB;gBACnC,SAAS;gBACT,aAAa;;;;;;0BAIhB,4TAAC,gJAAmB;gBAClB,QAAQ;gBACR,SAAS,IAAM,iBAAiB;gBAChC,QAAQ,CAAC;oBACL,IAAI,iBAAiB,cAAc,iBAAiB;gBACxD;gBACA,kBAAkB;gBAClB,YAAY;gBACZ,aAAa;;;;;;0BAIf,4TAAC;gBAAI,WAAU;0BAEb,cAAA,4TAAC;oBAAI,WAAU;;wBAEV,SAAS,MAAM,KAAK,mBACnB,4TAAC;4BAAI,WAAU;;8CACZ,4TAAC;oCAAI,WAAU;8CACZ,cAAA,4TAAC,6SAAQ;wCAAC,MAAM;wCAAI,WAAU;;;;;;;;;;;8CAEjC,4TAAC;oCAAG,WAAU;8CAAmD;;;;;;8CACjE,4TAAC;oCAAE,WAAU;;wCAAwD;sDACzD,4TAAC;;;;;wCAAI;wCACX,gBAAgB,YAAY,YAAY,gBAAgB,aAAa,YAAY;wCAAU;;;;;;;8CAGjG,4TAAC;oCAAI,WAAU;8CACX,iBAAiB,GAAG,CAAC,CAAC,GAAG,kBACxB,4TAAC;4CAEC,SAAS,IAAM,aAAa;4CAC5B,WAAU;sDAET;2CAJI;;;;;;;;;;;;;;;;wBAWhB,SAAS,GAAG,CAAC,CAAC;4BACb,IAAI,IAAI,QAAQ,EAAE;gCACf,qBACE,4TAAC;oCAAiB,WAAU;;sDAC1B,4TAAC;4CAAK,WAAU;sDAAsF,IAAI,IAAI;;;;;;sDAC9G,4TAAC;4CAAI,WAAU;;;;;;;mCAFP,IAAI,EAAE;;;;;4BAKrB;4BAEA,MAAM,YAAY,kBAAkB,IAAI,EAAE;4BAE1C,qBACE,4TAAC;gCAEC,WAAW,CAAC,kBAAkB,EAAE,IAAI,IAAI,KAAK,SAAS,gBAAgB,iBAAiB;0CAEvF,cAAA,4TAAC;oCAAI,WAAW,CAAC,iCAAiC,EAAE,IAAI,IAAI,KAAK,SAAS,cAAc,sBAAsB;;sDAE5G,4TAAC;4CAAI,WAAW,CAAC,WAAW,EAAE,IAAI,IAAI,KAAK,SAAS,qBAAqB,WAAW,OAAO,CAAC;;8DAGxF,4TAAC;oDAAI,WAAW,CAAC,oEAAoE,EACrF,IAAI,IAAI,KAAK,SACP,gCACA,iCACJ;8DACG,IAAI,IAAI,KAAK,uBAAS,4TAAC;wDAAI,WAAU;kEAAoB;;;;;iHAAW,4TAAC,6SAAQ;wDAAC,MAAM;wDAAI,WAAU;;;;;;;;;;;8DAGvG,4TAAC;oDAAI,WAAU;;wDAEd,IAAI,QAAQ,iBACT,4TAAC,sIAAS;4DAAC,WAAW,IAAI,QAAQ;4DAAE,MAAM,IAAI,IAAI,IAAI,oHAAQ,CAAC,OAAO;;;;;qHAEtE,4TAAC;4DACG,WAAW,CAAC,iDAAiD,EAC7D,IAAI,IAAI,KAAK,SACP,yEACA,sCACL,CAAC,EAAE,IAAI,YAAY,GAAG,sEAAsE,IAAI;;gEAEhG,IAAI,KAAK,kBACV,4TAAC;oEAAI,WAAU;8EACX,cAAA,4TAAC;wEACD,KAAK,IAAI,KAAK;wEACd,KAAI;wEACJ,WAAU;;;;;;;;;;;gEAIb,IAAI,IAAI,KAAK,wBACV,4TAAC,6IAAgB;oEAAC,SAAS,IAAI,IAAI;;;;;6HAEnC,4TAAC;oEAAI,WAAU;8EAAiC,IAAI,IAAI;;;;;;;;;;;;sEAMpE,4TAAC;4DAAI,WAAW,CAAC,gDAAgD,EAC7D,IAAI,IAAI,KAAK,SAAS,qBAAqB,qBAC9C,kCAAkC,CAAC;;8EAEhC,4TAAC;oEACG,SAAS,IAAM,oBAAoB,IAAI,EAAE;oEACzC,WAAW,CAAC,gCAAgC,EACxC,IAAI,YAAY,GACV,+BACA,0DACR;oEACF,OAAO,IAAI,YAAY,GAAG,QAAQ;8EAElC,cAAA,4TAAC,iSAAI;wEAAC,MAAM;wEAAI,WAAW,IAAI,YAAY,GAAG,iBAAiB;;;;;;;;;;;8EAGnE,4TAAC;oEACG,SAAS,IAAM,iBAAiB;oEAChC,WAAW,CAAC,gCAAgC,EACxC,IAAI,IAAI,GACF,gCACA,0DACR;oEACF,OAAM;8EAEN,cAAA,4TAAC,8SAAO;wEAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;wCAO1B,CAAC,IAAI,IAAI,IAAI,SAAS,mBACnB,4TAAC;4CAAI,WAAW,CAAC,wFAAwF,EAAE,IAAI,IAAI,KAAK,SAAS,kBAAkB,IAAI;sDACnJ,cAAA,4TAAC;gDAAI,WAAU;0DACV,0BACG,4TAAC;oDAAI,WAAU;;sEACX,4TAAC;4DACG,OAAO;4DACP,UAAU,CAAC,IAAM,mBAAmB,EAAE,MAAM,CAAC,KAAK;4DAClD,aAAY;4DACZ,WAAU;4DACV,SAAS;;;;;;sEAEb,4TAAC;4DAAI,WAAU;;8EACX,4TAAC;oEACG,SAAS,IAAM,iBAAiB;oEAChC,WAAU;8EACb;;;;;;8EAGD,4TAAC;oEACG,SAAS,IAAM,SAAS,IAAI,EAAE;oEAC9B,WAAU;8EACb;;;;;;;;;;;;;;;;;6GAMT,4TAAC;oDACG,WAAU;oDACV,SAAS,IAAM,iBAAiB;;sEAEhC,4TAAC,uTAAU;4DAAC,MAAM;4DAAI,WAAU;;;;;;sEAChC,4TAAC;4DAAK,WAAU;sEAAqB,IAAI,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BA/G9D,IAAI,EAAE;;;;;wBAwHjB;wBAGC,CAAC,aAAa,aAAa,mBAC1B,4TAAC;4BAAI,WAAU;sCACV,cAAA,4TAAC;gCAAI,WAAU;0CACZ,8BACG,4TAAC;oCAAI,WAAU;;sDACZ,4TAAC,uTAAU;4CAAC,MAAM;4CAAI,WAAU;;;;;;sDAChC,4TAAC;4CAAK,WAAU;sDAAiC;;;;;;;;;;;6FAGpD,4TAAC;oCAAI,WAAU;;sDACZ,4TAAC;4CAAI,WAAU;4CAAuD,OAAO;gDAAC,gBAAgB;4CAAK;;;;;;sDACnG,4TAAC;4CAAI,WAAU;4CAAuD,OAAO;gDAAC,gBAAgB;4CAAO;;;;;;sDACrG,4TAAC;4CAAI,WAAU;4CAAuD,OAAO;gDAAC,gBAAgB;4CAAO;;;;;;;;;;;;;;;;;;;;;;sCAMrH,4TAAC;4BAAI,KAAK;4BAAgB,WAAU;;;;;;;;;;;;;;;;;0BAK1C,4TAAC;gBAAI,WAAU;0BACT,cAAA,4TAAC;oBAAI,WAAU;;wBAEd,+BACG,4TAAC;4BAAI,WAAU;;8CACX,4TAAC;oCAAI,WAAU;oCAA+F,SAAS,IAAM,iBAAiB;8CAC1I,cAAA,4TAAC,wRAAC;wCAAC,MAAM;;;;;;;;;;;8CAEb,4TAAC;oCAAI,KAAK;oCAAe,KAAI;oCAAU,WAAU;;;;;;;;;;;;sCAKzD,4TAAC;4BAAI,WAAU;;8CACX,4TAAC;oCACG,KAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;oCAC5C,WAAW;oCACX,MAAM;oCACN,aAAa,gBAAgB,oHAAQ,CAAC,OAAO,GAAG,iBAAiB;oCACjE,WAAU;oCACV,OAAO;wCAAE,WAAW;oCAAO;;;;;;8CAG/B,4TAAC;oCAAI,WAAU;;sDACX,4TAAC;4CAAI,WAAU;;8DACX,4TAAC;oDACG,SAAS,IAAM,oBAAoB;oDACnC,WAAU;oDACV,OAAM;;sEAEN,4TAAC,uTAAU;4DAAC,MAAM;;;;;;sEAClB,4TAAC;4DAAK,WAAU;sEAAuF;;;;;;;;;;;;8DAG3G,4TAAC;oDACG,MAAK;oDACL,QAAO;oDACP,KAAK;oDACL,UAAU;oDACV,WAAU;;;;;;8DAEd,4TAAC;oDACG,SAAS,IAAM,aAAa,OAAO,EAAE;oDACrC,WAAU;oDACV,OAAM;8DAEN,cAAA,4TAAC,oSAAS;wDAAC,MAAM;;;;;;;;;;;;;;;;;sDAIzB,4TAAC;4CACG,SAAS;4CACT,UAAU,AAAC,CAAC,UAAU,IAAI,MAAM,CAAC,iBAAkB,aAAa;4CAChE,WAAW,CAAC,2CAA2C,EACnD,AAAC,CAAC,UAAU,IAAI,MAAM,CAAC,iBAAkB,aAAa,gBACpD,mDACA,wDACJ;sDAED,AAAC,aAAa,8BAAiB,4TAAC,mTAAO;gDAAC,MAAM;gDAAI,WAAU;;;;;yGAAoB,4TAAC,iSAAI;gDAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;sCAKzG,4TAAC;4BAAI,WAAU;sCACX,cAAA,4TAAC;gCAAE,WAAU;0CAA6B;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ1D;GAjZM;KAAA;uCAmZS"}},
    {"offset": {"line": 3829, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/NotebookView.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Category, Message, ExamMode } from '../types';\r\nimport { MODE_LABELS } from '../constants';\r\nimport { Folder, ChevronRight, ArrowLeft, Tag, Calendar, StickyNote, Trash2, BookOpen, Bot, Star, Plus, FolderOpen, CornerUpLeft, CheckCircle2, Lightbulb, FileText, HelpCircle, BookText } from 'lucide-react';\r\nimport MarkdownRenderer from './MarkdownRenderer';\r\nimport ConfirmationModal from './ConfirmationModal';\r\n\r\ninterface Props {\r\n  messages: Message[];\r\n  categories: Category[];\r\n  onCreateCategory: (name: string, mode: ExamMode, parentId?: string) => void;\r\n  onDeleteCategory: (id: string) => void;\r\n  onRemoveMessage: (id: string) => void; // Unbookmark\r\n  onUpdateNote: (id: string, note: string) => void;\r\n}\r\n\r\nconst NotebookView: React.FC<Props> = ({\r\n  messages,\r\n  categories,\r\n  onCreateCategory,\r\n  onDeleteCategory,\r\n  onRemoveMessage,\r\n  onUpdateNote\r\n}) => {\r\n  const [activeTab, setActiveTab] = useState<ExamMode>(ExamMode.XING_CE);\r\n  // selectedCategoryId: null = Root, 'UNCATEGORIZED' = Default Folder, string = Specific Category UUID\r\n  const [selectedCategoryId, setSelectedCategoryId] = useState<string | 'UNCATEGORIZED' | null>(null);\r\n  const [selectedMessageId, setSelectedMessageId] = useState<string | null>(null);\r\n  const [isCreatingCat, setIsCreatingCat] = useState(false);\r\n  const [newCatName, setNewCatName] = useState('');\r\n\r\n  // Confirmation Modal State\r\n  const [confirmState, setConfirmState] = useState<{\r\n    isOpen: boolean;\r\n    title: string;\r\n    message: string;\r\n    action: () => void;\r\n  }>({\r\n    isOpen: false,\r\n    title: '',\r\n    message: '',\r\n    action: () => {},\r\n  });\r\n\r\n  const openConfirm = (title: string, message: string, action: () => void) => {\r\n    setConfirmState({ isOpen: true, title, message, action });\r\n  };\r\n\r\n  // Helper to strip markdown/code for clean preview\r\n  const getPreviewText = (text: string) => {\r\n    if (!text) return '';\r\n    // Remove markdown code blocks (```...```)\r\n    let clean = text.replace(/```[\\s\\S]*?```/g, '');\r\n    // Remove HTML tags\r\n    clean = clean.replace(/<[^>]*>/g, '');\r\n    // Remove markdown symbols\r\n    clean = clean.replace(/[*#`_~\\[\\]]/g, '');\r\n    // Collapse whitespace\r\n    return clean.replace(/\\s+/g, ' ').trim();\r\n  };\r\n\r\n  // --- DATA FILTERING ---\r\n  \r\n  // 1. All bookmarked messages for current mode\r\n  const modeMessages = messages.filter(\r\n    m => (m.isBookmarked || (m.note && m.note.length > 0)) && m.mode === activeTab\r\n  );\r\n\r\n  // 2. All categories for current mode\r\n  const modeCategories = categories.filter(c => c.mode === activeTab);\r\n\r\n  // 3. Helper: Count ITEMS within a specific category (direct items)\r\n  const getMessageCount = (catId?: string) => {\r\n    if (!catId) return modeMessages.filter(m => !m.categoryId).length;\r\n    return modeMessages.filter(m => m.categoryId === catId).length;\r\n  };\r\n\r\n  const handleCreateCategory = () => {\r\n    if (!newCatName.trim()) return;\r\n    \r\n    // Depth Limit Check: If we are in a subfolder (it has a parentId), don't allow creating another level.\r\n    if (selectedCategoryId && selectedCategoryId !== 'UNCATEGORIZED') {\r\n        const current = categories.find(c => c.id === selectedCategoryId);\r\n        if (current && current.parentId) {\r\n             alert(\"为了保持知识库清晰，最多只支持两级文件夹结构。\");\r\n             return;\r\n        }\r\n    }\r\n\r\n    // Create folder inside current selected category if it's a real category (not Uncategorized)\r\n    const parentId = (selectedCategoryId && selectedCategoryId !== 'UNCATEGORIZED') \r\n        ? selectedCategoryId \r\n        : undefined;\r\n    \r\n    onCreateCategory(newCatName, activeTab, parentId);\r\n    setNewCatName('');\r\n    setIsCreatingCat(false);\r\n  };\r\n\r\n  const handleNavigateUp = () => {\r\n    if (selectedCategoryId === 'UNCATEGORIZED') {\r\n        setSelectedCategoryId(null);\r\n    } else if (selectedCategoryId) {\r\n        // Find current category\r\n        const current = categories.find(c => c.id === selectedCategoryId);\r\n        if (current && current.parentId) {\r\n            setSelectedCategoryId(current.parentId);\r\n        } else {\r\n            setSelectedCategoryId(null);\r\n        }\r\n    }\r\n  };\r\n\r\n  // --- RENDER LEVEL 3: MESSAGE DETAIL ---\r\n  if (selectedMessageId) {\r\n    const msg = messages.find(m => m.id === selectedMessageId);\r\n    if (!msg) {\r\n        return (\r\n            <div className=\"h-full flex flex-col items-center justify-center text-stone-500 font-serif\">\r\n                <p>该内容已移除</p>\r\n                <button onClick={() => setSelectedMessageId(null)} className=\"mt-4 text-stone-800 underline hover:text-stone-600\">返回列表</button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n      <div className=\"h-full flex flex-col bg-[#fcfaf8]\">\r\n        <ConfirmationModal \r\n            isOpen={confirmState.isOpen}\r\n            onClose={() => setConfirmState(prev => ({...prev, isOpen: false}))}\r\n            onConfirm={confirmState.action}\r\n            title={confirmState.title}\r\n            message={confirmState.message}\r\n            isDangerous={true}\r\n            confirmText=\"确认删除\"\r\n        />\r\n        <div className=\"flex items-center gap-3 p-4 border-b border-stone-200 bg-[#fcfaf8]\">\r\n           <button onClick={() => setSelectedMessageId(null)} className=\"p-2 hover:bg-stone-100 rounded-full text-stone-500 transition-colors\"><ArrowLeft size={20} /></button>\r\n           <div className=\"flex-1\">\r\n             <h2 className=\"font-bold text-stone-800 text-sm md:text-base line-clamp-1 font-serif\">\r\n                {msg.quizData ? '全真模拟卷 · 复习模式' : '题目详情'}\r\n             </h2>\r\n             <p className=\"text-xs text-stone-400 font-sans\">{new Date(msg.timestamp).toLocaleString()}</p>\r\n           </div>\r\n           <button \r\n             onClick={() => openConfirm(\"移除题目\", \"确定要将这道题从笔记本中移除吗？您的笔记和分类信息将一并删除。\", () => { onRemoveMessage(msg.id); setSelectedMessageId(null); })}\r\n             className=\"text-stone-400 hover:text-red-600 p-2 hover:bg-stone-100 rounded-lg transition-colors\"\r\n           >\r\n             <Trash2 size={18} />\r\n           </button>\r\n        </div>\r\n        \r\n        <div className=\"flex-1 overflow-y-auto p-4 md:p-8\">\r\n           <div className=\"max-w-3xl mx-auto space-y-6\">\r\n              \r\n              {/* Note Section - Moved to Top for better reviewing */}\r\n              <div className=\"bg-[#fff9e6] p-6 rounded-2xl shadow-sm border border-[#f5e6b3] relative group transition-all hover:shadow-md\">\r\n                  <div className=\"flex items-center gap-2 mb-3 text-[#b49b56] font-bold font-serif\">\r\n                    <StickyNote size={18} />\r\n                    <span>我的笔记</span>\r\n                  </div>\r\n                  <textarea \r\n                    className=\"w-full bg-transparent border-0 outline-none focus:ring-0 focus:outline-none focus:border-none text-stone-700 text-sm leading-relaxed p-0 resize-none h-auto min-h-[100px] placeholder-[#b49b56]/40 font-serif\"\r\n                    style={{ border: 'none', boxShadow: 'none', outline: 'none' }} \r\n                    value={msg.note || ''} \r\n                    placeholder=\"在此输入复习重点、易错点或心得体会...\" \r\n                    onChange={(e) => onUpdateNote(msg.id, e.target.value)}\r\n                  />\r\n                  <div className=\"absolute top-4 right-4 text-xs text-[#b49b56]/60 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                      <span className=\"w-1.5 h-1.5 bg-[#d4c07b] rounded-full animate-pulse\"></span>\r\n                      自动保存\r\n                  </div>\r\n              </div>\r\n\r\n              <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-stone-200\">\r\n                  <div className=\"flex items-center gap-2 mb-4 border-b border-stone-100 pb-3\">\r\n                     <div className=\"bg-stone-100 text-stone-600 p-1.5 rounded-lg\"><Bot size={20} /></div>\r\n                     <span className=\"font-bold text-stone-700 font-serif\">题目与解析</span>\r\n                     {msg.quizData && <span className=\"text-xs bg-stone-100 text-stone-600 px-2 py-1 rounded-full ml-auto font-sans\">共 {msg.quizData.length} 题</span>}\r\n                  </div>\r\n                  \r\n                  {/* RENDER QUIZ DATA IF AVAILABLE */}\r\n                  {msg.quizData ? (\r\n                      <div className=\"space-y-10\">\r\n                          {msg.quizData.map((q, idx) => (\r\n                              <div key={idx} className=\"relative\">\r\n                                  {/* Connector Line */}\r\n                                  {idx !== msg.quizData!.length - 1 && (\r\n                                      <div className=\"absolute left-[15px] top-8 bottom-[-40px] w-0.5 bg-stone-100\"></div>\r\n                                  )}\r\n\r\n                                  <div className=\"flex gap-4\">\r\n                                      <div className=\"flex-shrink-0 w-8 h-8 bg-stone-700 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-sm z-10 font-serif\">\r\n                                          {idx + 1}\r\n                                      </div>\r\n                                      <div className=\"flex-1 space-y-4 pt-1 w-full\">\r\n                                          \r\n                                          {/* Shen Lun Reading Material in Review */}\r\n                                          {q.material && (\r\n                                              <div className=\"bg-stone-50 border-l-4 border-stone-300 p-4 mb-4 rounded-r-lg\">\r\n                                                  <div className=\"flex items-center gap-2 text-stone-700 font-bold mb-2 text-xs uppercase tracking-wider font-sans\">\r\n                                                       <BookText size={14} /> 给定资料\r\n                                                  </div>\r\n                                                  <div className=\"prose prose-sm prose-stone text-stone-600 leading-relaxed text-justify font-serif-sc\">\r\n                                                       {q.material}\r\n                                                  </div>\r\n                                              </div>\r\n                                          )}\r\n\r\n                                          {/* Question with Markdown Rendering (for SVG) */}\r\n                                          <div className=\"font-bold text-stone-800 text-lg leading-relaxed font-serif-sc\">\r\n                                              <MarkdownRenderer content={q.question} className=\"prose-base\" />\r\n                                          </div>\r\n                                          \r\n                                          {/* Options (MCQ only) */}\r\n                                          {q.options && (\r\n                                              <div className=\"grid grid-cols-1 gap-2\">\r\n                                                  {q.options.map((opt, i) => {\r\n                                                      // Determine correctness for display\r\n                                                      const optLabel = opt.split('.')[0].trim();\r\n                                                      const isCorrect = optLabel === q.answer || opt.startsWith(q.answer);\r\n\r\n                                                      // Clean and check content for SVG\r\n                                                      let optionContent = opt.substring(opt.indexOf('.') + 1).trim();\r\n                                                      optionContent = optionContent.replace(/```svg/gi, '').replace(/```/g, '').trim();\r\n                                                      const isSvgOption = optionContent.startsWith('<svg');\r\n                                                      \r\n                                                      return (\r\n                                                          <div key={i} className={`p-3 rounded-xl text-sm border flex items-center justify-between transition-all ${\r\n                                                              isCorrect \r\n                                                              ? 'bg-emerald-50 border-emerald-200 text-emerald-800 font-bold ring-1 ring-emerald-100/50' \r\n                                                              : 'bg-white border-stone-200 text-stone-500 opacity-80'\r\n                                                          }`}>\r\n                                                              <div className=\"flex items-center gap-2 flex-1 min-w-0\">\r\n                                                                  <span className=\"flex-shrink-0 font-bold font-serif\">{optLabel}.</span>\r\n                                                                  {isSvgOption ? (\r\n                                                                      <div className=\"w-16 h-16 sm:w-20 sm:h-20\" dangerouslySetInnerHTML={{__html: optionContent}} />\r\n                                                                  ) : (\r\n                                                                      <span className=\"break-words font-serif\">{optionContent || opt}</span>\r\n                                                                  )}\r\n                                                              </div>\r\n                                                              {isCorrect && <CheckCircle2 size={16} className=\"text-emerald-600 flex-shrink-0 ml-2\" />}\r\n                                                          </div>\r\n                                                      );\r\n                                                  })}\r\n                                              </div>\r\n                                          )}\r\n\r\n                                          {/* Analysis */}\r\n                                          <div className=\"bg-stone-50 rounded-xl p-4 text-sm border border-stone-200/60\">\r\n                                              <div className=\"flex items-center gap-2 mb-2\">\r\n                                                  <div className=\"bg-amber-100 text-amber-700 p-1 rounded\"><Lightbulb size={12} /></div>\r\n                                                  <span className=\"font-bold text-stone-700 text-xs font-sans\">\r\n                                                      {q.options ? '解析' : '参考范文与解析'}\r\n                                                  </span>\r\n                                                  {q.options && (\r\n                                                      <span className=\"text-xs text-stone-500 font-mono ml-2 bg-white border border-stone-200 px-1.5 py-0.5 rounded\">Answer: {q.answer}</span>\r\n                                                  )}\r\n                                              </div>\r\n                                              \r\n                                              {!q.options && (\r\n                                                  <div className=\"mb-4 bg-white p-3 rounded border border-stone-200 prose prose-sm prose-stone\">\r\n                                                      <strong className=\"text-xs text-stone-500 block mb-1 font-sans\">参考范文：</strong>\r\n                                                      <MarkdownRenderer content={q.answer} />\r\n                                                  </div>\r\n                                              )}\r\n\r\n                                              <div className=\"prose prose-sm max-w-none text-stone-600 font-serif-sc\">\r\n                                                  <MarkdownRenderer content={q.analysis} />\r\n                                              </div>\r\n                                          </div>\r\n                                      </div>\r\n                                  </div>\r\n                              </div>\r\n                          ))}\r\n                      </div>\r\n                  ) : (\r\n                      <MarkdownRenderer content={msg.text} />\r\n                  )}\r\n              </div>\r\n           </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // --- RENDER LEVEL 2: FOLDER VIEW (Combined Subfolders + Messages) ---\r\n  if (selectedCategoryId !== null) {\r\n    const isUncategorized = selectedCategoryId === 'UNCATEGORIZED';\r\n    const currentCategory = isUncategorized \r\n        ? { name: '默认收纳', id: 'UNCATEGORIZED', parentId: undefined } \r\n        : categories.find(c => c.id === selectedCategoryId);\r\n    \r\n    const isMaxDepth = !isUncategorized && !!currentCategory?.parentId;\r\n\r\n    const currentMessages = isUncategorized\r\n        ? modeMessages.filter(m => !m.categoryId || !categories.find(c => c.id === m.categoryId))\r\n        : modeMessages.filter(m => m.categoryId === selectedCategoryId);\r\n\r\n    const subFolders = isUncategorized \r\n        ? [] \r\n        : modeCategories.filter(c => c.parentId === selectedCategoryId);\r\n\r\n    return (\r\n      <div className=\"h-full flex flex-col bg-[#fcfaf8]\">\r\n        <ConfirmationModal \r\n            isOpen={confirmState.isOpen}\r\n            onClose={() => setConfirmState(prev => ({...prev, isOpen: false}))}\r\n            onConfirm={confirmState.action}\r\n            title={confirmState.title}\r\n            message={confirmState.message}\r\n            isDangerous={true}\r\n            confirmText=\"删除文件夹\"\r\n        />\r\n\r\n        {/* Folder Header */}\r\n        <div className=\"flex items-center justify-between p-4 bg-[#fcfaf8] border-b border-stone-200 sticky top-0 z-10\">\r\n           <div className=\"flex items-center gap-2\">\r\n            <button \r\n                onClick={handleNavigateUp}\r\n                className=\"p-2 hover:bg-stone-100 rounded-full text-stone-500 transition-colors\"\r\n                title=\"返回上一级\"\r\n            >\r\n                <CornerUpLeft size={20} />\r\n            </button>\r\n            <div>\r\n                <h2 className=\"font-bold text-lg text-stone-800 flex items-center gap-2 font-serif\">\r\n                    {isUncategorized ? <FolderOpen className=\"text-stone-400\" /> : <Folder className=\"text-stone-600 fill-stone-100\" />}\r\n                    {currentCategory?.name}\r\n                </h2>\r\n                {!isUncategorized && currentCategory?.parentId && (\r\n                    <div className=\"text-xs text-stone-400 ml-1 font-sans\">\r\n                        属于: {categories.find(c => c.id === currentCategory.parentId)?.name || '未知'}\r\n                    </div>\r\n                )}\r\n            </div>\r\n           </div>\r\n           \r\n           {!isUncategorized && (\r\n               <div className=\"flex gap-2\">\r\n                 {!isMaxDepth && (\r\n                    <button \r\n                        onClick={() => setIsCreatingCat(!isCreatingCat)}\r\n                        className=\"p-2 text-stone-600 bg-stone-100 hover:bg-stone-200 rounded-lg text-xs font-bold flex items-center gap-1 transition-colors font-sans\"\r\n                    >\r\n                        <Plus size={16} />\r\n                        <span className=\"hidden md:inline\">新建子文件夹</span>\r\n                    </button>\r\n                 )}\r\n                 \r\n                 <button \r\n                    onClick={() => {\r\n                        openConfirm(\"删除文件夹\", `确定要删除“${currentCategory?.name}”吗？\\n文件夹内的题目不会被删除，它们将变回“默认收纳”状态。`, () => { onDeleteCategory(selectedCategoryId); setSelectedCategoryId(null); });\r\n                    }}\r\n                    className=\"p-2 text-stone-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n                 >\r\n                    <Trash2 size={18} />\r\n                 </button>\r\n               </div>\r\n           )}\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-y-auto p-4\">\r\n            <div className=\"max-w-4xl mx-auto space-y-6\">\r\n                \r\n                {/* Create Subfolder Input */}\r\n                {isCreatingCat && !isMaxDepth && (\r\n                    <div className=\"bg-white p-3 rounded-xl border border-stone-200 shadow-sm flex gap-2 animate-in slide-in-from-top-2\">\r\n                        <input \r\n                            className=\"flex-1 bg-stone-50 border border-stone-200 rounded-lg px-3 text-sm focus:outline-none focus:ring-2 focus:ring-stone-400 font-sans\"\r\n                            placeholder=\"输入子文件夹名称...\"\r\n                            value={newCatName}\r\n                            onChange={(e) => setNewCatName(e.target.value)}\r\n                            autoFocus\r\n                            onKeyDown={(e) => e.key === 'Enter' && handleCreateCategory()}\r\n                        />\r\n                        <button onClick={handleCreateCategory} className=\"bg-stone-800 text-white px-4 py-1.5 rounded-lg text-sm font-bold hover:bg-stone-700 font-sans\">创建</button>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Subfolders Grid */}\r\n                {subFolders.length > 0 && (\r\n                    <div>\r\n                        <h4 className=\"text-xs font-bold text-stone-400 uppercase tracking-wider mb-2 flex items-center gap-1 font-sans\">\r\n                            <Folder size={12} /> 子文件夹\r\n                        </h4>\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n                            {subFolders.map(cat => (\r\n                                <div \r\n                                    key={cat.id}\r\n                                    onClick={() => setSelectedCategoryId(cat.id)}\r\n                                    className=\"bg-white p-3 rounded-xl border border-stone-200 hover:border-stone-400 hover:shadow-md cursor-pointer transition-all flex items-center gap-3 group\"\r\n                                >\r\n                                    <div className=\"bg-stone-50 p-2 rounded-lg text-stone-500 group-hover:bg-stone-100 group-hover:text-stone-700 transition-colors\">\r\n                                        <Folder size={18} className=\"fill-current bg-opacity-50\" />\r\n                                    </div>\r\n                                    <div className=\"min-w-0 flex-1\">\r\n                                        <div className=\"font-bold text-sm text-stone-800 truncate font-serif\">{cat.name}</div>\r\n                                        <div className=\"text-xs text-stone-400 font-sans\">{getMessageCount(cat.id)} 题</div>\r\n                                    </div>\r\n                                    <ChevronRight size={14} className=\"text-stone-300\" />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Messages List */}\r\n                <div>\r\n                     {subFolders.length > 0 && <h4 className=\"text-xs font-bold text-stone-400 uppercase tracking-wider mb-2 mt-6 flex items-center gap-1 font-sans\"><BookOpen size={12} /> 题目列表 ({currentMessages.length})</h4>}\r\n                     \r\n                     {currentMessages.length === 0 ? (\r\n                        <div className=\"flex flex-col items-center justify-center py-12 text-stone-400 border-2 border-dashed border-stone-200 rounded-xl bg-stone-50/50\">\r\n                            {subFolders.length === 0 ? (\r\n                                <>\r\n                                    <BookOpen size={48} className=\"mb-4 opacity-20\" />\r\n                                    <p className=\"font-serif\">此处空空如也</p>\r\n                                    {!isUncategorized && <p className=\"text-xs mt-1 font-sans\">您可以从对话中收藏题目到此文件夹</p>}\r\n                                </>\r\n                            ) : (\r\n                                <p className=\"text-xs font-serif\">此文件夹下没有直接的题目，请查看子文件夹。</p>\r\n                            )}\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"grid grid-cols-1 gap-3\">\r\n                            {currentMessages.map(msg => {\r\n                                const isQuiz = msg.quizData && msg.quizData.length > 0;\r\n                                const title = isQuiz \r\n                                    ? `[全真模拟卷] 内含 ${msg.quizData!.length} 道题目` \r\n                                    : getPreviewText(msg.text); // Use helper\r\n\r\n                                return (\r\n                                    <div \r\n                                    key={msg.id} \r\n                                    onClick={() => setSelectedMessageId(msg.id)}\r\n                                    className=\"bg-white p-4 rounded-xl border border-stone-200 shadow-sm hover:shadow-md hover:border-stone-400 cursor-pointer transition-all group\"\r\n                                    >\r\n                                    <div className=\"flex justify-between items-start mb-2\">\r\n                                        <div className=\"flex gap-2\">\r\n                                            <span className={`px-2 py-0.5 rounded text-[10px] font-bold border font-sans ${msg.role === 'user' ? 'bg-stone-50 text-stone-500 border-stone-200' : 'bg-stone-100 text-stone-600 border-stone-200'}`}>\r\n                                                {msg.role === 'user' ? '我的提问' : 'AI 回答'}\r\n                                            </span>\r\n                                            {isQuiz && (\r\n                                                <span className=\"px-2 py-0.5 rounded text-[10px] font-bold border bg-indigo-50 text-indigo-600 border-indigo-100 flex items-center gap-1 font-sans\">\r\n                                                    <FileText size={10} />\r\n                                                    模拟卷\r\n                                                </span>\r\n                                            )}\r\n                                            <span className=\"text-xs text-stone-400 flex items-center gap-1 font-sans\">\r\n                                                <Calendar size={10} />\r\n                                                {new Date(msg.timestamp).toLocaleDateString()}\r\n                                            </span>\r\n                                        </div>\r\n                                        {msg.note && <div className=\"text-[#b49b56]\"><StickyNote size={14} className=\"fill-[#b49b56]/20\" /></div>}\r\n                                    </div>\r\n                                    <div className={`text-sm line-clamp-2 mb-2 font-medium font-serif ${isQuiz ? 'text-indigo-800 font-bold' : 'text-stone-700'}`}>\r\n                                        {title}\r\n                                    </div>\r\n                                    \r\n                                    {/* Quiz Preview */}\r\n                                    {isQuiz && (\r\n                                        <div className=\"text-xs text-stone-500 mb-2 bg-stone-50 p-2 rounded-lg border border-stone-100 flex items-start gap-1.5 line-clamp-1 font-serif\">\r\n                                            <HelpCircle size={12} className=\"flex-shrink-0 mt-0.5 text-stone-400\" />\r\n                                            <span>Q1: {getPreviewText(msg.quizData![0].question)}</span>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {msg.note && <div className=\"bg-[#fff9e6] text-xs text-[#8a763d] p-2 rounded-lg line-clamp-1 border border-[#f5e6b3] font-serif\"><span className=\"font-bold mr-1\">笔记:</span>{msg.note}</div>}\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // --- RENDER LEVEL 1: ROOT CATEGORY GRID ---\r\n  const rootCategories = modeCategories.filter(c => !c.parentId);\r\n  const uncatCount = getMessageCount(); \r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col bg-[#fcfaf8]\">\r\n      <ConfirmationModal \r\n          isOpen={confirmState.isOpen}\r\n          onClose={() => setConfirmState(prev => ({...prev, isOpen: false}))}\r\n          onConfirm={confirmState.action}\r\n          title={confirmState.title}\r\n          message={confirmState.message}\r\n          isDangerous={true}\r\n      />\r\n      \r\n      {/* Top Tabs */}\r\n      <div className=\"bg-[#fcfaf8] border-b border-stone-200 px-4 pt-2\">\r\n        <div className=\"flex gap-6 overflow-x-auto scrollbar-hide\">\r\n            {[ExamMode.XING_CE, ExamMode.SHEN_LUN, ExamMode.MIAN_SHI].map((mode) => (\r\n                <button\r\n                  key={mode}\r\n                  onClick={() => setActiveTab(mode)}\r\n                  className={`pb-3 text-sm font-bold border-b-2 transition-colors whitespace-nowrap font-serif tracking-wide ${\r\n                      activeTab === mode \r\n                      ? 'border-stone-800 text-stone-800' \r\n                      : 'border-transparent text-stone-400 hover:text-stone-600'\r\n                  }`}\r\n                >\r\n                    {MODE_LABELS[mode]}\r\n                </button>\r\n            ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex-1 overflow-y-auto p-4 md:p-6\">\r\n         <div className=\"max-w-5xl mx-auto\">\r\n            <div className=\"flex justify-between items-end mb-4\">\r\n                <h3 className=\"text-stone-400 text-xs font-bold uppercase tracking-wider font-sans\">我的知识库</h3>\r\n                <button \r\n                  onClick={() => setIsCreatingCat(!isCreatingCat)}\r\n                  className=\"text-stone-600 text-xs font-bold flex items-center gap-1 hover:bg-stone-100 px-2 py-1 rounded-lg transition-colors font-sans\"\r\n                >\r\n                    <Plus size={14} />\r\n                    新建文件夹\r\n                </button>\r\n            </div>\r\n\r\n            {/* Create Input (Root Level) */}\r\n            {isCreatingCat && (\r\n                <div className=\"mb-4 bg-white p-3 rounded-xl border border-stone-200 shadow-sm flex gap-2 animate-in slide-in-from-top-2\">\r\n                    <input \r\n                        className=\"flex-1 bg-stone-50 border border-stone-200 rounded-lg px-3 text-sm focus:outline-none focus:ring-2 focus:ring-stone-400 font-sans\"\r\n                        placeholder=\"输入分类名称（如：数量关系）\"\r\n                        value={newCatName}\r\n                        onChange={(e) => setNewCatName(e.target.value)}\r\n                        autoFocus\r\n                        onKeyDown={(e) => e.key === 'Enter' && handleCreateCategory()}\r\n                    />\r\n                    <button onClick={handleCreateCategory} className=\"bg-stone-800 text-white px-4 py-1.5 rounded-lg text-sm font-bold hover:bg-stone-700 font-sans\">创建</button>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4\">\r\n                {/* Default/Uncategorized Folder */}\r\n                <div \r\n                    onClick={() => setSelectedCategoryId('UNCATEGORIZED')}\r\n                    className=\"bg-white p-4 rounded-xl border border-stone-200 hover:shadow-md cursor-pointer transition-all group flex flex-col justify-between h-32 md:h-40 hover:border-stone-400\"\r\n                >\r\n                   <div className=\"bg-stone-100 w-10 h-10 rounded-lg flex items-center justify-center text-stone-500 group-hover:scale-110 transition-transform\">\r\n                     <Tag size={20} />\r\n                   </div>\r\n                   <div>\r\n                     <h4 className=\"font-bold text-stone-800 font-serif\">默认收纳</h4>\r\n                     <p className=\"text-xs text-stone-400 mt-1 font-sans\">{uncatCount} 条笔记</p>\r\n                   </div>\r\n                </div>\r\n\r\n                {/* User Folders */}\r\n                {rootCategories.map(cat => (\r\n                    <div \r\n                        key={cat.id}\r\n                        onClick={() => setSelectedCategoryId(cat.id)}\r\n                        className=\"bg-white p-4 rounded-xl border border-stone-200 hover:border-stone-400 hover:shadow-md cursor-pointer transition-all group flex flex-col justify-between h-32 md:h-40\"\r\n                    >\r\n                       <div className=\"bg-[#f3f1eb] w-10 h-10 rounded-lg flex items-center justify-center text-[#8a763d] group-hover:scale-110 transition-transform\">\r\n                         <Folder size={20} className=\"fill-current bg-opacity-50\" />\r\n                       </div>\r\n                       <div>\r\n                         <h4 className=\"font-bold text-stone-800 truncate font-serif\">{cat.name}</h4>\r\n                         <p className=\"text-xs text-stone-400 mt-1 font-sans\">{getMessageCount(cat.id)} 条笔记</p>\r\n                       </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n         </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotebookView;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5242, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/HistorySidebar.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { MessageSquarePlus, Trash2, X, Clock } from 'lucide-react';\r\nimport { Session } from '../types';\r\n\r\ninterface Props {\r\n  isMobileOpen: boolean;\r\n  isDesktopOpen: boolean;\r\n  onMobileClose: () => void;\r\n  sessions: Session[];\r\n  currentSessionId: string;\r\n  onSelectSession: (id: string) => void;\r\n  onCreateSession: () => void;\r\n  onDeleteSession: (id: string, e: React.MouseEvent) => void;\r\n}\r\n\r\nconst HistorySidebar: React.FC<Props> = ({\r\n  isMobileOpen,\r\n  isDesktopOpen,\r\n  onMobileClose,\r\n  sessions,\r\n  currentSessionId,\r\n  onSelectSession,\r\n  onCreateSession,\r\n  onDeleteSession\r\n}) => {\r\n  // Sort sessions by update time (newest first)\r\n  const sortedSessions = [...sessions].sort((a, b) => b.updatedAt - a.updatedAt);\r\n\r\n  const formatDate = (timestamp: number) => {\r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const isToday = date.toDateString() === now.toDateString();\r\n    return isToday ? date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : date.toLocaleDateString();\r\n  };\r\n\r\n  // Shared Content for both Mobile and Desktop sidebars\r\n  const SidebarContent = ({ isMobile }: { isMobile: boolean }) => (\r\n    <div className=\"flex flex-col h-full bg-[#f3f1eb]\">\r\n        <div className=\"p-4 flex items-center justify-between flex-shrink-0\">\r\n           <h2 className=\"font-serif font-bold text-stone-700 flex items-center gap-2\">\r\n             <Clock size={18} className=\"text-stone-500\" />\r\n             <span className=\"tracking-wide\">历史记录</span>\r\n           </h2>\r\n           {isMobile && (\r\n               <button onClick={onMobileClose} className=\"p-1.5 hover:bg-stone-200 rounded-lg text-stone-500 transition-colors\">\r\n                 <X size={18} />\r\n               </button>\r\n           )}\r\n        </div>\r\n\r\n        <div className=\"px-3 mb-2 flex-shrink-0\">\r\n          <button\r\n            onClick={() => { onCreateSession(); if(isMobile) onMobileClose(); }}\r\n            className=\"w-full bg-stone-200 hover:bg-stone-300 text-stone-700 font-bold py-2.5 px-4 rounded-lg flex items-center justify-center gap-2 transition-all active:scale-95 text-sm\"\r\n          >\r\n            <MessageSquarePlus size={16} />\r\n            开启新对话\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-y-auto px-2 space-y-1 py-2 scrollbar-hide\">\r\n          {sortedSessions.length === 0 ? (\r\n            <div className=\"text-center text-stone-400 py-10 text-xs\">\r\n              暂无历史记录\r\n            </div>\r\n          ) : (\r\n            sortedSessions.map(session => (\r\n              <div\r\n                key={session.id}\r\n                onClick={() => { onSelectSession(session.id); if(isMobile) onMobileClose(); }}\r\n                className={`group flex items-center justify-between p-2.5 rounded-lg cursor-pointer transition-all border text-sm ${\r\n                  currentSessionId === session.id\r\n                    ? 'bg-white border-stone-200 shadow-sm'\r\n                    : 'bg-transparent border-transparent hover:bg-stone-200/50'\r\n                }`}\r\n              >\r\n                <div className=\"flex items-center gap-3 min-w-0 flex-1\">\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <div className={`font-medium truncate ${currentSessionId === session.id ? 'text-stone-900' : 'text-stone-600'}`}>\r\n                      {session.title || '新对话'}\r\n                    </div>\r\n                    <div className=\"text-[10px] text-stone-400 mt-0.5\">\r\n                      {formatDate(session.updatedAt)}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Delete Button - Only visible on hover or if active */}\r\n                {(sortedSessions.length > 1) && (\r\n                    <button\r\n                        onClick={(e) => { e.stopPropagation(); onDeleteSession(session.id, e); }}\r\n                        className={`p-1.5 rounded text-stone-400 hover:text-red-600 hover:bg-stone-200 transition-colors ${currentSessionId === session.id ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'}`}\r\n                        title=\"删除对话\"\r\n                    >\r\n                        <Trash2 size={12} />\r\n                    </button>\r\n                )}\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n        \r\n        {/* Footer decoration */}\r\n        <div className=\"p-4 border-t border-stone-200 text-center flex-shrink-0\">\r\n             <div className=\"text-[10px] text-stone-400 font-serif italic\">GongKao Pro v1.0</div>\r\n        </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {/* Mobile Sidebar (Drawer Overlay) */}\r\n      <div className={`md:hidden fixed inset-0 z-50 transition-opacity duration-300 ${isMobileOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}>\r\n          {/* Backdrop */}\r\n          <div \r\n             className=\"absolute inset-0 bg-black/20 backdrop-blur-sm\"\r\n             onClick={onMobileClose}\r\n          />\r\n          {/* Drawer */}\r\n          <div className={`absolute top-0 left-0 bottom-0 w-72 bg-[#f3f1eb] shadow-2xl transform transition-transform duration-300 ease-in-out ${isMobileOpen ? 'translate-x-0' : '-translate-x-full'}`}>\r\n             <SidebarContent isMobile={true} />\r\n          </div>\r\n      </div>\r\n\r\n      {/* Desktop Sidebar (Collapsible Column) */}\r\n      <div \r\n        className={`hidden md:flex flex-col bg-[#f3f1eb] border-r border-[#e5e5e0] transition-all duration-300 ease-in-out overflow-hidden ${\r\n          isDesktopOpen ? 'w-72 opacity-100' : 'w-0 opacity-0 border-none'\r\n        }`}\r\n      >\r\n          {/* Fixed width container to prevent content reflow during width transition */}\r\n          <div className=\"w-72 h-full flex flex-col\">\r\n             <SidebarContent isMobile={false} />\r\n          </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default HistorySidebar;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5516, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/AuthModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { X, User, Lock, ArrowRight, Sparkles, GraduationCap, Phone, MessageSquareCode } from 'lucide-react';\r\n\r\ninterface Props {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onLogin: (username: string, password: string) => Promise<void>;\r\n  onRegister: (username: string, password: string, phoneNumber: string) => Promise<void>;\r\n}\r\n\r\nconst AuthModal: React.FC<Props> = ({ isOpen, onClose, onLogin, onRegister }) => {\r\n  const [isLoginView, setIsLoginView] = useState(true);\r\n  \r\n  // Form Fields\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [phoneNumber, setPhoneNumber] = useState('');\r\n  const [verificationCode, setVerificationCode] = useState('');\r\n  \r\n  // Verification State\r\n  const [countdown, setCountdown] = useState(0);\r\n  const [sentCode, setSentCode] = useState<string | null>(null);\r\n\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Timer Effect\r\n  useEffect(() => {\r\n    let timer: ReturnType<typeof setTimeout>;\r\n    if (countdown > 0) {\r\n      timer = setTimeout(() => setCountdown(prev => prev - 1), 1000);\r\n    }\r\n    return () => clearTimeout(timer);\r\n  }, [countdown]);\r\n\r\n  // Reset state when modal opens/closes or view changes\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n        setError('');\r\n        setUsername('');\r\n        setPassword('');\r\n        setPhoneNumber('');\r\n        setVerificationCode('');\r\n        setSentCode(null);\r\n        setCountdown(0);\r\n    }\r\n  }, [isOpen, isLoginView]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleSendCode = () => {\r\n    if (!phoneNumber) {\r\n        setError('请输入手机号');\r\n        return;\r\n    }\r\n    // Simple regex for Chinese phone numbers\r\n    if (!/^1[3-9]\\d{9}$/.test(phoneNumber)) {\r\n        setError('请输入正确的11位手机号');\r\n        return;\r\n    }\r\n\r\n    setError('');\r\n    const mockCode = Math.floor(1000 + Math.random() * 9000).toString();\r\n    setSentCode(mockCode);\r\n    setCountdown(60); // Start 60s countdown\r\n    \r\n    // Simulate SMS sending\r\n    setTimeout(() => {\r\n        alert(`【公考智囊】您的验证码是：${mockCode}，请在1分钟内输入。`);\r\n    }, 500);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    \r\n    if (!username.trim() || !password.trim()) {\r\n      setError('请输入用户名和密码');\r\n      return;\r\n    }\r\n\r\n    if (!isLoginView) {\r\n        if (!phoneNumber) {\r\n            setError('请输入手机号');\r\n            return;\r\n        }\r\n        if (!verificationCode) {\r\n            setError('请输入验证码');\r\n            return;\r\n        }\r\n        if (verificationCode !== sentCode) {\r\n            setError('验证码错误或已过期');\r\n            return;\r\n        }\r\n    }\r\n\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (isLoginView) {\r\n        await onLogin(username, password);\r\n      } else {\r\n        await onRegister(username, password, phoneNumber);\r\n      }\r\n      onClose();\r\n    } catch (err: any) {\r\n      setError(err.message || '操作失败');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-300\">\r\n      <div className=\"bg-[#fcfaf8] rounded-2xl w-full max-w-md shadow-2xl overflow-hidden flex flex-col md:flex-row animate-in zoom-in-95 duration-300 m-4 border border-stone-200\">\r\n        \r\n        {/* Left Side (Decorative) - Hidden on mobile */}\r\n        <div className=\"hidden md:flex w-1/3 bg-[#f3f1eb] p-6 flex-col justify-between text-stone-800 relative overflow-hidden border-r border-stone-200\">\r\n          <div className=\"z-10\">\r\n             <div className=\"bg-stone-200 w-10 h-10 rounded-xl flex items-center justify-center mb-4\">\r\n                <GraduationCap size={24} className=\"text-stone-600\" />\r\n             </div>\r\n             <h3 className=\"font-bold text-xl leading-tight font-serif\">公考智囊<br/><span className=\"text-stone-400 text-sm font-normal font-sans\">GongKao Pro</span></h3>\r\n          </div>\r\n          <div className=\"z-10 text-xs text-stone-500 leading-relaxed font-serif\">\r\n             {isLoginView ? \"登录以同步您的学习进度、错题本和模拟考记录。\" : \"注册账号，开启您的智能备考之旅。\"}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Side (Form) */}\r\n        <div className=\"flex-1 p-6 md:p-8 relative\">\r\n          <button \r\n            onClick={onClose}\r\n            className=\"absolute top-4 right-4 text-stone-400 hover:text-stone-600 transition-colors\"\r\n          >\r\n            <X size={20} />\r\n          </button>\r\n\r\n          <div className=\"mb-6 mt-2\">\r\n            <h2 className=\"text-2xl font-bold text-stone-800 font-serif\">{isLoginView ? '欢迎回来' : '创建账号'}</h2>\r\n            <p className=\"text-sm text-stone-500 mt-1 font-sans\">\r\n              {isLoginView ? '请登录您的账号' : '免费注册一个新账号'}\r\n            </p>\r\n          </div>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            {/* Username */}\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-xs font-bold text-stone-500 ml-1 font-sans\">用户名</label>\r\n              <div className=\"relative\">\r\n                <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-stone-400\">\r\n                  <User size={18} />\r\n                </div>\r\n                <input \r\n                  type=\"text\" \r\n                  value={username}\r\n                  onChange={(e) => setUsername(e.target.value)}\r\n                  className=\"w-full bg-white border border-stone-200 rounded-xl pl-10 pr-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-stone-400 focus:border-transparent transition-all font-sans\"\r\n                  placeholder=\"请输入用户名\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Password */}\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-xs font-bold text-stone-500 ml-1 font-sans\">密码</label>\r\n              <div className=\"relative\">\r\n                <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-stone-400\">\r\n                  <Lock size={18} />\r\n                </div>\r\n                <input \r\n                  type=\"password\" \r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                  className=\"w-full bg-white border border-stone-200 rounded-xl pl-10 pr-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-stone-400 focus:border-transparent transition-all font-sans\"\r\n                  placeholder=\"请输入密码\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Registration Only Fields */}\r\n            {!isLoginView && (\r\n                <>\r\n                    <div className=\"space-y-1 animate-in slide-in-from-top-1\">\r\n                        <label className=\"text-xs font-bold text-stone-500 ml-1 font-sans\">手机号</label>\r\n                        <div className=\"relative\">\r\n                            <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-stone-400\">\r\n                                <Phone size={18} />\r\n                            </div>\r\n                            <input \r\n                                type=\"tel\" \r\n                                value={phoneNumber}\r\n                                onChange={(e) => setPhoneNumber(e.target.value)}\r\n                                className=\"w-full bg-white border border-stone-200 rounded-xl pl-10 pr-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-stone-400 focus:border-transparent transition-all font-sans\"\r\n                                placeholder=\"请输入11位手机号\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-1 animate-in slide-in-from-top-1\">\r\n                        <label className=\"text-xs font-bold text-stone-500 ml-1 font-sans\">验证码</label>\r\n                        <div className=\"relative flex gap-2\">\r\n                            <div className=\"relative flex-1\">\r\n                                <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-stone-400\">\r\n                                    <MessageSquareCode size={18} />\r\n                                </div>\r\n                                <input \r\n                                    type=\"text\" \r\n                                    value={verificationCode}\r\n                                    onChange={(e) => setVerificationCode(e.target.value)}\r\n                                    className=\"w-full bg-white border border-stone-200 rounded-xl pl-10 pr-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-stone-400 focus:border-transparent transition-all font-sans\"\r\n                                    placeholder=\"输入验证码\"\r\n                                    maxLength={6}\r\n                                />\r\n                            </div>\r\n                            <button \r\n                                type=\"button\"\r\n                                onClick={handleSendCode}\r\n                                disabled={countdown > 0}\r\n                                className={`w-28 flex-shrink-0 rounded-xl font-bold text-xs transition-colors border font-sans ${\r\n                                    countdown > 0 \r\n                                    ? 'bg-stone-100 text-stone-400 border-stone-200 cursor-not-allowed' \r\n                                    : 'bg-stone-200 text-stone-600 border-stone-300 hover:bg-stone-300'\r\n                                }`}\r\n                            >\r\n                                {countdown > 0 ? `${countdown}秒后重试` : '获取验证码'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </>\r\n            )}\r\n\r\n            {error && (\r\n              <div className=\"text-red-500 text-xs bg-red-50 p-2 rounded-lg border border-red-100 animate-in slide-in-from-left-2 flex items-center gap-1 font-sans\">\r\n                <span>⚠️</span> {error}\r\n              </div>\r\n            )}\r\n\r\n            <button \r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"w-full bg-stone-800 hover:bg-stone-900 text-white font-bold py-3 rounded-xl shadow-md shadow-stone-200 transition-all active:scale-95 flex items-center justify-center gap-2 mt-4 font-sans\"\r\n            >\r\n              {isLoading ? (\r\n                <span className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"></span>\r\n              ) : (\r\n                <>\r\n                  <span>{isLoginView ? '立即登录' : '立即注册'}</span>\r\n                  <ArrowRight size={18} />\r\n                </>\r\n              )}\r\n            </button>\r\n          </form>\r\n\r\n          <div className=\"mt-6 text-center\">\r\n            <p className=\"text-xs text-stone-500 font-sans\">\r\n              {isLoginView ? '还没有账号？' : '已有账号？'}\r\n              <button \r\n                onClick={() => { setIsLoginView(!isLoginView); setError(''); }}\r\n                className=\"text-stone-800 font-bold ml-1 hover:underline focus:outline-none\"\r\n              >\r\n                {isLoginView ? '去注册' : '去登录'}\r\n              </button>\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AuthModal;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6098, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/services/geminiService.ts"],"sourcesContent":["import { ExamMode, QuizQuestion } from '../types';\r\n\r\ninterface SendMessageParams {\r\n  text: string;\r\n  image?: string;\r\n  mode: ExamMode;\r\n  history?: { role: 'user' | 'model'; parts: { text: string }[] }[];\r\n}\r\n\r\ninterface GeminiResponse {\r\n  text: string;\r\n  quizData?: QuizQuestion[];\r\n}\r\n\r\nexport const sendMessageToGemini = async ({\r\n  text,\r\n  image,\r\n  mode,\r\n  history = []\r\n}: SendMessageParams): Promise<GeminiResponse> => {\r\n  try {\r\n    const response = await fetch('/api/gemini/chat', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        text,\r\n        image,\r\n        mode,\r\n        history\r\n      })\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(errorData.error || 'AI 服务暂时不可用');\r\n    }\r\n\r\n    const data = await response.json();\r\n    return {\r\n      text: data.text\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(\"Gemini API Error:\", error);\r\n    throw new Error(\"AI 服务暂时不可用，请检查网络或稍后再试。\");\r\n  }\r\n};\r\n\r\nexport const generateQuiz = async (mode: ExamMode, topic?: string, count: number = 5): Promise<QuizQuestion[]> => {\r\n  try {\r\n    const response = await fetch('/api/gemini/quiz', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        mode,\r\n        topic,\r\n        count\r\n      })\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(errorData.error || '无法生成题目');\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.quizData;\r\n\r\n  } catch (error) {\r\n    console.error(\"Quiz Generation Error:\", error);\r\n    throw new Error(\"无法生成题目，请稍后再试。\");\r\n  }\r\n};"],"names":[],"mappings":";;;;;;AAcO,MAAM,sBAAsB,OAAO,EACxC,IAAI,EACJ,KAAK,EACL,IAAI,EACJ,UAAU,EAAE,EACM;IAClB,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,oBAAoB;YAC/C,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB;gBACA;gBACA;gBACA;YACF;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,MAAM,IAAI,MAAM,UAAU,KAAK,IAAI;QACrC;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO;YACL,MAAM,KAAK,IAAI;QACjB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,MAAM,eAAe,OAAO,MAAgB,OAAgB,QAAgB,CAAC;IAClF,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,oBAAoB;YAC/C,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB;gBACA;gBACA;YACF;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,MAAM,IAAI,MAAM,UAAU,KAAK,IAAI;QACrC;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO,KAAK,QAAQ;IAEtB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,MAAM,IAAI,MAAM;IAClB;AACF"}},
    {"offset": {"line": 6162, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/components/App.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useCallback, useEffect } from 'react';\r\nimport Header from './Header';\r\nimport ModeSelector from './ModeSelector';\r\nimport ChatInterface from './ChatInterface';\r\nimport NotebookView from './NotebookView';\r\nimport ConfirmationModal from './ConfirmationModal';\r\nimport HistorySidebar from './HistorySidebar';\r\nimport AuthModal from './AuthModal';\r\nimport { ChatState, ExamMode, Message, Category, Session, User, QuizConfig } from '../types';\r\nimport { sendMessageToGemini, generateQuiz } from '../services/geminiService';\r\nimport { MODE_LABELS } from '../constants';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nconst generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);\r\n\r\n// LocalStorage Keys (Only for Guest/Token)\r\nconst GUEST_DATA_KEY = 'gongkao_guest_data'; \r\nconst USER_INFO_KEY = 'gongkao_user_info'; \r\n\r\nconst App: React.FC = () => {\r\n\r\n  // --- Initial State Initialization ---\r\n  const [chatState, setChatState] = useState<ChatState>({\r\n    currentUser: null,\r\n    messages: [],\r\n    categories: [],\r\n    sessions: [{ id: 'initial-session', title: '新对话', updatedAt: 0 }],\r\n    currentSessionId: 'initial-session',\r\n    isLoading: false,\r\n    currentMode: ExamMode.XING_CE,\r\n    showFavoritesOnly: false\r\n  });\r\n\r\n  const [isClearHistoryModalOpen, setIsClearHistoryModalOpen] = useState(false);\r\n  const [isAuthModalOpen, setIsAuthModalOpen] = useState(false);\r\n  const [isInitialized, setIsInitialized] = useState(false);\r\n\r\n  // Sidebar States\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n  const [isDesktopSidebarOpen, setIsDesktopSidebarOpen] = useState(true);\r\n\r\n  // --- Client-side Initialization ---\r\n  useEffect(() => {\r\n    if (isInitialized) return;\r\n\r\n    // 1. Check if user was logged in\r\n    const userStr = localStorage.getItem(USER_INFO_KEY);\r\n    const savedUser = userStr ? JSON.parse(userStr) : null;\r\n\r\n    const defaultState: ChatState = {\r\n      currentUser: savedUser,\r\n      messages: [],\r\n      categories: [],\r\n      sessions: [{ id: generateId(), title: '新对话', updatedAt: Date.now() }],\r\n      currentSessionId: '',\r\n      isLoading: false,\r\n      currentMode: ExamMode.XING_CE,\r\n      showFavoritesOnly: false\r\n    };\r\n    defaultState.currentSessionId = defaultState.sessions[0].id;\r\n\r\n    // 2. If Guest, try load local data\r\n    if (!savedUser) {\r\n        const guestData = localStorage.getItem(GUEST_DATA_KEY);\r\n        if (guestData) {\r\n            setChatState({ ...defaultState, ...JSON.parse(guestData) });\r\n            setIsInitialized(true);\r\n            return;\r\n        }\r\n    }\r\n\r\n    setChatState(defaultState);\r\n    setIsInitialized(true);\r\n  }, [isInitialized]);\r\n\r\n  // Toggle Logic\r\n  const handleSidebarToggle = () => {\r\n      // Check viewport width to decide which state to toggle\r\n      if (typeof window !== 'undefined' && window.innerWidth >= 768) { // md breakpoint\r\n          setIsDesktopSidebarOpen(prev => !prev);\r\n      } else {\r\n          setIsMobileMenuOpen(prev => !prev);\r\n      }\r\n  };\r\n\r\n  // --- Data Sync Effect ---\r\n  // 1. On Mount (or User Change), Load Data\r\n  useEffect(() => {\r\n    const fetchUserData = async () => {\r\n        if (chatState.currentUser) {\r\n            try {\r\n                const res = await fetch(`/api/data?userId=${chatState.currentUser.id}`);\r\n                if (res.ok) {\r\n                    const cloudData = await res.json();\r\n                    if (cloudData && cloudData.sessions && cloudData.sessions.length > 0) {\r\n                        setChatState(prev => ({\r\n                            ...prev,\r\n                            ...cloudData,\r\n                            currentUser: prev.currentUser // Ensure user info persists\r\n                        }));\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to sync from cloud\", error);\r\n            }\r\n        }\r\n    };\r\n    fetchUserData();\r\n  }, [chatState.currentUser?.id]);\r\n\r\n  // 2. On Change, Save Data (Debounced logic could be added, but simple save for now)\r\n  useEffect(() => {\r\n    const dataToSave = {\r\n        messages: chatState.messages,\r\n        categories: chatState.categories,\r\n        sessions: chatState.sessions,\r\n        currentSessionId: chatState.currentSessionId,\r\n        currentMode: chatState.currentMode\r\n    };\r\n\r\n    if (chatState.currentUser) {\r\n        // Cloud Sync\r\n        fetch('/api/data', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                userId: chatState.currentUser.id,\r\n                data: dataToSave\r\n            })\r\n        }).catch(e => console.error(\"Cloud save failed\", e));\r\n    } else {\r\n        // Local Sync (Guest)\r\n        localStorage.setItem(GUEST_DATA_KEY, JSON.stringify(dataToSave));\r\n    }\r\n  }, [chatState.messages, chatState.categories, chatState.sessions, chatState.currentSessionId, chatState.currentMode, chatState.currentUser]);\r\n\r\n\r\n  // --- Auth Handlers ---\r\n\r\n  const handleRegister = async (username: string, password: string, phoneNumber: string) => {\r\n    const res = await fetch('/api/auth/register', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ username, password, phoneNumber })\r\n    });\r\n    \r\n    const data = await res.json();\r\n    if (!res.ok) throw new Error(data.message);\r\n\r\n    // Auto login\r\n    await handleLogin(username, password);\r\n  };\r\n\r\n  const handleLogin = async (username: string, password: string) => {\r\n    const res = await fetch('/api/auth/login', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ username, password })\r\n    });\r\n\r\n    const data = await res.json();\r\n    if (!res.ok) throw new Error(data.message);\r\n\r\n    const { user, data: cloudData } = data;\r\n\r\n    // Save user info locally to persist login state across reloads\r\n    localStorage.setItem(USER_INFO_KEY, JSON.stringify(user));\r\n\r\n    // Merge Cloud Data\r\n    setChatState(prev => ({\r\n        ...prev,\r\n        currentUser: user,\r\n        ...cloudData, // Apply cloud data\r\n        isLoading: false\r\n    }));\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem(USER_INFO_KEY);\r\n    \r\n    // Switch to guest mode (try load guest data)\r\n    const guestDataStr = localStorage.getItem(GUEST_DATA_KEY);\r\n    let guestData = {\r\n        messages: [],\r\n        categories: [],\r\n        sessions: [{ id: generateId(), title: '新对话', updatedAt: Date.now() }],\r\n        currentSessionId: '',\r\n        currentMode: ExamMode.XING_CE\r\n    };\r\n    \r\n    if (guestDataStr) {\r\n        guestData = { ...guestData, ...JSON.parse(guestDataStr) };\r\n    }\r\n    if (!guestData.currentSessionId) guestData.currentSessionId = guestData.sessions[0].id;\r\n\r\n    setChatState({\r\n        ...guestData,\r\n        currentUser: null,\r\n        isLoading: false,\r\n        showFavoritesOnly: false\r\n    });\r\n  };\r\n\r\n  // --- Chat Logic ---\r\n\r\n  const handleCreateSession = () => {\r\n    const newSessionId = generateId();\r\n    const newSession: Session = {\r\n      id: newSessionId,\r\n      title: '新对话',\r\n      updatedAt: Date.now()\r\n    };\r\n\r\n    setChatState(prev => ({\r\n      ...prev,\r\n      sessions: [...prev.sessions, newSession],\r\n      currentSessionId: newSessionId,\r\n      showFavoritesOnly: false, // Switch back to chat view\r\n      isLoading: false\r\n    }));\r\n  };\r\n\r\n  const handleSelectSession = (sessionId: string) => {\r\n    setChatState(prev => {\r\n        return {\r\n            ...prev,\r\n            currentSessionId: sessionId,\r\n            showFavoritesOnly: false\r\n        };\r\n    });\r\n  };\r\n\r\n  const handleDeleteSession = (sessionId: string, e: React.MouseEvent) => {\r\n    setChatState(prev => {\r\n        const remainingSessions = prev.sessions.filter(s => s.id !== sessionId);\r\n        \r\n        let nextSessionId = prev.currentSessionId;\r\n        if (prev.currentSessionId === sessionId) {\r\n            nextSessionId = remainingSessions.length > 0 ? remainingSessions[0].id : '';\r\n             if (!nextSessionId) {\r\n                 const newId = generateId();\r\n                 remainingSessions.push({ id: newId, title: '新对话', updatedAt: Date.now() });\r\n                 nextSessionId = newId;\r\n             }\r\n        }\r\n        const filteredMessages = prev.messages.filter(m => m.sessionId !== sessionId);\r\n\r\n        return {\r\n            ...prev,\r\n            sessions: remainingSessions,\r\n            currentSessionId: nextSessionId,\r\n            messages: filteredMessages\r\n        };\r\n    });\r\n  };\r\n\r\n  const handleModeChange = (mode: ExamMode) => {\r\n    if (mode === chatState.currentMode) return;\r\n    const currentSessionMessages = chatState.messages.filter(m => m.sessionId === chatState.currentSessionId);\r\n\r\n    if (currentSessionMessages.length > 0) {\r\n      const systemMsg: Message = {\r\n        id: generateId(),\r\n        role: 'model',\r\n        text: `已切换模式：${MODE_LABELS[mode]}`,\r\n        timestamp: Date.now(),\r\n        isSystem: true,\r\n        mode: mode,\r\n        sessionId: chatState.currentSessionId\r\n      };\r\n      \r\n      setChatState(prev => ({\r\n          ...prev,\r\n          currentMode: mode,\r\n          messages: [...prev.messages, systemMsg]\r\n      }));\r\n    } else {\r\n      setChatState(prev => ({ ...prev, currentMode: mode }));\r\n    }\r\n  };\r\n\r\n  const handleSendMessage = useCallback(async (text: string, image?: string, quizConfig?: QuizConfig) => {\r\n    const activeSessionId = chatState.currentSessionId;\r\n    const isQuizRequest = text === \"start_quiz_mode\" && !!quizConfig;\r\n    const displayText = isQuizRequest \r\n        ? `开始刷题：${quizConfig.topic} (${quizConfig.count}题)` \r\n        : text;\r\n\r\n    const userMsg: Message = {\r\n      id: generateId(),\r\n      role: 'user',\r\n      text: displayText,\r\n      image,\r\n      timestamp: Date.now(),\r\n      mode: chatState.currentMode,\r\n      sessionId: activeSessionId\r\n    };\r\n\r\n    setChatState(prev => {\r\n        const currentSessionMessages = prev.messages.filter(m => m.sessionId === activeSessionId && m.role === 'user');\r\n        let updatedSessions = [...prev.sessions];\r\n        \r\n        if (currentSessionMessages.length === 0) {\r\n            updatedSessions = updatedSessions.map(s => \r\n                s.id === activeSessionId \r\n                ? { ...s, title: displayText.slice(0, 15) + (displayText.length > 15 ? '...' : ''), updatedAt: Date.now() } \r\n                : s\r\n            );\r\n        } else {\r\n             updatedSessions = updatedSessions.map(s => \r\n                s.id === activeSessionId \r\n                ? { ...s, updatedAt: Date.now() } \r\n                : s\r\n            );\r\n        }\r\n\r\n        return {\r\n            ...prev,\r\n            messages: [...prev.messages, userMsg],\r\n            sessions: updatedSessions,\r\n            isLoading: true,\r\n            showFavoritesOnly: false\r\n        };\r\n    });\r\n\r\n    try {\r\n      if (isQuizRequest) {\r\n          // --- QUIZ FLOW ---\r\n          const quizData = await generateQuiz(chatState.currentMode, quizConfig.topic, quizConfig.count);\r\n          \r\n          const modelMsg: Message = {\r\n            id: generateId(),\r\n            role: 'model',\r\n            text: `已为您生成 ${quizConfig.count} 道 [${quizConfig.topic}] 模拟题，计时开始！`,\r\n            quizData: quizData,\r\n            timestamp: Date.now(),\r\n            mode: chatState.currentMode,\r\n            sessionId: activeSessionId\r\n          };\r\n\r\n          setChatState(prev => ({\r\n            ...prev,\r\n            messages: [...prev.messages, modelMsg],\r\n            isLoading: false\r\n          }));\r\n\r\n      } else {\r\n          // --- STANDARD CHAT FLOW ---\r\n          const historyForApi = chatState.messages\r\n            .filter(m => m.sessionId === activeSessionId && !m.isError && !m.isSystem && !m.quizData) // Filter out complex quiz messages from history to keep context clean\r\n            .map(m => ({\r\n              role: m.role,\r\n              parts: [{ text: m.text }] \r\n            }));\r\n\r\n          const response = await sendMessageToGemini({\r\n            text,\r\n            image,\r\n            mode: chatState.currentMode,\r\n            history: historyForApi\r\n          });\r\n\r\n          const modelMsg: Message = {\r\n            id: generateId(),\r\n            role: 'model',\r\n            text: response.text,\r\n            timestamp: Date.now(),\r\n            mode: chatState.currentMode,\r\n            sessionId: activeSessionId\r\n          };\r\n\r\n          setChatState(prev => ({\r\n            ...prev,\r\n            messages: [...prev.messages, modelMsg],\r\n            isLoading: false\r\n          }));\r\n      }\r\n\r\n    } catch (error) {\r\n      const errorMsg: Message = {\r\n        id: generateId(),\r\n        role: 'model',\r\n        text: \"抱歉，生成内容时出现错误，请重试。\",\r\n        timestamp: Date.now(),\r\n        isError: true,\r\n        mode: chatState.currentMode,\r\n        sessionId: activeSessionId\r\n      };\r\n      setChatState(prev => ({\r\n        ...prev,\r\n        messages: [...prev.messages, errorMsg],\r\n        isLoading: false\r\n      }));\r\n    }\r\n  }, [chatState.currentMode, chatState.messages, chatState.currentSessionId]);\r\n\r\n  const handleClearHistory = () => {\r\n    if (chatState.currentUser) {\r\n        // Clear via API\r\n        fetch('/api/data', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                userId: chatState.currentUser.id,\r\n                data: {\r\n                    messages: [],\r\n                    categories: [],\r\n                    sessions: [{ id: generateId(), title: '新对话', updatedAt: Date.now() }],\r\n                    currentSessionId: generateId(), \r\n                    currentMode: ExamMode.XING_CE\r\n                }\r\n            })\r\n        });\r\n    } else {\r\n        localStorage.removeItem(GUEST_DATA_KEY);\r\n    }\r\n    \r\n    // Reset state\r\n    const newSessionId = generateId();\r\n    setChatState(prev => ({\r\n      ...prev,\r\n      messages: [],\r\n      categories: [],\r\n      sessions: [{ id: newSessionId, title: '新对话', updatedAt: Date.now() }],\r\n      currentSessionId: newSessionId,\r\n      isLoading: false,\r\n      currentMode: ExamMode.XING_CE,\r\n      showFavoritesOnly: false\r\n    }));\r\n  };\r\n\r\n  const toggleFavoritesView = () => {\r\n    setChatState(prev => ({\r\n      ...prev,\r\n      showFavoritesOnly: !prev.showFavoritesOnly\r\n    }));\r\n  };\r\n\r\n  const handleCreateCategory = (name: string, mode: ExamMode, parentId?: string) => {\r\n    const newCat: Category = {\r\n      id: generateId(),\r\n      name,\r\n      mode,\r\n      createdAt: Date.now(),\r\n      parentId\r\n    };\r\n    setChatState(prev => ({\r\n      ...prev,\r\n      categories: [...prev.categories, newCat]\r\n    }));\r\n    return newCat.id;\r\n  };\r\n\r\n  const handleDeleteCategory = (id: string) => {\r\n    setChatState(prev => ({\r\n      ...prev,\r\n      categories: prev.categories\r\n        .filter(c => c.id !== id)\r\n        .map(c => c.parentId === id ? { ...c, parentId: undefined } : c),\r\n      messages: prev.messages.map(m => m.categoryId === id ? { ...m, categoryId: undefined } : m)\r\n    }));\r\n  };\r\n\r\n  const handleSaveMessage = (messageId: string, categoryId: string) => {\r\n    setChatState(prev => ({\r\n      ...prev,\r\n      messages: prev.messages.map(msg => \r\n        msg.id === messageId \r\n          ? { ...msg, isBookmarked: true, categoryId: categoryId === '' ? undefined : categoryId } \r\n          : msg\r\n      )\r\n    }));\r\n  };\r\n\r\n  const handleRemoveMessage = (messageId: string) => {\r\n     setChatState(prev => ({\r\n      ...prev,\r\n      messages: prev.messages.map(msg => \r\n        msg.id === messageId \r\n          ? { ...msg, isBookmarked: false, categoryId: undefined, note: undefined }\r\n          : msg\r\n      )\r\n    }));\r\n  };\r\n\r\n  const handleUpdateNote = (messageId: string, noteContent: string) => {\r\n    setChatState(prev => ({\r\n      ...prev,\r\n      messages: prev.messages.map(msg => \r\n        msg.id === messageId \r\n          ? { ...msg, note: noteContent }\r\n          : msg\r\n      )\r\n    }));\r\n  };\r\n\r\n  const activeMessages = chatState.messages.filter(m => m.sessionId === chatState.currentSessionId);\r\n\r\n  return (\r\n    <div className=\"h-screen w-full bg-[#fcfaf8] flex font-sans text-stone-800 overflow-hidden\">\r\n      <ConfirmationModal \r\n        isOpen={isClearHistoryModalOpen}\r\n        onClose={() => setIsClearHistoryModalOpen(false)}\r\n        onConfirm={handleClearHistory}\r\n        title=\"清空当前数据\"\r\n        message={chatState.currentUser ? `确定要清空 ${chatState.currentUser.username} 的云端记录吗？` : \"确定要清空游客模式的所有数据吗？\"}\r\n        isDangerous={true}\r\n        confirmText=\"全部清空\"\r\n      />\r\n\r\n      <AuthModal \r\n        isOpen={isAuthModalOpen}\r\n        onClose={() => setIsAuthModalOpen(false)}\r\n        onLogin={handleLogin}\r\n        onRegister={handleRegister}\r\n      />\r\n\r\n      {/* Responsive Sidebar */}\r\n      <HistorySidebar \r\n        isMobileOpen={isMobileMenuOpen}\r\n        isDesktopOpen={isDesktopSidebarOpen}\r\n        onMobileClose={() => setIsMobileMenuOpen(false)}\r\n        sessions={chatState.sessions}\r\n        currentSessionId={chatState.currentSessionId}\r\n        onSelectSession={handleSelectSession}\r\n        onCreateSession={handleCreateSession}\r\n        onDeleteSession={handleDeleteSession}\r\n      />\r\n\r\n      {/* Main Content Area - Flex Column */}\r\n      <div className=\"flex-1 flex flex-col h-full relative w-full overflow-hidden transition-all\">\r\n          <Header \r\n            user={chatState.currentUser}\r\n            onLoginClick={() => setIsAuthModalOpen(true)}\r\n            onLogoutClick={handleLogout}\r\n            onClearHistory={() => setIsClearHistoryModalOpen(true)} \r\n            showFavoritesOnly={chatState.showFavoritesOnly}\r\n            onToggleFavorites={toggleFavoritesView}\r\n            onToggleSidebar={handleSidebarToggle}\r\n            isSidebarOpen={isDesktopSidebarOpen} // Only relevant for desktop icon choice really\r\n          />\r\n          \r\n          {chatState.showFavoritesOnly ? (\r\n             <main className=\"flex-1 relative w-full h-full overflow-hidden\">\r\n                <NotebookView \r\n                  messages={chatState.messages}\r\n                  categories={chatState.categories}\r\n                  onCreateCategory={handleCreateCategory}\r\n                  onDeleteCategory={handleDeleteCategory}\r\n                  onRemoveMessage={handleRemoveMessage}\r\n                  onUpdateNote={handleUpdateNote}\r\n                />\r\n             </main>\r\n          ) : (\r\n            <>\r\n              {/* Sticky Mode Selector */}\r\n              <div className=\"flex-shrink-0 z-10 bg-[#fcfaf8] pt-4 px-4 border-b border-transparent\">\r\n                <ModeSelector \r\n                  currentMode={chatState.currentMode} \r\n                  onSelectMode={handleModeChange}\r\n                  disabled={chatState.isLoading}\r\n                />\r\n              </div>\r\n\r\n              {/* Chat Area */}\r\n              <main className=\"flex-1 relative w-full mx-auto max-w-6xl\">\r\n                <ChatInterface \r\n                  messages={activeMessages}\r\n                  categories={chatState.categories} \r\n                  isLoading={chatState.isLoading}\r\n                  onSendMessage={handleSendMessage}\r\n                  currentMode={chatState.currentMode}\r\n                  onSaveMessage={handleSaveMessage} \r\n                  onCreateCategory={(name) => handleCreateCategory(name, chatState.currentMode)} \r\n                  onUpdateNote={handleUpdateNote}\r\n                />\r\n              </main>\r\n            </>\r\n          )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default App;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6890, "column": 0}, "map": {"version":3,"sources":["file:///D:/github/gongkaoPro/app/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport App from '../components/App';\r\n\r\nexport default function Home() {\r\n  return <App />;\r\n}"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIe,SAAS;IACtB,qBAAO,4TAAC,gIAAG;;;;;AACb;KAFwB"}}]
}